define(["translations","pgadmin.browser.endpoints","pgadmin.browser.utils","pgadmin.user_management.current_user","pgadmin.browser.messages","pgadmin.server.supported_servers"],(function(e,t,n,i,a,r){return function(e){function t(t){for(var i,o,s=t[0],l=t[1],d=t[2],u=0,f=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(c&&c(t);f.length;)f.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={12:0},r=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,i){n=a[e]=[t,i]}));t.push(n[2]=i);var r,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({14:"vendors~chart",15:"vendors~geometry",16:"vendors~snapsvg"}[e]||e)+".chunk.js"}(e);var l=new Error;r=function(t){s.onerror=s.onload=null,clearTimeout(d);var n=a[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+i+": "+r+")",l.name="ChunkLoadError",l.type=i,l.request=r,n[1](l)}a[e]=void 0}};var d=setTimeout((function(){r({type:"timeout",target:s})}),12e4);s.onerror=s.onload=r,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e},Object.defineProperty(o,"p",{get:function(){try{if("function"!=typeof getChunkURL)throw new Error("WebpackRequireFrom: 'getChunkURL' is not a function or not available at runtime. See https://github.com/agoldis/webpack-require-from#troubleshooting");return getChunkURL()}catch(e){return""}}});var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var c=l;return r.push([282,1,2,5,3,0,4]),n()}([,,function(e,t,n){"use strict";var i,a;n(21),n(34),n(5),n(29),i=[n(89)],void 0===(a=function(e){return function(t){var n=e[t]?e[t]:t;if(1==arguments.length)return n;try{var i=arguments;return n.split("%s").map((function(e,t){return t>0?t<i.length?[i[t],e].join(""):["%s",e].join(""):e})).join("")}catch(e){return console.error(e),n}}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";(function(i){var a;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(17),n(56),n(32),n(12),n(79),n(35),n(5),n(43),n(23),n(59),n(9),n(29),n(20),void 0===(a=function(){var e=window.pgAdmin=window.pgAdmin||{};function t(e,t,n){return void 0===n||0==+n?Math[e](t):(t=+t,n=+n,isNaN(t)||"number"!=typeof n||n%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))))}return function(e,t,n){function i(e,t,i,r){i=i||"width";var o,l,d,f=(t.match(c)||[])[2],p="px"===f?1:u[f+"toPx"];if(p||/r?em/i.test(f)&&!r)e=p?e:"rem"===f?s:"fontSize"===i&&e.parentNode||e,p=p||parseFloat(a(e,"fontSize")),d=parseFloat(t)*p;else{l=(o=e.style)[i];try{o[i]=t}catch(e){return 0}d=o[i]?parseFloat(a(e,i)):0,o[i]=l!==n?l:null}return d}function a(e,t){var n,o,s,l,u,f=["paddingTop","paddingBottom","borderTop","borderBottom"],p=4;if(o=e.style["pixel"+t.charAt(0).toUpperCase()+t.slice(1)],"%"===(s=((n=d?d(e)[t]:o?o+"px":"fontSize"===t?i(e,"1em","left",1)+"px":e.currentStyle[t]).match(c)||[])[2])&&r)if(/^top|bottom/.test(t)){for(l=(u=e.parentNode||e).offsetHeight;p--;)l-=parseFloat(a(u,f[p]));n=parseFloat(n)/100*l+"px"}else n=i(e,n);else("auto"===n||s&&"px"!==s)&&d?n=0:s&&"px"!==s&&!d&&(n=i(e,n)+"px");return n}var r,o=t.createElement("test"),s=t.documentElement,l=t.defaultView,d=l&&l.getComputedStyle,c=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,u={},f=[1/25.4,1/2.54,1/72,1/6],p=["mm","cm","pt","pc","in","mozmm"],h=6;for(s.appendChild(o),d&&(o.style.marginTop="1%",r="1%"===d(o).marginTop);h--;)u[p[h]+"toPx"]=f[h]?f[h]*u.inToPx:i(o,"1"+p[h]);s.removeChild(o),o=n,e.toPx=i}(e,window.document),e.natural_sort=function(e,t,n){n=n||{};var i,a,o=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=/^0x[0-9a-f]+$/i,c=/^0/,u=function(e){return n.insensitive&&(""+e).toLowerCase()||""+e},f=u(e).replace(s,"")||"",p=u(t).replace(s,"")||"",h=f.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),_=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(f.match(d))||1!==h.length&&f.match(l)&&Date.parse(f),m=parseInt(p.match(d))||g&&p.match(l)&&Date.parse(p)||null,b=n.desc?-1:1;if(m){if(g<m)return-1*b;if(g>m)return 1*b}for(var v=0,y=Math.max(h.length,_.length);v<y;v++){if(i=!(h[v]||"").match(c)&&parseFloat(h[v])||h[v]||0,a=!(_[v]||"").match(c)&&parseFloat(_[v])||_[v]||0,isNaN(i)!==isNaN(a))return(isNaN(i)?1:-1)*b;if(r(i)!==r(a)&&(i+="",a+=""),i<a)return-1*b;if(i>a)return 1*b}return 0},Math.round10||(Math.round10=function(e,n){return t("round",e,n)}),Math.floor10||(Math.floor10=function(e,n){return t("floor",e,n)}),Math.ceil10||(Math.ceil10=function(e,n){return t("ceil",e,n)}),e}.apply(t,[]))||(e.exports=a)}).call(this,n(3))},,,function(e,t,n){"use strict";var i,a;n(5),n(9),i=[n(90)],void 0===(a=function(e){return function(t,n){var i=e[t],a=i;return i?a=a.replace(/([<])([^:^>]*:)?([^>]+)([>])/g,(function(e,t,i,a){return a in n?n[a]:e})):i}}.apply(t,i))||(e.exports=a)},,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(8),n(16),n(21),n(34),n(32),n(4),n(35),n(5),n(139),n(9),n(61),n(29),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.parseShortcutValue=function(e){var t="";e.alt&&(t+="alt+");e.shift&&(t+="shift+");e.control&&(t+="ctrl+");return t+=e.key.char.toLowerCase()},t.findAndSetFocus=function(e){if(0==e.length)return;setTimeout((function(){var t=e.find("button.fa-plus:first");0==t.length&&(t=e.find("\n          .pgadmin-controls:first input:enabled,\n          .pgadmin-controls:first .btn:not(.toggle),\n          .ajs-commands:first,\n          .CodeMirror-scroll").find('*[tabindex]:not([tabindex="-1"])')),t.length>0?t[0].focus():e[0].focus()}),200)},t.getEpoch=function(e){var t=e||new Date;return parseInt(t.getTime()/1e3)},t.getGCD=function(e){var t=function e(t,n){return 0==t?n:e(n%t,t)},n=e.length;if(n<=2)return t(e[0],e[1]);for(var i=e[0],a=1;a<n;a++)i=t(e[a],i);return i},t.getMod=function(e,t){return(e%t+t)%t},t.parseFuncParams=function(e){var t=[],n="",i="";if(e.endsWith("()"))n=e.substring(0,e.length-2);else if(e.endsWith(")")){if(!e.endsWith("()")&&e.endsWith(")")){var a=0,r=e.length;for(a=e.length-2;a>=0;){if("("==e[a]){r=a;break}if('"'==e[a])for(a--;'"'!=e[a];)a--;a--}n=e.substring(0,r),i=e.substring(r+1,e.length-1);var o=0,s="",l=["IN","OUT","INOUT","VARIADIC"];for(o=a=0;a<i.length;){if('"'==i[a])for(a++;'"'!=i[a];)a++;else" "==i[a]?(""==s||l.indexOf(s)>-1)&&(s=i.substring(o,a),o=a+1):","==i[a]&&(t.push([s,i.substring(o,a)]),s="",o=a+1);a++}t.push([s,i.substring(o)])}}else n=e;return{func_name:n,param_string:i,params:t}},t.quote_ident=o,t.fully_qualify=function(e,t,n){var i=r.getTreeNodeHierarchyFromIdentifier.call(e,n),a="";void 0!==i.schema?a=o(i.schema._label):void 0!==i.view?a=o(i.view._label):void 0!==i.catalog&&(a=o(i.catalog._label));void 0!==i.package&&"package"!=t._type&&(""==a?a=o(i.package._label):a+="."+o(i.package._label));return""!=a?a+"."+o(t._label):o(t._label)},t.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},t.titleize=function(e){return""===e||null===e?e:e.split(" ").map((function(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()})).join(" ")},t.sprintf=function(e){try{var t=arguments;return e.split("%s").map((function(e,n){return n>0?n<t.length?[t[n],e].join(""):["%s",e].join(""):e})).join("")}catch(t){return console.error(t),e}},t.isString=t.isFunction=t.isValidData=void 0;var i,a=(i=n(1))&&i.__esModule?i:{default:i},r=n(53);t.isValidData=function(e){return!a.default.isUndefined(e)&&!a.default.isNull(e)};t.isFunction=function(e){return a.default.isFunction(e)};function o(e){var t=!1;return isNaN(parseInt(e))||(t=!0),e.search(/[^a-z0-9_]/g)>-1&&(e=e.replace(/"/g,'""'),t=!0),t?'"'.concat(e,'"'):e}t.isString=function(e){return a.default.isString(e)}},,,,,,,,,,,function(e,t,n){"use strict";n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){var e=null;try{e=window.opener&&window.opener.pgAdmin?function e(t){return t.opener&&t.opener.pgAdmin?e(t.opener):t}(window.opener):window.parent&&window.parent.pgAdmin?window.parent:window.top&&window.top.pgAdmin?window.top:window}catch(t){e=window}return e}();t.default=i},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e){function i(t){var n=0,i=0,r={};do{var o=t.getData();if(o._type in this.Nodes&&this.Nodes[o._type].hasId){var s=a(o._type,i);void 0===r[s]&&(r[s]=e.extend({},o,{priority:n}),n-=1)}i+=1,t=t.hasParent()?t.parent():null}while(t);return r}function a(e,t){return"partition"===e&&t>0?"table":e}n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.getTreeNodeHierarchyFromElement=function(e,t){return i.call(e,t)},t.getTreeNodeHierarchyFromIdentifier=function(e){var t=this.treeMenu.translateTreeNodeIdFromACITree(e),n=this.treeMenu.findNode(t);return null===n?null:i.call(this,n)},t.getTreeNodeHierarchy=i}).call(this,n(1))},function(e,t,n){"use strict";(function(i){var a,r;n(28),n(161),n(38),n(108),n(42),n(15),n(50),a=[n(92)],void 0===(r=function(){var e=window.Slick,t=function(e,t){return e.fromCell==t.fromCell&&e.toCell==t.toCell&&e.fromRow==t.fromRow&&e.toRow==t.toRow},n=function(t){return new e.Range(0,1,t.getDataLength()-1,t.getColumns().length-1)},a=function(e){return!i.isUndefined(e[0].pos)},r=function(e,t){return t.fromCell==t.toCell&&0==t.fromRow&&t.toRow==e.getDataLength()-1},o=function(e,t){return 0===t.fromRow&&t.toRow===e.getDataLength()-1},s=function(e,t){return t.fromCell===function(e){return i.findIndex(e.getColumns(),(function(e){var t=e.pos;return!i.isUndefined(t)&&l(e)}))}(e)&&t.toCell===function(e){return i.findLastIndex(e.getColumns(),l)}(e)};function l(e){return i.isUndefined(e.selectable)||!0===e.selectable}return{addRange:function(e,t){return e.push(t),e},removeRange:function(e,n){return i.filter(e,(function(e){return!t(e,n)}))},isRangeSelected:function(e,n){return i.any(e,(function(e){return t(e,n)}))},areAllRangesSingleRows:function(e,t){return i.every(e,(function(e){return e.fromRow==e.toRow&&s(t,e)}))},areAllRangesSingleColumns:function(e,t){return i.every(e,r.bind(this,t))},areAllRangesCompleteRows:function(e,t){return i.every(t,(function(t){return s(e,t)}))},areAllRangesCompleteColumns:function(e,t){return i.every(t,(function(t){return o(e,t)}))},rangeForRow:function(t,n){var i=t.getColumns();return a(i)?new e.Range(n,0,n,t.getColumns().length-1):new e.Range(n,1,n,t.getColumns().length-1)},rangeForColumn:function(t,n){return new e.Range(0,n,t.getDataLength()-1,n)},isEntireGridSelected:function(e){var i=e.getSelectionModel().getSelectedRanges();return 1==i.length&&t(i[0],n(e))},getRangeOfWholeGrid:n,isFirstColumnData:a,getIndexesOfCompleteRows:function(e,t){var n=[];return t.forEach((function(t){s(e,t)&&(n=n.concat(i.range(t.fromRow,t.toRow+1)))})),n},selectAll:function(e){var t=n(e);e.getSelectionModel().setSelectedRanges([t])},isRangeAColumn:r,rangeHasCompleteColumns:o,rangeHasCompleteRows:s,isAnyCellOfColumnSelected:function(e,t){return i.any(e,(function(e){return e.fromCell<=t&&e.toCell>=t}))},isRangeEntirelyWithinSelectedRanges:function(e,t){return i.any(e,(function(e){return e.fromCell<=t.fromCell&&e.toCell>=t.toCell&&e.fromRow<=t.fromRow&&e.toRow>=t.toRow}))},isAnyCellOfRowSelected:function(e,t){return i.any(e,(function(e){return e.fromRow<=t&&e.toRow>=t}))}}}.apply(t,a))||(e.exports=r)}).call(this,n(1))},,,function(e,t,n){"use strict";var i,a;n(21),n(56),n(138),n(5),n(9),i=[n(0),n(1),n(2),n(6)],void 0===(a=function(e,t,n,i){var a={epicRandomString:function(e){for(var t=[],n=0;n<36;n++)t[n]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("").replace(/-/g,"").substr(0,e)},getHash:function(e){for(var t=0,n=e.length,i=0;i<n;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t},calculateColumnWidth:function(t){e("body").append('<span id="pg_text" style="visibility: hidden;">'+t+"</span>");var n=e("#pg_text").width()+23;return e("#pg_text").remove(),n},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},previousStatus:null,fetchConnectionStatus:function(t,r,o){var s=i("sqleditor.connection_status",{trans_id:t.transId});if("visible"===document.visibilityState&&"visible"===r.data("panel-visible")&&!o.hasClass("obtaining-conn")){var l=t;e.ajax({url:s,method:"GET"}).done((function(e){if(e&&e.data){var t=e.data.status,i=e.data.message,s=!1;switch(l.update_notifications(e.data.notifies),t){case 1:t!=a.previousStatus||o.hasClass("fa-hourglass-half")||(o.removeClass().addClass("fa fa-hourglass-half"),s=!0);break;case 2:a.previousStatus==t||o.hasClass("fa-clock-o")||(o.removeClass().addClass("fa fa-clock-o"),s=!0);break;case 3:a.previousStatus==t||o.hasClass("fa-exclamation-circle")||(o.removeClass().addClass("fa fa-exclamation-circle"),s=!0);break;case 4:a.previousStatus==t||o.hasClass("fa-exclamation-triangle")||(o.removeClass().addClass("fa fa-exclamation-triangle"),s=!0);break;default:a.previousStatus==t||o.hasClass("fa-query_tool_connected")||(o.removeClass().addClass("pg-font-icon icon-query-tool-connected"),s=!0)}a.previousStatus=t,s&&(r.popover("hide"),r.attr("data-content",i))}else a.previousStatus=-99,i=n("An unexpected error occurred - ensure you are logged into the application."),r.attr("data-content",i),o.hasClass("icon-query-tool-disconnected")||(r.popover("hide"),o.removeClass().addClass("pg-icon-font icon-query-tool-disconnected"))})).fail((function(e){a.previousStatus=-1;var t=n("Transaction status check failed.");0==e.readyState?t=n("Not connected to the server or the connection to the server has been closed."):e.responseJSON&&e.responseJSON.errormsg&&(t=e.responseJSON.errormsg),r.attr("data-content",t),o.hasClass("icon-query-tool-disconnected")||(r.popover("hide"),o.removeClass().addClass("pg-font-icon icon-query-tool-disconnected"))}))}},updateConnectionStatusFlag:function(t){var n=e(".connection_status");n.data("panel-visible")!=t&&n.data("panel-visible",t)},calcFontSize:function(e){if(e){var t=Number(Math.round(e+"e+2")+"e-2");if(t>0)return t+"em"}return"1em"},addEditableIcon:function(e,n){var i={cssClass:"editable-column-header-icon",content:n?'<i class="fa fa-pencil"></i>':'<i class="fa fa-lock"></i>'};t.isUndefined(e.header)||t.isUndefined(e.header.buttons)?e.header={buttons:[i]}:e.header.buttons.push(i)}};return a}.apply(t,i))||(e.exports=a)},,,,,,,,,,,,function(e,t,n){"use strict";n(28),n(8),n(4),n(5),n(61),Object.defineProperty(t,"__esModule",{value:!0}),t.processEventDebugger=function(e,t,n,a){var r,o,s="";this.validateShortcutKeys(n.edit_grid_values,t)?(this._stopEventPropagation(t),(r=e.find('div.wcPanelTabContent:not(".wcPanelTabContentHidden")')).length&&(o=(0,i.default)(r).find("td.editable:first")).length&&o.trigger("click")):this.validateShortcutKeys(n.move_next,t)?(this._stopEventPropagation(t),s=_(a,"right")):this.validateShortcutKeys(n.move_previous,t)?(this._stopEventPropagation(t),s=_(a,"left")):this.validateShortcutKeys(n.switch_panel,t)&&(this._stopEventPropagation(t),s=_(a,"switch"));return s},t.processEventQueryTool=function(e,t,n,a){if(e.isQueryRunning())return;var r=n.which||n.keyCode,o="",h=e.preferences.execute_query,g=e.preferences.explain_query,m=e.preferences.explain_analyze_query,b=e.preferences.download_csv,v=e.preferences.move_next,y=e.preferences.move_previous,w=e.preferences.switch_panel,x=e.preferences.toggle_case,C=e.preferences.commit_transaction,S=e.preferences.rollback_transaction,k=e.preferences.save_data;if(this.validateShortcutKeys(h,n))this._stopEventPropagation(n),t.executeQuery(e);else if(this.validateShortcutKeys(g,n))this._stopEventPropagation(n),t.explain(e);else if(this.validateShortcutKeys(m,n))this._stopEventPropagation(n),t.explainAnalyze(e);else if(this.validateShortcutKeys(b,n))this._stopEventPropagation(n),t.download(e);else if(this.validateShortcutKeys(x,n))this._stopEventPropagation(n),t.toggleCaseOfSelectedText(e);else if(this.validateShortcutKeys(C,n))e.is_transaction_buttons_disabled||(this._stopEventPropagation(n),t.executeCommit(e));else if(this.validateShortcutKeys(S,n))e.is_transaction_buttons_disabled||(this._stopEventPropagation(n),t.executeRollback(e));else if(this.validateShortcutKeys(k,n))this._stopEventPropagation(n),t.saveDataChanges(e);else if((this.isMac()&&n.metaKey||!this.isMac()&&n.ctrlKey)&&!n.altKey&&n.shiftKey&&r===l)this._stopEventPropagation(n),t.commentBlockCode(e);else if((this.isMac()&&!this.isKeyCtrlAltShift(n)&&n.metaKey||!this.isMac()&&!this.isKeyAltShift(n)&&n.ctrlKey)&&r===l)this._stopEventPropagation(n),t.commentLineCode(e);else if((this.isMac()&&!this.isKeyCtrlAltShift(n)&&n.metaKey||!this.isMac()&&!this.isKeyAltShift(n)&&n.ctrlKey)&&r===s)this._stopEventPropagation(n),t.uncommentLineCode(e);else if(r==d)t.focusOut(e),(0,i.default)(n.target).hasClass("dropdown-item")&&(0,i.default)(n.target).closest(".dropdown-submenu").length>0&&(0,i.default)(n.target).closest(".dropdown-submenu").find(".dropdown-menu").removeClass("show");else if(this.validateShortcutKeys(v,n))this._stopEventPropagation(n),o=_(a,"right");else if(this.validateShortcutKeys(y,n))this._stopEventPropagation(n),o=_(a,"left");else if(this.validateShortcutKeys(w,n))this._stopEventPropagation(n),o=_(a,"switch");else if(r===u||r===p){if((0,i.default)(n.target).closest(".dropdown-menu").length>0){this._stopEventPropagation(n);var T=(0,i.default)(n.target).closest("li");for((0,i.default)(n.target).closest(".dropdown-menu").find(".show").removeClass("show"),r===u?T=T.prev():r===p&&(T=T.next());T.hasClass("dropdown-divider")||T.hasClass("d-none")||T.find(".dropdown-item").first().hasClass("disabled");)r===u?T=T.prev():r===p&&(T=T.next());T.find(".dropdown-item").trigger("focus")}}else if((r===c||r===f)&&(0,i.default)(n.target).closest(".dropdown-menu").length>0){this._stopEventPropagation(n);var E=(0,i.default)(n.target).closest("li");if(r===f)E.hasClass("dropdown-submenu")&&(E.find(".dropdown-menu").addClass("show"),E=E.find(".dropdown-menu .dropdown-item").first().trigger("focus"));else if(r===c){var P=E.closest(".dropdown-menu");P.closest(".dropdown-submenu").length>0&&(P.removeClass("show"),(E=P.closest(".dropdown-submenu")).find(".dropdown-item").trigger("focus"))}}return o},t.focusDockerPanel=_,t.validateShortcutKeys=function(e,t){if(!e)return!1;var n=t.which||t.keyCode;return e.alt==t.altKey&&e.shift==t.shiftKey&&e.control==t.ctrlKey&&e.key.key_code==n},t._stopEventPropagation=function(e){e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},t.isMac=function(){return-1!=window.navigator.platform.search("Mac")},t.isKeyCtrlAlt=function(e){return e.ctrlKey||e.altKey},t.isKeyAltShift=function(e){return e.altKey||e.shiftKey},t.isKeyCtrlShift=function(e){return e.ctrlKey||e.shiftKey},t.isKeyCtrlAltShift=function(e){return e.ctrlKey||e.altKey||e.shiftKey},t.isAltShiftBoth=function(e){return e.altKey&&e.shiftKey&&!e.ctrlKey},t.isCtrlShiftBoth=function(e){return e.ctrlKey&&e.shiftKey&&!e.altKey},t.isCtrlAltBoth=function(e){return e.ctrlKey&&e.altKey&&!e.shiftKey},t.shortcut_key=h,t.shortcut_title=function(e,t){var n="";if(null==t)return n;t.alt&&(n=(0,a.default)("Alt")+"+");t.shift&&(n+=(0,a.default)("Shift")+"+");t.control&&(n+=(0,a.default)("Ctrl")+"+");return n+=h(t),"".concat(e," (").concat(n,")")},t.shortcut_accesskey_title=function(e,t){return"".concat(e," (").concat((0,a.default)("accesskey")," + ").concat(h(t),")")};var i=o(n(0)),a=o(n(2)),r=n(22);function o(e){return e&&e.__esModule?e:{default:e}}var s=190,l=191,d=27,c=37,u=38,f=39,p=40;function h(e){var t="";return e.key&&e.key.char&&(t=e.key.char.toUpperCase()),t}function _(e,t){if(e){if(!e._focusFrame){if(0==e._frameList.length&&0==e._frameList[0]._panelList.length)return;e._frameList[0]._panelList[e._frameList[0]._curTab].focus()}var n=e._focusFrame,i=0,a=!1;if("switch"==t){var o=0,s=e._frameList.length;for(o=0;o<s&&n!==e._frameList[o];o++);i=(n=e._frameList[(0,r.getMod)(o+1,s)])._curTab,a=!0}else"left"==t?(i=(0,r.getMod)(n._curTab-1,n._panelList.length),a=!1):"right"==t&&(i=(0,r.getMod)(n._curTab+1,n._panelList.length),a=!1);var l=n._panelList[i];return l.$container.find('*[tabindex]:not([tabindex="-1"])').trigger("focus"),l.focus(a),l._type}}},,,,,,,function(e,t,n){"use strict";(function(e){n(28),n(11),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.getPanelTitle=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==t&&(t=e.treeMenu.selected());var n=a.getTreeNodeHierarchyFromIdentifier.call(e,t);if(function(e){return void 0===e.server}(n))return;var i=function(e){return e.database?e.database.label:e.server.db}(n);return"".concat(i,"/").concat(n.server.user.name,"@").concat(n.server.label)},t.setQueryToolDockerTitle=function(t,n,i,a){var o="",s="";a||"true"==a?(s=(0,r.default)("File - ")+i,o="fa fa-file-text-o"):"false"==n||0==n?(s=(0,r.default)("View/Edit Data - ")+i,o="fa fa-table"):(s=(0,r.default)("Query Tool - ")+i,o="pg-font-icon icon-query-tool");t.title('<span title="'+e.escape(s)+'">'+e.escape(i)+"</span>"),t.icon(o)};var i,a=n(53),r=(i=n(2))&&i.__esModule?i:{default:i}}).call(this,n(1))},,,,,,,,,,function(e,t,n){"use strict";n(4),n(12),n(143),Object.defineProperty(t,"__esModule",{value:!0}),t.setPGCSRFToken=function(e,t){if(!t)throw"csrf-token meta tag has not been set";var n=a.default.sync;a.default.sync=function(i,a,r){return r.beforeSend=function(n){n.setRequestHeader(e,t)},n(i,a,r)};var o=a.default.get;a.default.get=function(n,i,a){return a.beforeSend=function(n){n.setRequestHeader(e,t)},o(n,i,a)},i.default.ajaxSetup({beforeSend:function(n){n.setRequestHeader(e,t)}}),r.default.interceptors.request.use((function(n){return n.headers[e]=t,n}),(function(e){return Promise.reject(e)}))};var i=o(n(0)),a=o(n(14)),r=o(n(66));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";n(8);var i=o(n(0)),a=o(n(1)),r=o(n(33));function o(e){return e&&e.__esModule?e:{default:e}}e.exports={modifyAcitreeAnimation:function(e,t){var n=e.get_preference("browser","enable_acitree_animation").value;a.default.isUndefined(t)&&(t=e.tree),n?t.options({animateRoot:!0,unanimated:!1,show:a.default.extend(t.options().show,{duration:75}),hide:a.default.extend(t.options().hide,{duration:75}),view:a.default.extend(t.options().view,{duration:75})}):t.options({animateRoot:!1,unanimated:!0,show:a.default.extend(t.options().show,{duration:0}),hide:a.default.extend(t.options().hide,{duration:0}),view:a.default.extend(t.options().view,{duration:0})})},modifyAlertifyAnimation:function(e){(a.default.isUndefined(e)||a.default.isNull(e))&&(e=r.default.pgAdmin.Browser),e.get_preference("browser","enable_alertify_animation").value?((0,i.default)(document).find("body").removeClass("alertify-no-animation"),a.default.each(document.getElementsByTagName("iframe"),(function(e){(0,i.default)(e.contentDocument).find("body").removeClass("alertify-no-animation")}))):((0,i.default)(document).find("body").addClass("alertify-no-animation"),a.default.each(document.getElementsByTagName("iframe"),(function(e){(0,i.default)(e.contentDocument).find("body").addClass("alertify-no-animation")})))}}},,function(t,n){t.exports=e},function(e,n){e.exports=t},,,,,,,function(e,t,n){"use strict";n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.getTransId=function(e){return a.default.ajax({data:e,type:"POST",async:!1,url:(0,i.default)("file_manager.get_trans_id"),dataType:"json",contentType:"application/json; charset=utf-8"})},t.removeTransId=function(e){return a.default.ajax({type:"GET",async:!1,url:(0,i.default)("file_manager.delete_trans_id",{trans_id:e}),dataType:"json",contentType:"application/json; charset=utf-8"})},t.set_last_traversed_dir=function(e,t){return a.default.ajax({url:(0,i.default)("file_manager.save_last_dir",{trans_id:t}),type:"POST",data:JSON.stringify(e),contentType:"application/json"})};var i=r(n(6)),a=r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var i,a;i=[n(2),n(48)],void 0===(a=function(e,t){return{copyTextToClipboard:function(n){var i=document.createElement("textarea");i.style.position="fixed",i.style.top=0,i.style.left=0,i.style.width="2em",i.style.height="2em",i.style.padding=0,i.style.border="none",i.style.outline="none",i.style.boxShadow="none",i.style.background="transparent",document.body.appendChild(i),i.select();document.addEventListener("copy",(function e(t){document.removeEventListener("copy",e);var i=t.clipboardData||window.clipboardData;i&&(i.setData("text",n),t.preventDefault())}));try{document.execCommand("copy")}catch(n){t.alert(e("Error"),e("Oops, unable to copy to clipboard"))}document.body.removeChild(i)}}}.apply(t,i))||(e.exports=a)},,,,,,,,,function(e,t,n){"use strict";n(108),n(11),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.initializeToolbar=function(e,t){l=e,a.default.each(d,(function(e){u(e)})),a.default.each(c,(function(e){u(e)})),e.on(t.EVENT.BUTTON,(function(e){"name"in e&&e.name===(0,i.default)("Query Tool")?r.default.DataGrid.show_query_tool("",r.default.Browser.tree.selected()):"name"in e&&e.name===(0,i.default)("View Data")?r.default.DataGrid.show_data_grid({mnuid:3},r.default.Browser.tree.selected()):"name"in e&&e.name===(0,i.default)("Filtered Rows")&&r.default.DataGrid.show_filtered_row({mnuid:4},r.default.Browser.tree.selected())}))},t.enable=function(e,t){e in s?l.buttonEnable(e,t):console.warn("Developer warning: No tool button found with label: "+e)};var i=o(n(2)),a=o(n(1)),r=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}var s={},l=null,d=[{label:(0,i.default)("Query Tool"),ariaLabel:(0,i.default)("Query Tool"),btnClass:"pg-font-icon icon-query-tool",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-secondary",enabled:!1},{label:(0,i.default)("View Data"),ariaLabel:(0,i.default)("View Data"),btnClass:"fa fa-table",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-secondary",enabled:!1},{label:(0,i.default)("Filtered Rows"),ariaLabel:(0,i.default)("Filtered Rows"),btnClass:"pg-font-icon icon-filter-table-toolbar",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-secondary",enabled:!1}],c=[];function u(e){e.label in s&&!(a.default.findIndex(l._buttonList,{name:e.label})<0)||(l.addButton(e.label,e.btnClass,e.text,e.label,e.toggled,e.toggleClass,e.parentClass,e.enabled,e.ariaLabel),s[e.label]=e)}},,function(e,t,n){"use strict";n(8),n(15),n(4),n(7);var i=o(n(0)),a=o(n(96)),r=n(22);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dialogContainer=t,this.tabSwitching=!1,this.tabs=this.dialogContainer.find(".nav-tabs:visible"),this.tabs.length>0&&(this.tabs=this.tabs[0]),this.dialogTabBackward=(0,r.parseShortcutValue)(n),this.dialogTabForward=(0,r.parseShortcutValue)(i),(0,a.default)(this.dialogContainer[0]).bind(this.dialogTabBackward,this.onKeyboardEvent.bind(this)),(0,a.default)(this.dialogContainer[0]).bind(this.dialogTabForward,this.onKeyboardEvent.bind(this))}var t,n,o;return t=e,(n=[{key:"onKeyboardEvent",value:function(e,t){var n=this.dialogContainer.find(".tab-content:first > .tab-pane.active:first:visible"),i=this.isActivePaneHasChildTabs(n);this.tabSwitching||(this.tabSwitching=!0,i&&this.navigate(t,i.childTab,i.childTabPane,e)||this.navigate(t,this.tabs,n,e))}},{key:"isActivePaneHasChildTabs",value:function(e){var t=e.find(".nav-tabs:first:visible");return t.length>0?{childTab:t,childTabPane:e.find(".tab-content:first > .tab-pane.active:first:visible")}:null}},{key:"navigate",value:function(e,t,n,i){return e==this.dialogTabBackward?this.navigateBackward(t,n,i):e==this.dialogTabForward&&this.navigateForward(t,n,i)}},{key:"navigateBackward",value:function(e,t,n){var a,o,s=this,l=(0,i.default)(e).find("li").has("a.active").prev("li");return l.length>0?(l.find("a").tab("show"),(o=(a=t.prev()).find(".tab-content:first > .tab-pane.active:first:visible")).length>0?(0,r.findAndSetFocus)(o):(0,r.findAndSetFocus)(a),setTimeout((function(){s.tabSwitching=!1}),200),n.stopPropagation(),!0):(this.tabSwitching=!1,!1)}},{key:"navigateForward",value:function(e,t,n){var a,o,s=this,l=(0,i.default)(e).find("li").has("a.active").next("li");return l.length>0?(l.find("a").tab("show"),(o=(a=t.next()).find(".tab-content:first > .tab-pane.active:first:visible")).length>0?(0,r.findAndSetFocus)(o):(0,r.findAndSetFocus)(a),setTimeout((function(){s.tabSwitching=!1}),200),n.stopPropagation(),!0):(this.tabSwitching=!1,!1)}},{key:"detach",value:function(){(0,a.default)(this.dialogContainer[0]).unbind(this.dialogTabBackward),(0,a.default)(this.dialogContainer[0]).unbind(this.dialogTabForward)}}])&&s(t.prototype,n),o&&s(t,o),e}();e.exports={dialogTabNavigator:l}},function(e,t,n){"use strict";var i,a;n(8),n(16),n(21),n(36),n(32),n(11),n(12),n(5),n(43),n(9),n(7),n(37),i=[n(2),n(6),n(0),n(1),n(13),n(10),n(14),n(60),n(73),n(81),n(125),n(146),n(141)],void 0===(a=function(e,t,n,i,a,r,o,s,l,d,c){if(r.UserManagement)return r.UserManagement;var u=t("user_management.users"),f=t("user_management.roles");return r.UserManagement={init:function(){if(!this.initialized)return this.initialized=!0,this},change_password:function(n){var i=e("Change Password");a.ChangePassword||a.dialog("ChangePassword",(function(){return{main:function(e,t){this.set({title:e,url:t})},build:function(){a.pgDialogBuild.apply(this)},settings:{url:void 0},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-secondary pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:e("Change Password"),url:t("help.static",{filename:"change_user_password.html"})}},{text:e("Close"),key:27,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button",attrs:{name:"close",type:"button"}}],options:{padding:!1,overflow:!1,modal:!1,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,closable:!1}}},hooks:{onclose:function(){return setTimeout((function(){return a.ChangePassword().destroy()}),500)}},prepare:function(){var e=document.createElement("iframe");e.frameBorder="no",e.width="100%",e.height="100%",e.src=this.setting("url"),this.elements.content.appendChild(e)},callback:function(e){if("dialog_help"==e.button.element.name)return e.cancel=!0,void r.showHelp(e.button.element.name,e.button.element.getAttribute("url"),null,null)}}})),a.ChangePassword(i,n).resizeTo(r.stdW.lg,r.stdH.md)},isPgaLoginRequired:function(e){return void 0===e.responseJSON&&void 0!==e.data?401===e.status&&e.data&&e.data.info&&"PGADMIN_LOGIN_REQUIRED"===e.data.info:401===e.status&&e.responseJSON&&e.responseJSON.info&&"PGADMIN_LOGIN_REQUIRED"===e.responseJSON.info},pgaLogin:function(n){var i=e("pgAdmin 4 login");n=n||t("security.login"),a.PgaLogin||a.dialog("PgaLogin",(function(){return{main:function(e,t){this.set({title:e,url:t})},build:function(){a.pgDialogBuild.apply(this)},settings:{url:void 0},setup:function(){return{buttons:[{text:e("Close"),key:27,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button",attrs:{name:"close",type:"button"}}],options:{padding:!1,overflow:!1,modal:!0,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,closable:!1}}},hooks:{onclose:function(){return setTimeout((function(){return a.PgaLogin().destroy()}))}},prepare:function(){var e=this,t=document.createElement("iframe"),n=this.setting("url");t.onload=function(){-1==(this.contentDocument||this.contentWindow.document).location.href.indexOf(n)&&(this.contentWindow.stop(),this.onload=null,e.close(),r.Events.trigger("pgadmin:user:logged-in"))},t.frameBorder="no",t.width="100%",t.height="100%",t.src=n,e.elements.content.appendChild(t)}}})),a.PgaLogin(i,n).resizeTo(r.stdW.md,r.stdH.md)},show_users:function(){if(c.is_admin){var d=[],p=r.Node.Model.extend({idAttribute:"id",urlRoot:u,defaults:{id:void 0,email:void 0,active:!0,role:void 0,newPassword:void 0,confirmPassword:void 0},schema:[{id:"email",label:e("Email"),type:"text",cell:s.Extension.StringDepCell,cellHeaderClasses:"width_percent_30",deps:["id"],editable:function(e){return!(e instanceof o.Collection)&&!!e.isNew()}},{id:"role",label:e("Role"),type:"text",control:"Select2",cellHeaderClasses:"width_percent_20",cell:"select2",select2:{allowClear:!1,openOnEnter:!1},options:function(e){var t=[];return e instanceof l.Control?i.each(d,(function(e){t.push({label:e.name,value:e.id.toString()})})):i.each(d,(function(e){t.push([e.name,e.id.toString()])})),t},editable:function(e){return e instanceof o.Collection||e.get("id")!=c.id}},{id:"active",label:e("Active"),type:"switch",cell:"switch",cellHeaderClasses:"width_percent_10",editable:function(e){return e instanceof o.Collection||e.get("id")!=c.id}},{id:"newPassword",label:e("New password"),type:"password",disabled:!1,control:"input",cell:"password",cellHeaderClasses:"width_percent_20"},{id:"confirmPassword",label:e("Confirm password"),type:"password",disabled:!1,control:"input",cell:"password",cellHeaderClasses:"width_percent_20"}],validate:function(){var t=null,n=this.changed||{};if(("email"in n||!this.isNew())&&(i.isUndefined(this.get("email"))||i.isNull(this.get("email"))||""==String(this.get("email")).replace(/^\s+|\s+$/g,"")))return t=e("Email address cannot be empty."),this.errorModel.set("email",t),t;if(this.get("email")&&!/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(this.get("email")))return t=e("Invalid email address: %s.",this.get("email")),this.errorModel.set("email",t),t;if(this.get("email")&&this.collection.where({email:this.get("email")}).length>1)return t=e("The email address %s already exists.",this.get("email")),this.errorModel.set("email",t),t;if(this.errorModel.unset("email"),"role"in n&&(i.isUndefined(this.get("role"))||i.isNull(this.get("role"))||""==String(this.get("role")).replace(/^\s+|\s+$/g,"")))return t=e("Role cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("role",t),t;if(this.errorModel.unset("role"),this.isNew()){if("newPassword"in n&&(i.isUndefined(this.get("newPassword"))||i.isNull(this.get("newPassword"))||""==this.get("newPassword")))return t=e("Password cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("newPassword",t),t;if(!i.isUndefined(this.get("newPassword"))&&!i.isNull(this.get("newPassword"))&&this.get("newPassword").length<6)return t=e("Password must be at least 6 characters for user %s.",this.get("email")||""),this.errorModel.set("newPassword",t),t;if(this.errorModel.unset("newPassword"),"confirmPassword"in n&&(i.isUndefined(this.get("confirmPassword"))||i.isNull(this.get("confirmPassword"))||""==this.get("confirmPassword")))return t=e("Confirm Password cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;if(this.errorModel.unset("confirmPassword"),this.get("newPassword")&&this.get("confirmPassword")&&this.get("newPassword")!=this.get("confirmPassword"))return t=e("Passwords do not match for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;this.errorModel.unset("confirmPassword")}else if((i.isUndefined(this.get("newPassword"))||i.isNull(this.get("newPassword"))||""==this.get("newPassword"))&&(i.isUndefined(this.get("confirmPassword"))||i.isNull(this.get("confirmPassword"))||""==this.get("confirmPassword")))this.errorModel.unset("newPassword"),""==this.get("newPassword")&&this.set({newPassword:void 0}),this.errorModel.unset("confirmPassword"),""==this.get("confirmPassword")&&this.set({confirmPassword:void 0});else{if(!i.isUndefined(this.get("newPassword"))&&!i.isNull(this.get("newPassword"))&&""==!this.get("newPassword")&&this.get("newPassword").length<6)return t=e("Password must be at least 6 characters for user %s.",this.get("email")||""),this.errorModel.set("newPassword",t),t;if(i.isUndefined(this.get("confirmPassword"))||i.isNull(this.get("confirmPassword"))||""==this.get("confirmPassword"))return t=e("Confirm Password cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;if(this.get("newPassword")&&this.get("confirmPassword")&&this.get("newPassword")!=this.get("confirmPassword"))return t=e("Passwords do not match for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;this.errorModel.unset("newPassword"),this.errorModel.unset("confirmPassword")}return null}}),h=l.generateGridColumnsFromModel(null,p,"edit"),_=s.Extension.DeleteCell.extend({deleteRow:function(t){var n=this;if(t.preventDefault(),n.model.get("id")==c.id)return a.alert(e("Cannot delete user."),e("Cannot delete currently logged in user."),(function(){return!0})),!0;!(!i.isUndefined(this.column.get("canDeleteRow"))&&i.isFunction(this.column.get("canDeleteRow")))||s.callByNeed(this.column.get("canDeleteRow"),this.column,this.model)?n.model.isNew()?n.model.destroy():a.confirm(e("Delete user?"),e("Are you sure you wish to delete this user?"),(function(){n.model.destroy({wait:!0,success:function(){a.success(e("User deleted."))},error:function(){a.error(e("Error during deleting user."))}})}),(function(){return!0})):a.alert(e("Error"),e("This user cannot be deleted."),(function(){return!0}))}});h.columns.unshift({name:"pg-backform-delete",label:"",cell:_,editable:!1,cell_priority:-1,canDeleteRow:!0}),a.UserManagement||a.dialog("UserManagement",(function(){return{main:function(e){this.set("title",e)},build:function(){a.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-secondary pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:e("Users"),url:t("help.static",{filename:"user_management.html"})}},{text:e("Close"),key:27,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button user_management_pg-alertify-button",attrs:{name:"close",type:"button"}}],options:{title:e("User Management"),padding:!1,overflow:!1,modal:!1,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,closable:!1}}},hooks:{onclose:function(){this.view&&(this.view.remove({data:!0,internal:!0,silent:!0}),this.$content.remove())}},prepare:function(){var t=i.template(['<div class="pg-prop-footer" style="visibility:hidden;">',' <div class="pg-prop-status-bar">','    <div class="error-in-footer"> ','      <div class="d-flex px-2 py-1"> ','        <div class="pr-2"> ','          <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i> ',"        </div> ",'        <div class="alert-text" role="status></div> ','        <div class="ml-auto close-error-bar"> ','          <a class="close-error fa fa-times text-danger"></a> ',"        </div> ","      </div> ","    </div> "," </div>","</div>"].join("\n")),r=n(t()),l=s.Row.extend({userInvalidClass:"bg-user-invalid",initialize:function(){s.Row.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"pgadmin:user:invalid",this.userInvalid),this.listenTo(this.model,"pgadmin:user:valid",this.userValid)},userInvalid:function(){n(this.el).removeClass("new"),n(this.el).addClass(this.userInvalidClass)},userValid:function(){n(this.el).removeClass(this.userInvalidClass)}}),c=o.Collection.extend({model:p,url:u,initialize:function(){o.Collection.prototype.initialize.apply(this,arguments);var e=this;e.changedUser=null,e.invalidUsers={},e.on("add",e.onModelAdd),e.on("remove",e.onModelRemove),e.on("pgadmin-session:model:invalid",(function(t,n){e.invalidUsers[n.cid]=t,n.trigger("pgadmin:user:invalid",n),r.find(".alert-text").html(t),r.css("visibility","visible")})),e.on("pgadmin-session:model:valid",(function(t){delete e.invalidUsers[t.cid],t.trigger("pgadmin:user:valid",t),this.updateErrorMsg(),this.saveUser(t)}))},onModelAdd:function(e){e.startNewSession()},onModelRemove:function(e){delete this.invalidUsers[e.cid],this.updateErrorMsg()},updateErrorMsg:function(){var e=null;for(var t in this.invalidUsers)if(e=this.invalidUsers[t])break;e?(r.find(".alert-text").html(e),r.css("visibility","visible")):(r.find(".alert-text").empty(),r.css("visibility","hidden"))},saveUser:function(t){var n=t.toJSON(!0);return!(t.isNew()&&!(t.get("email")&&t.get("role")&&t.get("newPassword")&&t.get("confirmPassword")&&t.get("newPassword")==t.get("confirmPassword")))&&(!(!t.isNew()&&t.get("newPassword")!=t.get("confirmPassword"))&&void(t.sessChanged()&&n&&!i.isEmpty(n)&&(t.stopSession(),t.save({},{attrs:n,wait:!0,success:function(){t.set({newPassword:void 0,confirmPassword:void 0}),t.startNewSession(),a.success(e("User '%s' saved.",t.get("email")))},error:function(n,i){t.startNewSession(),a.error(e("Error saving user: '%s'",i.responseJSON.errormsg))}}))))}}),_=this.userCollection=new c,g=i.template('<div class="navtab-inline-controls">\n                    <div class="input-group">\n                      <div class="input-group-prepend">\n                        <span class="input-group-text fa fa-search" id="labelSearch"></span>\n                        </div>\n                          <input type="search" class="form-control" id="txtGridSearch" placeholder="Search" aria-label="Search" aria-describedby="labelSearch" />\n                        </div>\n                        <button id="btn_refresh" type="button" class="btn btn-secondary btn-navtab-inline add" title="Add">\n                          <span class="fa fa-plus "></span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>'),m={canAdd:!0,add_title:e("Add new user")},b=n("<div></div>",{class:"user_container flex-grow-1"});n.ajax({url:f,method:"GET",async:!1}).done((function(e){d=e})).fail((function(){setTimeout((function(){a.alert(e("Error"),e("Cannot load user roles."))}),100)}));var v,y=this.view=new s.Grid({row:l,columns:h.columns,collection:_,className:"backgrid table table-bordered table-noouter-border table-bottom-border table-hover"});b.append(y.render().$el[0]),this.$content=n("<div class='user_management object subnode subnode-noouter-border d-flex flex-column'></div>").append(g(m)).append(b).append(r),this.elements.content.appendChild(this.$content[0]),(v=_,new s.Extension.ClientSideFilter({collection:v,placeholder:i("Filter by email"),wait:150})).setCustomSearchBox(n("#txtGridSearch")),_.fetch(),this.$content.find("a.close-error").on("click",(function(){r.find(".alert-text").empty(),r.css("visibility","hidden")})),this.$content.find("button.add").first().on("click",(function(e){e.preventDefault();var t,i=!1,a=null;if(_.each((function(e){i||(i=e.isNew(),a=e)})),i){t=_.indexOf(a);var r=y.body.rows[t].$el;return r.addClass("new"),n(r).pgMakeVisible("backform-tab"),!1}n(y.body.$el.find(n("tr.new"))).removeClass("new");var o=new p(null,{handler:_,top:_,collection:_});_.add(o),t=_.indexOf(o);var s=y.body.rows[t].$el;return s.addClass("new"),n(s).pgMakeVisible("backform-tab"),!1}))},callback:function(t){if("dialog_help"==t.button.element.name)return t.cancel=!0,void r.showHelp(t.button.element.name,t.button.element.getAttribute("url"),null,null);if("close"==t.button.element.name){var n=this;i.all(this.userCollection.pluck("id"))&&i.isEmpty(this.userCollection.invalidUsers)||(t.cancel=!0,a.confirm(e("Discard unsaved changes?"),e("Are you sure you want to close the dialog? Any unsaved changes will be lost."),(function(){return n.close(),!0}),(function(){return!0})))}}}})),a.UserManagement(!0).resizeTo(r.stdW.md,r.stdH.md)}}},r.UserManagement}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";n(4),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.httpResponseRequiresNewTransaction=r,t.handleLoginRequiredAndTransactionRequired=o,t.handleQueryToolAjaxError=function(e,t,n,i,r,s){if(0===n.readyState)return(0,a.default)("Not connected to the server or the connection to the server has been closed.");o(e,t,n,i,r,s);var l=n.responseText;void 0!==n.responseJSON&&(void 0!==n.responseJSON.errormsg&&(l=n.responseJSON.errormsg),503===n.status&&void 0!==n.responseJSON.info&&"CONNECTION_LOST"==n.responseJSON.info&&setTimeout((function(){i&&t.saveState(i,r),t.handle_connection_lost(!1,n)})));return l};var i,a=(i=n(2))&&i.__esModule?i:{default:i};function r(e){return void 0===e.responseJSON&&void 0!==e.data?404===e.status&&e.data&&e.data.info&&"DATAGRID_TRANSACTION_REQUIRED"===e.data.info:404===e.status&&e.responseJSON&&e.responseJSON.info&&"DATAGRID_TRANSACTION_REQUIRED"===e.responseJSON.info}function o(e,t,n,i,a,o){return a=a&&a.length>0?a:[],e.Browser.UserManagement.isPgaLoginRequired(n)?(i&&t.saveState(i,a),e.Browser.UserManagement.pgaLogin()):o&&r(n)?(i&&t.saveState(i,a),t.initTransaction()):void 0}},,,,,,function(e,t,n){"use strict";(function(e){n(19),n(26),n(27),n(38),n(8),n(42),n(17),n(21),n(15),n(118),n(62),n(4),n(31),n(63),n(41),n(12),n(5),n(23),n(9),n(29),n(74),n(50),n(20),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.isValidTreeNodeData=t.Tree=t.TreeNode=void 0;var i=n(22),a=o(n(0)),r=o(n(13));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}var p=function(){function e(t,n,i,a){c(this,e),this.id=t,this.data=n,this.setParent(a),this.children=[],this.domNode=i}return f(e,[{key:"hasParent",value:function(){return null!==this.parentNode&&void 0!==this.parentNode}},{key:"parent",value:function(){return this.parentNode}},{key:"setParent",value:function(e){this.parentNode=e,this.path=this.id,null!=e&&void 0!==e.path&&(this.path=e.path+"."+this.id)}},{key:"getData",value:function(){if(void 0!==this.data)return null===this.data?null:Object.assign({},this.data)}},{key:"getHtmlIdentifier",value:function(){return this.domNode}},{key:"reload",value:function(e){var t=this;this.unload(e),e.aciTreeApi.setInode(this.domNode),e.aciTreeApi.deselect(this.domNode),setTimeout((function(){e.selectNode(t.domNode)}),0)}},{key:"unload",value:function(e){this.children=[],e.aciTreeApi.unload(this.domNode)}},{key:"ancestorNode",value:function(e){for(var t=this;t.hasParent();)if(e(t=t.parent()))return t;return null}},{key:"anyFamilyMember",value:function(e){return!!e(this)||null!==this.ancestorNode(e)}},{key:"anyParent",value:function(e){return null!==this.ancestorNode(e)}}]),e}();t.TreeNode=p;var h=function(){function t(){c(this,t),this.rootNode=new p(void 0,{}),this.aciTreeApi=void 0,this.draggableTypes={}}return f(t,[{key:"registerDraggableType",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"object"==d(e)?Object.keys(e).forEach((function(n){t.registerDraggableType(n,e[n])})):null!=n&&e.replace(/ +/," ").split(" ").forEach((function(e){t.draggableTypes[e]=n}))}},{key:"getDraggable",value:function(e){return this.draggableTypes[e]?this.draggableTypes[e]:null}},{key:"prepareDraggable",value:function(t,n){var i=this.getDraggable(t._type);null!=i&&n.find(".aciTreeItem").attr("draggable",!0)[0].addEventListener("dragstart",(function(r){var o=i(t,n);if("string"==typeof o?o={text:o,cur:{from:o.length,to:o.length}}:o.cur||(o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o,{cur:{from:o.text.length,to:o.text.length}})),r.dataTransfer.setData("text",JSON.stringify(o)),r.dataTransfer.dropEffect&&(r.dataTransfer.dropEffect="move"),r.dataTransfer.setDragImage){var d=(0,a.default)('\n              <div class="drag-tree-node">\n                <span>'.concat(e.escape(o.text),"</span>\n              </div>"));(0,a.default)("body .drag-tree-node").remove(),(0,a.default)("body").append(d),r.dataTransfer.setDragImage(d[0],0,0)}}))}},{key:"addNewNode",value:function(e,t,n,i){var a=this.findNode(i);return this.createOrUpdateNode(e,t,a,n)}},{key:"findNode",value:function(e){return null==e||0===e.length?this.rootNode:function(e,t){if(null===t)return e;return function e(n){if(void 0!==n.path&&void 0!==t&&!t.startsWith(n.path))return null;for(var i=0,a=n.children.length;i<a;i++){var r=e(n.children[i]);if(null!==r)return r}return n.path===t?n:null}(e)}(this.rootNode,e.join("."))}},{key:"findNodeByDomElement",value:function(e){var t=this.translateTreeNodeIdFromACITree(e);if(t&&t[0])return this.findNode(t)}},{key:"selected",value:function(){return this.aciTreeApi.selected()}},{key:"selectNode",value:function(e){this.aciTreeApi.select(e)}},{key:"createOrUpdateNode",value:function(e,t,n,i){var a=[e];null!=n&&(a=[n.path,e]);var r=this.findNode(a);if(null!==r)return r.data=t,r;var o=new p(e,t,i,n);return n===this.rootNode&&(o.parentNode=null),n.children.push(o),o}},{key:"register",value:function(e){e.on("acitree",function(e,t,n,i){if(t.isItem(n)&&("added"===i||"idset"===i)){var a=t.getId(n),o=t.itemData(n);"added"===i&&this.prepareDraggable(o,n);var s=this.translateTreeNodeIdFromACITree(t.parent(n));this.addNewNode(a,o,n,s),o.errmsg&&r.default.error(o.errmsg)}}.bind(this)),this.aciTreeApi=e.aciTree("api")}},{key:"translateTreeNodeIdFromACITree",value:function(e){for(var t=e,n=[];null!=t&&t.length>0&&(n.unshift(this.aciTreeApi.getId(t)),this.aciTreeApi.hasParent(t));)t=this.aciTreeApi.parent(t);return n}}]),t}();t.Tree=h;var _=i.isValidData;t.isValidTreeNodeData=_}).call(this,n(1))},,,,function(e,t){e.exports=n},,,,function(e,t){e.exports=i},function(e,t,n){"use strict";n(28),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.showQueryTool=function(e,t,n,s,l,d){var c=s||"",u=function(e,t){return(0,o.getPanelTitle)(e,t)}(t,l);if(void 0===t.treeMenu.findNodeByDomElement(l))return void n.alert((0,i.default)("Query Tool Error"),(0,i.default)("No object selected."));var f=r.getTreeNodeHierarchyFromIdentifier.call(t,l);if(function(e){return void 0===e.server}(f))return;var p=function(e,t,n){var i=(0,a.default)("datagrid.panel",{trans_id:e});i+="?is_query_tool=".concat(!0)+"&sgid=".concat(n.server_group._id)+"&sid=".concat(n.server._id)+"&server_type=".concat(n.server.server_type),function(e){return e.database}(n)&&(i+="&did=".concat(n.database._id));return i}(d,0,f);e.launch_grid(d,p,!0,u,c)},t.generateScript=function(e,t){var n="".concat(e.database,"/").concat(e.user,"@").concat(e.server),i=(0,s.getRandomInt)(1,9999999),r=(0,a.default)("datagrid.panel",{trans_id:i});r+="?is_query_tool=".concat(!0)+"&sgid=".concat(e.sgid)+"&sid=".concat(e.sid)+"&server_type=".concat(e.stype)+"&did=".concat(e.did),t.launch_grid(i,r,!0,n,"")};var i=l(n(2)),a=l(n(6)),r=n(53),o=n(76),s=n(22);function l(e){return e&&e.__esModule?e:{default:e}}},,,,,,,,,,,,,,function(e,t,n){"use strict";n(56),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.showOnScroll){var t=i.default.fn.select2.amd.require("select2/utils"),n=function(e,t){this.$element=e,this.options=t,this._dataToConvert=t.get("data")||[]},r=null;r=null!=e.data?i.default.fn.select2.amd.require("select2/data/array"):i.default.fn.select2.amd.require("select2/data/select"),t.Extend(n,r),n.prototype.query=function(e,t){var n=[],a=this;e.page||(e.page=1);this.$element.children().each((function(){var t=(0,i.default)(this);if(t.is("option")||t.is("optgroup")){var r=a.item(t),o=a.matches(e,r);null!==o&&n.push(o)}})),t({results:n.slice(20*(e.page-1),20*e.page),pagination:{more:n.length>=20*e.page}})},e.minimumInputLength>0&&(n=t.Decorate(n,i.default.fn.select2.amd.require("select2/data/minimumInputLength"))),e.maximumInputLength>0&&(n=t.Decorate(n,i.default.fn.select2.amd.require("select2/data/maximumInputLength"))),e.maximumSelectionLength>0&&(n=t.Decorate(n,i.default.fn.select2.amd.require("select2/data/maximumSelectionLength"))),e.tags&&(n=t.Decorate(n,i.default.fn.select2.amd.require("select2/data/tags"))),null==e.tokenSeparators&&null==e.tokenizer||(n=t.Decorate(n,i.default.fn.select2.amd.require("select2/data/tokenizer"))),e.dataAdapter=n,a.default.isUndefined(e.ajax)&&(e.ajax={})}return e},n(104);var i=r(n(0)),a=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}},,function(e,t,n){"use strict";n(4),n(5),n(9),Object.defineProperty(t,"__esModule",{value:!0}),t.getHelpUrl=function(e,t,n){var i=Math.floor(n/1e4),a=Math.floor(n/100)-100*i,r="";r=i>=10?e.replace("$VERSION$",i):e.replace("$VERSION$",i+"."+a);"/"!=r.substr(-1)&&(r+="/");return r+t}},,,function(e,t,n){"use strict";n(28);var i,a=(i=n(1))&&i.__esModule?i:{default:i};e.exports={generate_url:function(e,t,n,i,r,o){var s="";return a.default.each(a.default.sortBy(a.default.pick(t,r),(function(e){return e.priority})),(function(e){s="".concat(s,"/").concat(encodeURI(e._id))})),s=o?"".concat(s,"/").concat(o):"".concat(s,"/"),"".concat(e).concat(i,"/").concat(n).concat(s)}}},,function(e,t,n){"use strict";n(19),n(26),n(27),n(8),n(189),n(16),n(122),n(17),n(21),n(47),n(32),n(4),n(12),n(5),n(43),n(23),n(61),n(29),n(20),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.browserTreeState=t.pgBrowser=void 0;var i=l(n(1)),a=l(n(0)),r=l(n(6)),o=l(n(2)),s=l(n(3));function l(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=s.default.Browser=s.default.Browser||{};t.pgBrowser=c;var u=c.browserTreeState=c.browserTreeState||{};t.browserTreeState=u,i.default.extend(c.browserTreeState,{parent:"server",orig_parent:"server_group",stored_state:{},last_state:{},current_state:{},init:function(){var e=c.get_preference("browser","browser_tree_state_save_interval");i.default.isUndefined(e)||-1===e.value?i.default.isUndefined(e)||a.default.ajax({url:(0,r.default)("settings.reset_tree_state"),type:"DELETE"}).fail((function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}console.warn((0,o.default)('Error resetting the tree saved state."'),t)})):(setInterval(this.save_state,1e3*e.value),this.fetch_state.apply(this),c.Events.on("pgadmin:browser:tree:expand-from-previous-tree-state",this.expand_from_previous_state,this),c.Events.on("pgadmin:browser:tree:remove-from-tree-state",this.remove_from_cache,this),c.Events.on("pgadmin:browser:tree:update-tree-state",this.update_cache,this))},save_state:function(){var e=c.browserTreeState;e.last_state!=JSON.stringify(e.current_state)&&a.default.ajax({url:(0,r.default)("settings.save_tree_state"),type:"POST",contentType:"application/json",data:JSON.stringify(e.current_state)}).done((function(){e.last_state=JSON.stringify(e.current_state)})).fail((function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}console.warn((0,o.default)('Error saving the tree state."'),t)}))},fetch_state:function(){var e=this;a.default.ajax({url:(0,r.default)("settings.get_tree_state"),type:"GET",dataType:"json",contentType:"application/json"}).done((function(t){e.stored_state=t})).fail((function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}console.warn((0,o.default)("Error fetching the tree state."),t)}))},update_cache:function(e){var t,n=e&&c.tree.itemData(e),a=(n&&c.Nodes[n._type]).getTreeNodeHierarchy(e),r=c.tree.pathId(e),o=r.join(),s=[],l=-1;if(c.tree.hasParent(e)&&this.parent in a){if(t=a[this.parent]._id,c.tree.isOpen(e)){r.push(n.id),s=r.join(),t in this.current_state||(this.current_state[t]={paths:[],selected:{},conn_status:{},is_opened:{}});var d=i.default.find(this.current_state[t].paths,(function(e){return-1!==e.search(s)}));i.default.isUndefined(d)&&(i.default.isUndefined(this.current_state[t].paths)?this.current_state[t].paths=[]:l=this.current_state[t].paths.indexOf(o),-1!==l?this.current_state[t].paths[l]=s:this.current_state[t].paths.push(s))}this.update_database_status(e),this.update_current_selected_item(a)}},remove_from_cache:function(e){var t=this,n=t.stored_state||{},a=e&&c.tree.itemData(e),r=a&&c.Nodes[a._type],o=r&&r.getTreeNodeHierarchy(e);if(null!==o&&c.tree.hasParent(e)&&t.parent in o){var s=o&&o[t.parent]._id,l=o&&o[t.orig_parent].id;if(this.update_database_status(e),a._type!=t.parent&&"database"!=a._type){if(c.tree.isClosed(e)){var d=t.current_state[s].paths,u=void 0;if("database"in o&&(u=o.database.id),!i.default.isUndefined(d)&&!i.default.isUndefined(d.length)){var f=0,p=void 0;i.default.each(d,(function(e){if(!i.default.isUndefined(e)){var n=e.split(",");if(-1!==n.indexOf(a.id)&&(void 0===u||void 0!==u&&-1!==n.indexOf(u))){var r=n.indexOf(a.id);n.splice(r),(p=n.join())==l?t.current_state[s].paths.splice(e,1):t.current_state[s].paths[f]=p}f++}}))}}}else s in n&&"paths"in n[s]&&(n[s].paths=t.current_state[s].paths,t.save_state())}},expand_from_previous_state:function(e){var t=this,n=t.stored_state||{},a=e&&c.tree.itemData(e),r=a&&c.Nodes[a._type],o=r&&r.getTreeNodeHierarchy(e);if(null!==o&&c.tree.hasParent(e)&&t.parent in o&&(a._type!=t.parent||!1!==c.tree.isOpen(e))){var s=n[o[t.parent]._id];if(!("database"==a._type&&s&&"conn_status"in s&&"is_opened"in s)||0!==s.conn_status[a.id]&&0!==s.is_opened[a.id]&&a.id in s.is_opened){if(!i.default.isUndefined(s)&&"paths"in s&&!i.default.isUndefined(s.paths.length)){var l=d(s.paths),u=void 0;"database"in o&&(u=o.database.id),i.default.each(l,(function(r){if(!i.default.isUndefined(r)){var s=r.split(",");if(-1!==s.indexOf(a.id)&&(void 0===u||void 0!==u&&-1!==s.indexOf(u))){var l=s.indexOf(a.id);if(c.tree.toggle(e),l==s.length-1){var d=n[o[t.parent]._id].paths.indexOf(r);n[o[t.parent]._id].paths.splice(d,1)}}}}))}this.select_tree_item(e)}}},update_database_status:function(e){var t=e&&c.tree.itemData(e),n=(t&&c.Nodes[t._type]).getTreeNodeHierarchy(e);if("database"in n){var i=n.database.id,a=n&&n[this.parent]._id;a in this.current_state&&"selected"in this.current_state[a]&&(n.database.connected?this.current_state[a].conn_status[i]=1:this.current_state[a].conn_status[i]=0,"database"==t._type&&(c.tree.isOpen(e)?this.current_state[a].is_opened[i]=1:this.current_state[a].is_opened[i]=0))}},update_current_selected_item:function(e){if(this.parent in e){var t=e&&e[this.parent]._id,n=c.tree.itemData(c.tree.selected()),a=void 0;n=n?n.id:void 0,"database"in e&&(a=e.database.id),t in this.current_state&&"selected"in this.current_state[t]&&!i.default.isUndefined(n)&&(this.current_state[t].selected[e[this.parent].id]=n,i.default.isUndefined(a)||(this.current_state[t].selected[a]=n))}},select_tree_item:function(e){var t=this.stored_state||{},n=e&&c.tree.itemData(e),i=n&&c.Nodes[n._type],a=i&&i.getTreeNodeHierarchy(e),r=t[a[this.parent]._id];if("database"in a){var o=a.database.id;r&&"selected"in r&&o in r.selected&&r.selected[o]==n.id&&c.tree.select(e)}}})},,,function(e,t,n){"use strict";var i,a,r;n(16),n(7),(r=r||{}).dashboard=n(151),(r=r||{}).tools=r.tools||{},r.tools.user_management=n(110),(r=r||{}).browser=r.browser||{},r.browser.object_statistics=n(154),(r=r||{}).browser=r.browser||{},r.browser.dependencies=n(157),(r=r||{}).browser=r.browser||{},r.browser.dependents=n(158),(r=r||{}).browser=r.browser||{},r.browser.object_sql=n(159),(r=r||{}).browser=r.browser||{},r.browser.bgprocess=n(160),(r=r||{}).node=r.node||{},r.node.server_group=n(239),(r=r||{}).node=r.node||{},r.node.server=n(124),(r=r||{}).node=r.node||{},r.node.database=n(240),(r=r||{}).node=r.node||{},r.node.role=n(241),(r=r||{}).node=r.node||{},r.node.cast=n(242),(r=r||{}).node=r.node||{},r.node.tablespace=n(243),(r=r||{}).node=r.node||{},r.node.resource_group=n(244),(r=r||{}).node=r.node||{},r.node.event_trigger=n(245),(r=r||{}).node=r.node||{},r.node.extension=n(246),(r=r||{}).node=r.node||{},r.node.language=n(247),(r=r||{}).node=r.node||{},r.node.foreign_data_wrapper=n(248),(r=r||{}).node=r.node||{},r.node.foreign_server=n(249),(r=r||{}).node=r.node||{},r.node.user_mapping=n(250),(r=r||{}).node=r.node||{},r.node.schema=n(251),(r=r||{}).node=r.node||{},r.node.catalog=n(252),(r=r||{}).node=r.node||{},r.node.catalog_object=n(253),(r=r||{}).node=r.node||{},r.node.collation=n(254),(r=r||{}).node=r.node||{},r.node.domain=n(255),(r=r||{}).node=r.node||{},r.node.domain_constraints=n(256),(r=r||{}).node=r.node||{},r.node.foreign_table=n(257),(r=r||{}).node=r.node||{},r.node.fts_configuration=n(258),(r=r||{}).node=r.node||{},r.node.fts_dictionary=n(259),(r=r||{}).node=r.node||{},r.node.fts_parser=n(260),(r=r||{}).node=r.node||{},r.node.fts_template=n(261),(r=r||{}).node=r.node||{},r.node.function=n(196),(r=r||{}).node=r.node||{},r.node.procedure=n(262),(r=r||{}).node=r.node||{},r.node.edbfunc=n(197),(r=r||{}).node=r.node||{},r.node.edbproc=n(263),(r=r||{}).node=r.node||{},r.node.edbvar=n(264),(r=r||{}).node=r.node||{},r.node.trigger_function=n(265),(r=r||{}).node=r.node||{},r.node.package=n(266),(r=r||{}).node=r.node||{},r.node.sequence=n(267),(r=r||{}).node=r.node||{},r.node.synonym=n(268),(r=r||{}).node=r.node||{},r.node.type=n(269),(r=r||{}).node=r.node||{},r.node.rule=n(198),(r=r||{}).node=r.node||{},r.node.index=n(270),(r=r||{}).node=r.node||{},r.node.trigger=n(271),(r=r||{}).node=r.node||{},r.node.catalog_object_column=n(272),(r=r||{}).node=r.node||{},r.node.view=n(273),(r=r||{}).node=r.node||{},r.node.mview=n(274),(r=r||{}).node=r.node||{},r.node.table=n(275),(r=r||{}).node=r.node||{},r.node.partition=n(278),(r=r||{}).node=r.node||{},r.node.compound_trigger=n(279),i=[n(2),n(6),n(0),n(1),n(13),n(3),n(75),n(57),n(14),n(162),n(126),n(107),n(76),n(22),n(58)],void 0===(a=function(e,t,n,i,a,r,o,s,l,d,c,u,f,p){var h=window.wcDocker,_=r.Browser;return r.DataGrid?r.DataGrid:(r.DataGrid=i.extend({init:function(){if(!this.initialized){this.initialized=!0,this.title_index=1;var t=this,n=setInterval((function(){_.preference_version()>0&&(t.preferences=_.get_preferences_for_module("sqleditor"),clearInterval(n))}),0);_.onPreferencesChange("sqleditor",(function(){t.preferences=_.get_preferences_for_module("sqleditor")}));for(var a=["table","view","mview","foreign_table","catalog_object","partition"],o=function(t){var n=!i.isUndefined(t)&&!i.isNull(t)&&-1!==i.indexOf(a,t._type);return u.enable(e("View Data"),n),u.enable(e("Filtered Rows"),n),n},s=[{name:"query_tool",module:this,applies:["tools"],callback:"show_query_tool",enable:function(t){var n=!(i.isUndefined(t)||i.isNull(t)||-1!=i.indexOf(r.unsupported_nodes,t._type)||("database"!=t._type||!t.allowConn)&&"database"==t._type);return u.enable(e("Query Tool"),n),n},priority:1,label:e("Query Tool"),icon:"pg-font-icon icon-query-tool"}],l=0;l<a.length;l++)s.push({name:"view_all_rows_context_"+a[l],node:a[l],module:this,data:{mnuid:3},applies:["context","object"],callback:"show_data_grid",enable:o,category:"view_data",priority:101,label:e("All Rows")},{name:"view_first_100_rows_context_"+a[l],node:a[l],module:this,data:{mnuid:1},applies:["context","object"],callback:"show_data_grid",enable:o,category:"view_data",priority:102,label:e("First 100 Rows")},{name:"view_last_100_rows_context_"+a[l],node:a[l],module:this,data:{mnuid:2},applies:["context","object"],callback:"show_data_grid",enable:o,category:"view_data",priority:103,label:e("Last 100 Rows")},{name:"view_filtered_rows_context_"+a[l],node:a[l],module:this,data:{mnuid:4},applies:["context","object"],callback:"show_filtered_row",enable:o,category:"view_data",priority:104,label:e("Filtered Rows...")});r.Browser.add_menu_category("view_data",e("View/Edit Data"),100,""),r.Browser.add_menus(s),new r.Browser.Frame({name:"frm_datagrid",showTitle:!0,isCloseable:!0,isPrivate:!0,url:"about:blank"}).load(_.docker),this.on("pgadmin-datagrid:transaction:created",(function(e){this.launch_grid(e)}))}},show_data_grid:function(e,t){var n=p.getRandomInt(1,9999999);d.showDataGrid(this,_,a,e,t,n)},show_filtered_row:function(e,t){var n=p.getRandomInt(1,9999999);d.showDataGrid(this,_,a,e,t,n,!0,this.preferences)},show_query_tool:function(e,t){var n=p.getRandomInt(1,9999999);c.showQueryTool(this,_,a,e,t,n)},launch_grid:function(e,a,r,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=this,c='\n          <form id="queryToolForm" action="'.concat(a,'" method="post">\n            <input id="title" name="title" hidden />');if(s&&(c+='<input name="query_url" value="'.concat(s,'" hidden />')),l&&(c+='<textarea name="sql_filter" hidden>'.concat(l,"</textarea>")),c+='\n          </form>\n            <script>\n              document.getElementById("title").value = "'.concat(i.escape(o),'";\n              document.getElementById("queryToolForm").submit();\n            <\/script>\n          '),d.preferences.new_browser_tab){var u=window.open("","_blank");u.document.write(c),u.document.title=o}else{var p=_.docker.findPanels("properties"),g=_.docker.addPanel("frm_datagrid",h.DOCK.STACKED,p[0]);f.setQueryToolDockerTitle(g,r,i.unescape(o)),g.focus(),g.on(h.EVENT.CLOSED,(function(){n.ajax({url:t("datagrid.close",{trans_id:e}),method:"DELETE"})}));var m=function(e){var t=n('<div class="pg-sp-container">\n                    <div class="pg-sp-content">\n                        <div class="row">\n                            <div class="col-12 pg-sp-icon"></div>\n                        </div>\n                    </div>\n                </div>').appendTo(n(e).data("embeddedFrame").$container),i=setInterval((function(){if(n(e).data("frameInitialized")){clearInterval(i);var a=n(e).data("embeddedFrame");a&&(a.onLoaded((function(){t.remove()})),a.openHTML(c))}}),100)};m(g)}}},l.Events),r.DataGrid)}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(19),n(28),n(38),n(8),n(42),n(21),n(34),n(15),n(11),n(62),n(4),n(31),n(63),n(41),n(237),n(35),n(5),n(61),n(50),n(7),i=[n(6),n(2),n,n(0),n(1),n(3),n(14),n(60),n(152),n(13),n(18),n(153),n(22),n(33),n(10),n(119),n(58)],void 0===(a=function(e,t,i,a,r,s,l,d,c,u,f,p,h,_){s.Browser=s.Browser||{};var g=s.Browser;if(!s.Dashboard){var m,b,v=!0,y="",w="",x=!1,C=!1,S=!1,k=d.Extension.DeleteCell.extend({render:function(){this.$el.empty();var e=this;return"cancel"===e.column.get("cell_action")?this.$el.html("<i class='fa fa-stop' data-toggle='tooltip' title='"+t("Cancel the active query")+"' aria-label='"+t("Cancel the active query")+"'></i>"):this.$el.html("<i class='fa fa-times-circle text-danger' data-toggle='tooltip' title='"+t("Terminate the session")+"' aria-label='"+t("Terminate the session")+"'></i>"),this.$el.attr("tabindex",0),this.$el.on("keydown",(function(t){32==t.keyCode&&e.$el.click()})),this.delegateEvents(),this},deleteRow:function(e){var n,i,r,o,s,l=this.column.get("cell_action");if(e.preventDefault(),d.callByNeed(this.column.get("canDeleteRow"),this.column,this.model)){"cancel"===l?(n=t("Cancel Active Query?"),i=t("Are you sure you wish to cancel the active query?"),r=t("Active query cancelled successfully."),o=t("An error occurred whilst cancelling the active query."),s=y+this.model.get("pid")):(n=t("Terminate Session?"),i=t("Are you sure you wish to terminate the session?"),r=t("Session terminated successfully."),o=t("An error occurred whilst terminating the active query."),s=w+this.model.get("pid")),u.confirm(n,i,(function(){a.ajax({url:s,type:"DELETE"}).done((function(e){e==t("Success")?(u.success(r),a("#btn_refresh").trigger("click")):u.error(o)})).fail((function(e,t,n){u.pgRespErrorNotify(e,n)}))}),(function(){return!0}))}}}),T=d.Extension.ObjectCell.extend({enterEditMode:function(){this.model.trigger("enteringEditMode",[this]),d.Cell.prototype.enterEditMode.apply(this,arguments),this.delegateEvents();var e=d.callByNeed(this.column.editable(),this.column,this.model);e&&(this.$el.html("<i class='fa fa-caret-down subnode-edit-in-process'></i>"),this.model.trigger("pg-sub-node:opened",this.model,this))},render:function(){return this.$el.empty(),this.$el.html("<i class='fa fa-caret-right' data-toggle='tooltip' title='"+t("View the active session details")+"' aria-label='"+t("View the active session details")+"'></i>"),this.delegateEvents(),this.grabFocus&&this.$el.trigger("focus"),this}}),E=l.Model.extend({defaults:{version:null},schema:[{id:"backend_type",label:t("Backend type"),type:"text",editable:!0,disabled:!0,group:t("Details"),visible:function(){return this.version>=1e5}},{id:"query_start",label:t("Query started at"),type:"text",editable:!1,disabled:!0,group:t("Details")},{id:"state_change",label:t("Last state changed at"),type:"text",editable:!0,disabled:!0,group:t("Details")},{id:"query",label:t("SQL"),type:"text",editable:!0,disabled:!0,control:f.SqlFieldControl,group:t("Details")}]});return s.Dashboard={init:function(){if(!this.initialized){this.initialized=!0,this.sid=this.did=-1,this.version=-1;var n=this.object_selected.bind(this),i=this.object_disconnected.bind(this);g.Events.on("pgadmin-browser:tree:selected",n),g.Events.on("pgadmin:server:disconnect",i);var r=e("dashboard.index");this.chart_store={},this.charts_poller_int_id=-1;var o=g.panels.dashboard.panel;if(o){var s=o.layout().scene().find(".pg-panel-content");if(s){a(s).html('<div class="pg-panel-message" role="alert">'+t("Loading dashboard...")+"</div>"),function e(){a.ajax({url:r,type:"GET",dataType:"html"}).done((function(e){a(s).html(e)})).fail((function(n,i){u.pgNotifier(i,n,t("An error occurred whilst loading the dashboard."),(function(n){"CRYPTKEY_SET"===n?e():a(s).html('<div class="pg-panel-message" role="alert">'+t("An error occurred whilst loading the dashboard.")+"</div>")}))}))}(),a(o).data("sid",-1),a(o).data("did",-1)}}}},object_disconnected:function(){var e=g.tree.selected(),t=e&&g.tree.itemData(e);0!=e.length&&this.object_selected(e,t,g.Nodes[t._type])},object_selected:function(n,i,o){var s=this;if(!1===v)r.isUndefined(i.connected)||!0===i.connected||s.clearChartFromStore();else if(i&&i._type){var l=o.getTreeNodeHierarchy(n),d=p.url(i,n,l);if(null===d){d=e("dashboard.index"),s.version=l.server&&l.server.version||0,y=d+"cancel_query/",w=d+"terminate_session/";var c=l.server;b=c&&c.db||null,c&&c.user&&c.user.is_superuser?x=!0:(x=!1,m=c&&c.user?c.user.name:null),"database"in l?(s.sid=l.server._id,s.did=l.database._id,C=!1,S=!0,d+=s.sid+"/"+s.did,y+=s.sid+"/"+s.did+"/",w+=s.sid+"/"+s.did+"/"):"server"in l?(s.sid=l.server._id,s.did=-1,C=!0,S=!1,d+=s.sid,y+=s.sid+"/",w+=s.sid+"/"):C=S=!1}else C=S=!1;var f=g.panels.dashboard.panel;if(f){var h=f.layout().scene().find(".pg-panel-content");if(h){if(i.connected||r.isUndefined(i.connected)){if(d!==a(f).data("dashboard_url")||d===a(f).data("dashboard_url")&&0==a(f).data("server_status")){a(h).empty(),s.clearChartFromStore();a(h).html('<div class="pg-panel-message" role="alert">'+t("Loading dashboard...")+"</div>"),function e(){a.ajax({url:d,type:"GET",dataType:"html"}).done((function(e){a(h).html(e),s.init_dashboard()})).fail((function(n,i){u.pgNotifier(i,n,t("An error occurred whilst loading the dashboard."),(function(n){"CRYPTKEY_SET"===n?e():a(h).html('<div class="pg-panel-message" role="alert">'+t("An error occurred whilst loading the dashboard.")+"</div>")}))}))}(),a(f).data("server_status",!0)}}else a(h).empty(),r.isUndefined(i.connected)||!0===i.connected||s.clearChartFromStore(),a(h).html('<div class="pg-panel-message" role="alert">'+t("Please connect to the selected server to view the dashboard.")+"</div>"),a(f).data("server_status",!1);a(f).data("dashboard_url",d)}}}},renderCharts:function(e){var t=this,n=function(e,t){return"Seconds ago: ".concat(parseInt(t.x*e),"</br>\n                  Value: ").concat(t.y)},i=h.getEpoch();t.stopChartsPoller(),e.map((function(e){if(t.chart_store[e.chart_name]&&t.old_preferences[e.refresh_pref_name]!=t.preferences[e.refresh_pref_name]&&t.clearChartFromStore(e.chart_name),t.chart_store[e.chart_name]){var a=t.chart_store[e.chart_name].chart_obj;a.setOptions(e.options,!1),a.setTooltipFormatter(n.bind(null,t.preferences[e.refresh_pref_name]))}if(!t.chart_store[e.chart_name]){var r=new c.Chart(e.container,e.options);r.setTooltipFormatter(n.bind(null,t.preferences[e.refresh_pref_name])),r.setOtherData("counter",e.counter),t.chart_store[e.chart_name]={chart_obj:r,refresh_on:i,refresh_rate:t.preferences[e.refresh_pref_name]}}})),t.startChartsPoller(t.chart_store,t.sid,t.did)},getStatsUrl:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e("dashboard.dashboard_stats");return a+="/"+t,a+=n>0?"/"+n:"",a+="?chart_names="+i.join(",")},updateChart:function(e,t){var n=e.getOtherData("dataset")||[],i=e.getOtherData("counter_prev_data")||t,a=e.getOtherData("counter")||!1;if(0==n.length)for(var o in t)n.push({data:[[0,a?t[o]-i[o]:t[o]]],label:o});else Object.keys(t).map((function(e,o){if(a){if(r.isUndefined(i))return;n[o].data.unshift([0,t[e]-i[e]])}else n[o].data.unshift([0,t[e]]);for(var s=0;s<n[o].data.length;s++)n[o].data[s][0]=s})),i=t;for(var s=0;s<n.length;s++)n[s].data.length>101&&n[s].data.pop();e.setOtherData("dataset",n),e.setOtherData("counter_prev_data",i),e.isInPage()&&e.isVisible()&&e.draw(n)},stopChartsPoller:function(){clearInterval(this.charts_poller_int_id)},startChartsPoller:function(e,n,i){var o=this,s=h.getGCD(Object.values(e).map((function(e){return e.refresh_rate}))),l=0,d=0;o.stopChartsPoller();var c=function(){var s=h.getEpoch(),c=[];for(var u in e)e[u].refresh_on<=s&&(e[u].refresh_on=s+e[u].refresh_rate,c.push(u));if(0==c.length||l>0||d>=3)l--;else{var f=o.getStatsUrl(n,i,c);d++,a.ajax({url:f,type:"GET"}).done((function(t){for(var n in t){var i=e[n].chart_obj;a(i.getContainer()).removeClass("graph-error"),o.updateChart(i,t[n])}})).fail((function(n){var i="",o="info";for(var s in 0===n.readyState?i=t("Not connected to the server or the connection to the server has been closed."):(i=JSON.parse(n.responseText).errormsg,428===n.status?(r.isUndefined(i)||r.isNull(i))&&(i=t("Please connect to the selected server to view the graph.")):(i=t("An error occurred whilst rendering the graph."),o="error")),e){var l=e[s].chart_obj;a(l.getContainer()).addClass("graph-error"),a(l.getContainer()).html('<div class="pg-panel-'+o+' pg-panel-message" role="alert">'+i+"</div>")}})).always((function(){l=0,d--})),l=3}};c(),o.charts_poller_int_id=setInterval(c,1e3*s)},add_new_server:function(){if(g&&g.tree){for(var e=0!=g.tree.selected().length?g.tree.selected():g.tree.first(null,!1),t=n(124),i=g.tree.itemData(e);i&&"server_group"!=i._type;)e=g.tree.next(e),i=g.tree.itemData(e);if(!i)return;t&&t.callbacks.show_obj_properties.apply(t,[{action:"create"},e])}},render_grid:function(e,t,n){var i=l.Model.extend({}),r=t+this.sid;-1!=this.did&&(r+="/"+this.did);var o=new(l.Collection.extend({model:i,url:r,mode:"client"})),s=new d.Grid({emptyText:"No data found",columns:n,collection:o,className:"backgrid presentation table table-bordered table-noouter-border table-hover"});a(e).empty(),a(e).append(s.render().el);var c=new d.Extension.ClientSideFilter({collection:o});c.setCustomSearchBox(a("#txtGridSearch")),a(e).data("data",o),a(e).data("grid",s),a(e).data("filter",c)},render_grid_data:function(e){var n=a(e).data("data"),i=a(e).data("grid"),o=a(e).data("filter");if(r.isUndefined(n))return null;n.fetch({reset:!0,success:function(){a(e).hasClass("grid-error")&&(a(e).removeClass("grid-error"),a(e).html(i.render().el),a(o.el).show()),o.search()},error:function(i,l){var d="",c="info";0===l.readyState?d=t("Not connected to the server or the connection to the server has been closed."):(d=JSON.parse(l.responseText).errormsg,428===l.status?(r.isUndefined(d)||r.isNull(d))&&(d=t("Please connect to the selected server to view the table.")):(d=t("An error occurred whilst rendering the table."),c="error")),a(e).hasClass("grid-error")||(a(o.el).hide(),a(e).addClass("grid-error")),a(e).html('<div class="pg-panel-'+c+' pg-panel-message" role="alert">'+d+"</div>"),setTimeout((function(){s.Dashboard.render_grid_data(e,n)}),5e3)}})},clearChartFromStore:function(e){var t=this;e?delete t.chart_store[e]:(t.stopChartsPoller(),r.each(t.chart_store,(function(e,n){delete t.chart_store[n]})))},init_dashboard:function(){var e=this,t=setInterval((function(){try{_.default.pgAdmin.Browser.preference_version()>0&&(clearInterval(t),e.reflectPreferences())}catch(e){throw clearInterval(t),e}}),0);g.onPreferencesChange("dashboards",(function(){e.reflectPreferences()}))},reflectPreferences:function(){if(this.preferences?(this.old_preferences=this.preferences,this.preferences=_.default.pgAdmin.Browser.get_preferences_for_module("dashboards")):(this.preferences=_.default.pgAdmin.Browser.get_preferences_for_module("dashboards"),this.old_preferences=this.preferences),C||S){var e=a(".dashboard-container").find("#graph-sessions")[0],t=a(".dashboard-container").find("#graph-tps")[0],n=a(".dashboard-container").find("#graph-ti")[0],i=a(".dashboard-container").find("#graph-to")[0],r=a(".dashboard-container").find("#graph-bio")[0],l={parseFloat:!1,xaxis:{min:100,max:0,autoscale:0},yaxis:{autoscale:1}};this.preferences.graph_data_points&&(l=o({},l,{},{points:{show:!0,radius:1,hitRadius:3}})),this.preferences.graph_mouse_track&&(l=o({},l,{},{mouse:{track:!0,position:"sw"}})),this.preferences.show_graphs&&a("#dashboard-graphs").hasClass("dashboard-hidden")?a("#dashboard-graphs").removeClass("dashboard-hidden"):this.preferences.show_graphs||(a("#dashboard-graphs").addClass("dashboard-hidden"),this.clearChartFromStore()),this.preferences.show_activity&&a("#dashboard-activity").hasClass("dashboard-hidden")?a("#dashboard-activity").removeClass("dashboard-hidden"):this.preferences.show_activity||a("#dashboard-activity").addClass("dashboard-hidden"),this.preferences.show_graphs&&s.Dashboard.renderCharts([{chart_name:"session_stats",container:e,options:l,counter:!1,refresh_pref_name:"session_stats_refresh"},{chart_name:"tps_stats",container:t,options:l,counter:!0,refresh_pref_name:"tps_stats_refresh"},{chart_name:"ti_stats",container:n,options:l,counter:!0,refresh_pref_name:"ti_stats_refresh"},{chart_name:"to_stats",container:i,options:l,counter:!0,refresh_pref_name:"to_stats_refresh"},{chart_name:"bio_stats",container:r,options:l,counter:!0,refresh_pref_name:"bio_stats_refresh"}]),this.preferences.show_graphs||this.preferences.show_activity?a("#dashboard-none-show").addClass("dashboard-hidden"):a("#dashboard-none-show").removeClass("dashboard-hidden"),C?this.reflectPreferencesServer():S&&this.reflectPreferencesDatabase()}},reflectPreferencesServer:function(){var n=this,i=a(".dashboard-container"),o=i.find("#server_activity").get(0),l=i.find("#server_locks").get(0),d=i.find("#server_prepared").get(0),c=i.find("#server_config").get(0),u={tab_server_activity:o,tab_server_locks:l,tab_server_prepared:d,tab_server_config:c};if(n.preferences.show_activity){var p=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"datname",label:t("Database"),editable:!1,cell:"string"},{name:"usename",label:t("User"),editable:!1,cell:"string"},{name:"application_name",label:t("Application"),editable:!1,cell:"string"},{name:"client_addr",label:t("Client"),editable:!1,cell:"string"},{name:"backend_start",label:t("Backend start"),editable:!1,cell:"string"},{name:"state",label:t("State"),editable:!1,cell:"string"}];p=n.version<90600?p.concat([{name:"waiting",label:t("Waiting?"),editable:!1,cell:"string"}]):p.concat([{name:"wait_event",label:t("Wait event"),editable:!1,cell:"string"},{name:"blocking_pids",label:t("Blocking PIDs"),editable:!1,cell:"string"}]);var h=new E,_=f.generateViewSchema(null,h,"create",null,null,!0);r.each(_[0].fields,(function(e){e.version=n.version})),p.unshift({name:"pg-backform-expand",label:"",cell:T,cell_priority:-1,postgres_version:n.version,schema:_}),p.unshift({name:"pg-backform-delete",label:"",cell:k,cell_action:"cancel",editable:!1,cell_priority:-1,canDeleteRow:s.Dashboard.can_take_action,postgres_version:n.version}),p.unshift({name:"pg-backform-delete",label:"",cell:k,cell_action:"terminate",editable:!1,cell_priority:-1,canDeleteRow:s.Dashboard.can_take_action,postgres_version:n.version});var g=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"datname",label:t("Database"),editable:!1,cell:"string"},{name:"locktype",label:t("Lock type"),editable:!1,cell:"string"},{name:"relation",label:t("Target relation"),editable:!1,cell:"string"},{name:"page",label:t("Page"),editable:!1,cell:"string"},{name:"tuple",label:t("Tuple"),editable:!1,cell:"string"},{name:"virtualxid",label:t("vXID (target)"),editable:!1,cell:"string"},{name:"transactionid",label:t("XID (target)"),editable:!1,cell:"string"},{name:"classid",label:t("Class"),editable:!1,cell:"string"},{name:"objid",label:t("Object ID"),editable:!1,cell:"string"},{name:"virtualtransaction",label:t("vXID (owner)"),editable:!1,cell:"string"},{name:"mode",label:t("Mode"),editable:!1,cell:"string"},{name:"granted",label:t("Granted?"),editable:!1,cell:"string"}],m=[{name:"git",label:t("Name"),editable:!1,cell:"string"},{name:"database",label:t("Database"),editable:!1,cell:"string"},{name:"Owner",label:t("Owner"),editable:!1,cell:"string"},{name:"transaction",label:t("XID"),editable:!1,cell:"string"},{name:"prepared",label:t("Prepared at"),editable:!1,cell:"string"}],b=[{name:"name",label:t("Name"),editable:!1,cell:"string"},{name:"category",label:t("Category"),editable:!1,cell:"string"},{name:"setting",label:t("Setting"),editable:!1,cell:"string"},{name:"unit",label:t("Unit"),editable:!1,cell:"string"},{name:"short_desc",label:t("Description"),editable:!1,cell:"string"}];a(o).addClass("pg-el-container"),a(o).attr("el","sm"),s.Dashboard.render_grid(o,e("dashboard.activity"),p),s.Dashboard.render_grid(l,e("dashboard.locks"),g),s.Dashboard.render_grid(d,e("dashboard.prepared"),m),s.Dashboard.render_grid(c,e("dashboard.config"),b),s.Dashboard.render_grid_data(o),a('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=u[a(e.relatedTarget).attr("aria-controls")];a(t).data("filtertext",a("#txtGridSearch").val());var n=u[a(e.target).attr("aria-controls")];a("#txtGridSearch").val(a(n).data("filtertext")),s.Dashboard.render_grid_data(n)})),a("#btn_refresh").off("click").on("click",(function(){var e=u[a("#dashboard-activity .nav-tabs .active").attr("aria-controls")];s.Dashboard.render_grid_data(e)}))}},reflectPreferencesDatabase:function(){var n=this,i=document.getElementById("database_activity"),o=document.getElementById("database_locks"),l=document.getElementById("database_prepared"),d={tab_database_activity:i,tab_database_locks:o,tab_database_prepared:l};if(n.preferences.show_activity){var c=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"usename",label:t("User"),editable:!1,cell:"string"},{name:"application_name",label:t("Application"),editable:!1,cell:"string"},{name:"client_addr",label:t("Client"),editable:!1,cell:"string"},{name:"backend_start",label:t("Backend start"),editable:!1,cell:"string"},{name:"state",label:t("State"),editable:!1,cell:"string"}];c=n.version<90600?c.concat([{name:"waiting",label:t("Waiting?"),editable:!1,cell:"string"}]):c.concat([{name:"wait_event",label:t("Wait event"),editable:!1,cell:"string"},{name:"blocking_pids",label:t("Blocking PIDs"),editable:!1,cell:"string"}]);var u=new E,p=f.generateViewSchema(null,u,"create",null,null,!0);r.each(p[0].fields,(function(e){e.version=n.version})),c.unshift({name:"pg-backform-expand",label:"",cell:T,cell_priority:-1,postgres_version:n.version,schema:p}),c.unshift({name:"pg-backform-delete",label:"",cell:k,cell_action:"cancel",editable:!1,cell_priority:-1,canDeleteRow:s.Dashboard.can_take_action,postgres_version:n.version}),c.unshift({name:"pg-backform-delete",label:"",cell:k,cell_action:"terminate",editable:!1,cell_priority:-1,canDeleteRow:s.Dashboard.can_take_action,postgres_version:n.version});var h=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"locktype",label:t("Lock type"),editable:!1,cell:"string"},{name:"relation",label:t("Target relation"),editable:!1,cell:"string"},{name:"page",label:t("Page"),editable:!1,cell:"string"},{name:"tuple",label:t("Tuple"),editable:!1,cell:"string"},{name:"virtualxid",label:t("vXID (target)"),editable:!1,cell:"string"},{name:"transactionid",label:t("XID (target)"),editable:!1,cell:"string"},{name:"classid",label:t("Class"),editable:!1,cell:"string"},{name:"objid",label:t("Object ID"),editable:!1,cell:"string"},{name:"virtualtransaction",label:t("vXID (owner)"),editable:!1,cell:"string"},{name:"mode",label:t("Mode"),editable:!1,cell:"string"},{name:"granted",label:t("Granted?"),editable:!1,cell:"string"}],_=[{name:"git",label:t("Name"),editable:!1,cell:"string"},{name:"Owner",label:t("Owner"),editable:!1,cell:"string"},{name:"transaction",label:t("XID"),editable:!1,cell:"string"},{name:"prepared",label:t("Prepared at"),editable:!1,cell:"string"}];a(i).addClass("pg-el-container"),a(i).attr("el","sm"),s.Dashboard.render_grid(i,e("dashboard.activity"),c),s.Dashboard.render_grid(o,e("dashboard.locks"),h),s.Dashboard.render_grid(l,e("dashboard.prepared"),_),s.Dashboard.render_grid_data(i),a('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=d[a(e.relatedTarget).attr("aria-controls")];a(t).data("filtertext",a("#txtGridSearch").val());var n=d[a(e.target).attr("aria-controls")];a("#txtGridSearch").val(a(n).data("filtertext")),s.Dashboard.render_grid_data(n)})),a("#btn_refresh").off("click").on("click",(function(){var e=d[a("#dashboard-activity .nav-tabs .active").attr("aria-controls")];s.Dashboard.render_grid_data(e)}))}},toggleVisibility:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v=e,t&&this.clearChartFromStore()},can_take_action:function(e){var n=e.collection.where({state:"active"}),i=this.get("postgres_version")||null,a="cancel"===(this.get("cell_action")||null),r=t(a?"cancel":"terminate");return i&&i>=1e5&&!e.get("datname")?(u.info(t("You cannot ")+r+t(" background worker processes.")),!1):b==e.get("datname")&&"active"==e.get("state")&&1==n.length?(u.error(t("You are not allowed to ")+r+t(" the main active session.")),!1):a&&"idle"==e.get("state")?(u.info(t("The session is already in idle state.")),!1):!!x||(!(!m||m!=e.get("usename"))||(u.error(t("Superuser privileges are required to ")+r+t(" another users query.")),!1))}},s.Dashboard}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n(19),n(38),n(42),n(62),n(4),n(31),n(63),n(41),n(50),Object.defineProperty(t,"__esModule",{value:!0}),t.Chart=void 0;var s=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=this;n.e(14).then(function(e){a.chartApi=n(127)}.bind(null,n)).catch((function(e){throw e})),this._container=t,this._options={},this._defaultOptions={legend:{position:"nw",backgroundColor:"#D2E8FF"},lines:{show:!0,lineWidth:2},shadowSize:0,resolution:3,grid:{color:"transparent",tickColor:"#8f8f8f"}},this._dataset=null,this._tooltipFormatter=null,this._otherData={},this.setOptions(i)}var t,i,r;return t=e,(i=[{key:"getContainer",value:function(){return this._container}},{key:"getContainerDimensions",value:function(){return{height:this._container.clientHeight,width:this._container.clientWidth}}},{key:"getOptions",value:function(){return this._options}},{key:"setOptions",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._options=t?a({},this._defaultOptions,{},this._options,{},e):a({},this._defaultOptions,{},e)}},{key:"removeOptions",value:function(e){this._options[e]&&delete this._options[e]}},{key:"getOtherData",value:function(e){if(this._otherData[e])return this._otherData[e]}},{key:"setOtherData",value:function(e,t){this._otherData[e]=t}},{key:"isVisible",value:function(){var e=this.getContainerDimensions();return e.height>0&&e.width>0}},{key:"isInPage",value:function(){return this._container!==document.body&&document.body.contains(this._container)}},{key:"setTooltipFormatter",value:function(e){var t=this.getOptions();this._tooltipFormatter=e,this._tooltipFormatter&&this.setOptions({mouse:a({},t.mouse,{trackFormatter:this._tooltipFormatter})})}},{key:"draw",value:function(e){this._dataset=e,this._container&&this.chartApi&&this.chartApi.draw(this._container,this._dataset,this._options)}}])&&o(t.prototype,i),r&&o(t,r),e}();t.Chart=s},function(e,t,n){"use strict";n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.url=function(e,t,n){var i=r.default.treeMenu.findNodeByDomElement(t),o=null;i&&i.anyFamilyMember((function(e){var t=e.getData(),i=r.default.Nodes[t._type],s=i&&i.dashboard;return(0,a.isFunction)(s)&&(s=s.apply(i,[e,t,n])),null!==(o=(0,a.isString)(s)?s:null)}));return o};var i,a=n(22),r=(i=n(10))&&i.__esModule?i:{default:i}},function(e,t,n){"use strict";var i,a;n(8),n(16),n(47),n(15),n(11),n(7),i=[n(2),n(1),n(0),n(14),n(3),n(10),n(30),n(48),n(155),n(156)],void 0===(a=function(e,t,n,i,a,r,o,s,l,d){if(r.NodeStatistics)return r.NodeStatistics;if(r.NodeStatistics=r.NodeStatistics||{},r.NodeStatistics.initialized)return r.NodeStatistics;var c=o.SizeFormatter=function(){};t.extend(c.prototype,{fromRaw:function(e){return l(e)},toRaw:function(e){return e}});var u=o.Extension.SwitchCell.extend({defaults:t.extend({},o.Extension.SwitchCell.prototype.defaults)}),f={16:u,20:o.IntegerCell,21:o.IntegerCell,23:o.IntegerCell,700:o.NumberCell,701:o.NumberCell,1700:o.NumberCell,702:o.DatetimeCell,703:o.DatetimeCell,1082:o.DatetimeCell.extend({includeDate:!0,includeTime:!1,includeMilli:!1}),1083:o.DatetimeCell.extend({includeDate:!1,includeTime:!0,includeMilli:!0}),1114:o.DatetimeCell.extend({includeDate:!0,includeTime:!0,includeMilli:!0}),1184:"string",1266:"string"},p=window.wcDocker;return t.extend(u.prototype.defaults.options,{onText:e("True"),offText:e("False"),onColor:"success",offColor:"ternary",size:"mini"}),t.extend(r.NodeStatistics,{init:function(){if(!this.initialized){this.initialized=!0,t.bindAll(this,"showStatistics","panelVisibilityChanged","__createMultiLineStatistics","__createSingleLineStatistics","__loadMoreRows"),t.extend(this,{initialized:!0,collection:new i.Collection(null),statistic_columns:[{editable:!1,name:"statistics",label:e("Statistics"),cell:"string",headerCell:o.Extension.CustomHeaderCell,cellHeaderClasses:"width_percent_25"},{editable:!1,name:"value",label:e("Value"),cell:"string"}],panel:r.docker.findPanels("statistics"),columns:null,grid:null});var a=this;r.Events.on("pgadmin-browser:panel-statistics:"+p.EVENT.VISIBILITY_CHANGED,this.panelVisibilityChanged),r.Events.on("pgadmin:browser:node:updated",(function(){this.panel&&this.panel.length&&(n(this.panel[0]).data("node-prop",""),this.panelVisibilityChanged(this.panel[0]))}),this),0==this.panel.length?r.Events.on("pgadmin-browser:panel-statistics:"+p.EVENT.INIT,function(){a.panel=r.docker.findPanels("statistics"),(a.panel[0].isVisible()||1!=a.panel.length)&&(r.Events.on("pgadmin-browser:tree:selected",this.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshStatistics,this))}.bind(this)):(a.panel[0].isVisible()||1!=a.panel.length)&&(r.Events.on("pgadmin-browser:tree:selected",this.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshStatistics,this)),a.panel.length>0&&a.panel[0].isVisible()&&(r.Events.on("pgadmin-browser:tree:selected",this.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshStatistics,this))}},__updateCollection:function(i,l,c,u){var f=this.panel[0].layout().scene().find(".pg-panel-content"),h=f.find(".pg-panel-statistics-message"),_=f.find(".pg-panel-statistics-container"),g=this.panel,m=this,b="",v=u;if(l){b=e("No statistics are available for the selected object.");var y=l.getTreeNodeHierarchy(c),w={node_type:u,url:i};if(t.isEqual(n(g[0]).data("node-prop"),w))return;if(n(g[0]).data("node-prop",w),d.nodeHasStatistics(l,c)){var x;b="";!function t(){n.ajax({url:i,type:"GET",beforeSend:function(t){t.setRequestHeader(a.csrf_token_header,a.csrf_token),x=setTimeout((function(){h.text(e("Retrieving data from the server...")),h.removeClass("d-none"),m.grid&&m.grid.remove()}),1e3)}}).done((function(e){if(clearTimeout(x),h.text(""),e.data){var t=m.data=e.data;l.hasCollectiveStatistics||t.rows.length>1?(r.Events.on("pgadmin-browser:panel-statistics:"+p.EVENT.SCROLLED,m.__loadMoreRows),m.__createMultiLineStatistics.call(m,t,l.statsPrettifyFields)):(r.Events.off("pgadmin-browser:panel-statistics:"+p.EVENT.SCROLLED,m.__loadMoreRows),m.__createSingleLineStatistics.call(m,t,l.statsPrettifyFields)),m.grid&&(delete m.grid,m.grid=null),m.grid=new o.Grid({emptyText:"No data found",columns:m.columns,collection:m.collection,className:"backgrid presentation table table-bordered table-noouter-border table-hover"}),m.grid.render(),_.empty(),_.append(m.grid.$el),h.hasClass("d-none")||h.addClass("d-none"),_.removeClass("d-none")}else e.info&&(_.hasClass("d-none")||_.addClass("d-none"),h.text(e.info),h.removeClass("d-none"))})).fail((function(n,i,a){var o=y[v].label;r.Events.trigger("pgadmin:node:retrieval:error","statistics",n,i,a,c),s.pgHandleItemError(n,i,a,{item:c,info:y})||s.pgNotifier(i,n,e("Error retrieving the information - %s",a||o),(function(e){"CRYPTKEY_SET"===e?t():console.warn(arguments)})),h.text(e("Failed to retrieve data from the server."))}))}()}}""!=b&&(_.hasClass("d-none")||_.addClass("d-none"),h.removeClass("d-none"),h.text(b))},refreshStatistics:function(e,i,a){var r={node_type:i._type,url:a.generate_url(e,"stats",i,!0)};t.isEqual(n(this.panel[0]).data("node-prop"),r)&&(n(this.panel[0]).data("node-prop",""),this.showStatistics(e,i,a))},showStatistics:function(e,t,n){var i=this;n&&n&&(i.timeout&&clearTimeout(i.timeout),i.timeout=setTimeout((function(){i.__updateCollection.call(i,n.generate_url(e,"stats",t,!0),n,e,t._type)}),400))},__createMultiLineStatistics:function(e,n){var i=e.rows,a=e.columns;for(var r in this.columns=[],a){var o=a[r],s=f[o.type_code]||"string";"PID"==o.name&&(s=s.extend({orderSeparator:""}));var l={editable:!1,name:o.name,cell:s};-1!=t.indexOf(n,o.name)&&(l.formatter=c),this.columns.push(l)}this.collection.reset(i.splice(0,50))},__loadMoreRows:function(){var e=n(".pg-panel-statistics-container").closest(".wcFrameCenter")[0];if(e.scrollHeight-10<e.scrollTop+e.offsetHeight){var t=this.data.rows;t.length>0&&this.collection.add(t.splice(0,50))}},__createSingleLineStatistics:function(e,n){var i,a=e.rows[0],r=e.columns,o=[];for(var s in this.columns=this.statistic_columns,r)i=r[s].name,o.push({statistics:i,value:a&&a[i]?-1!=t.indexOf(n,i)?l(a[i]):a[i]:null});this.collection.reset(o)},panelVisibilityChanged:function(e){if(e.isVisible()){var t=r.tree,n=t.selected(),i=n&&t.itemData(n),a=n&&i&&r.Nodes[i._type];r.NodeStatistics.showStatistics.apply(r.NodeStatistics,[n,i,a]),r.Events.on("pgadmin-browser:tree:selected",r.NodeStatistics.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",r.NodeStatistics.refreshStatistics,this)}else r.Events.off("pgadmin-browser:tree:selected",r.NodeStatistics.showStatistics),r.Events.off("pgadmin-browser:tree:refreshing",r.NodeStatistics.refreshStatistics,this)}}),r.NodeStatistics}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i;void 0===(i=function(){return function(e){var t=Math.abs(e),n=0,i=["bytes","kB","MB","GB","TB","PB"];if(t<10240)return t+" "+i[n];do{t/=1024,n+=1}while(t>10239);return Math.round(t)+" "+i[n]}}.apply(t,[]))||(e.exports=i)},function(e,t,n){"use strict";n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.nodeHasStatistics=function(e,t){if("function"==typeof e.hasStatistics){var n=e.getTreeNodeHierarchy(t);return e.hasStatistics(n)}return e.hasStatistics}},function(e,t,n){"use strict";var i,a;n(8),n(47),n(5),n(9),n(7),i=[n(2),n(1),n(0),n(14),n(3),n(10),n(13),n(30),n(22)],void 0===(a=function(e,t,n,i,a,r,o,s,l){if(r.NodeDependencies)return r.NodeDependencies;var d=window.wcDocker;return r.NodeDependencies=r.NodeDependencies||{},t.extend(r.NodeDependencies,{init:function(){if(!this.initialized){this.initialized=!0,this.dependenciesPanel=r.docker.findPanels("dependencies")[0],t.bindAll(this,"showDependencies","__loadMoreRows","__appendGridToPanel");var e=i.Model.extend({defaults:{icon:"icon-unknown",type:void 0,name:void 0,field:void 0},parse:function(e){var n=r.Nodes[e.type];return null!=e.icon&&""!=e.icon||(e.icon=n?t.isFunction(n.node_image)?n.node_image.apply(n,[null,null]):n.node_image||"icon-"+e.type:"icon-"+e.type),e.type=l.titleize(e.type.replace(/_/g," "),!0),e}});this.dependenciesCollection=new(i.Collection.extend({model:e}))(null),r.Events.on("pgadmin-browser:tree:selected",this.showDependencies),this.__appendGridToPanel()}},__appendGridToPanel:function(){var t=this.dependenciesPanel.layout().scene().find(".pg-panel-content").find(".pg-panel-dependencies-container"),i=new s.Grid({emptyText:"No data found",columns:[{name:"type",label:e("Type"),cell:s.Cell.extend({render:function(){return s.Cell.prototype.render.apply(this,arguments),this.$el.prepend(n("<i>",{class:"wcTabIcon "+this.model.get("icon")})),this}}),editable:!1},{name:"name",label:e("Name"),cell:"string",editable:!1},{name:"field",label:"",cell:"string",editable:!1}],collection:this.dependenciesCollection,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});return this.dependenciesGrid=i,t.append(i.render().el),!0},showDependencies:function(t,i,s){var l=this,c=e("Please select an object in the tree view."),u=this.dependenciesPanel.layout().scene().find(".pg-panel-content"),f=u.find(".pg-panel-depends-message"),p=u.find(".pg-panel-dependencies-container"),h=s.getTreeNodeHierarchy(t),_=i._type,g=s.generate_url(t,"dependency",i,!0);if(s&&(c=e("No dependency information is available for the selected object."),s.hasDepends)){this.dependenciesGrid.columns.models[2].set({label:e("Restriction")}),f.addClass("d-none"),p.removeClass("d-none");var m="";n.ajax({url:g,type:"GET",beforeSend:function(t){t.setRequestHeader(a.csrf_token_header,a.csrf_token),m=setTimeout((function(){f.text(e("Fetching dependency information from the server...")),f.removeClass("d-none"),c=""}),1e3)}}).done((function(e){clearTimeout(m),e.length>0?(f.hasClass("d-none")||f.addClass("d-none"),p.removeClass("d-none"),l.dependenciesData=e,l.dependenciesCollection.reset(l.dependenciesData.splice(0,100),{parse:!0}),r.Events.on("pgadmin-browser:panel-dependencies:"+d.EVENT.SCROLLED,l.__loadMoreRows)):(r.Events.off("pgadmin-browser:panel-dependencies:"+d.EVENT.SCROLLED),l.dependenciesCollection.reset({silent:!0}),f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))})).fail((function(n,a,d){var c=h[_].label;r.Events.trigger("pgadmin:node:retrieval:error","depends",n,a,d),o.pgHandleItemError(n,a,d,{item:t,info:h})||o.pgNotifier(a,n,e("Error retrieving data from the server: %s",d||c),(function(e){"CRYPTKEY_SET"===e?l.showDependencies(t,i,s):console.warn(arguments)})),f.text(e("Failed to retrieve data from the server."))}))}""!=c&&(f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))},__loadMoreRows:function(){if(!(this.dependenciesPanel.length<1)){var e=this.dependenciesPanel.$container.find(".pg-panel-dependencies-container").closest(".wcFrameCenter")[0];e.scrollHeight-10<e.scrollTop+e.offsetHeight&&this.dependenciesData.length>0&&this.dependenciesCollection.add(this.dependenciesData.splice(0,100),{parse:!0})}}}),r.NodeDependencies}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;n(8),n(47),n(5),n(9),n(7),i=[n(2),n(1),n(0),n(14),n(3),n(10),n(13),n(30),n(22)],void 0===(a=function(e,t,n,i,a,r,o,s,l){if(r.NodeDependents)return r.NodeDependents;var d=window.wcDocker;return r.NodeDependents=r.NodeDependents||{},t.extend(r.NodeDependents,{init:function(){if(!this.initialized){this.initialized=!0,this.dependentsPanel=r.docker.findPanels("dependents")[0],t.bindAll(this,"showDependents","__loadMoreRows","__appendGridToPanel");var e=i.Model.extend({defaults:{icon:"icon-unknown",type:void 0,name:void 0,field:void 0},parse:function(e){var n=r.Nodes[e.type];return null!=e.icon&&""!=e.icon||(e.icon=n?t.isFunction(n.node_image)?n.node_image.apply(n,[null,null]):n.node_image||"icon-"+e.type:"icon-"+e.type),e.type=l.titleize(e.type.replace(/_/g," "),!0),e}});this.dependentCollection=new(i.Collection.extend({model:e}))(null),r.Events.on("pgadmin-browser:tree:selected",this.showDependents),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshDependents,this),this.__appendGridToPanel()}},__appendGridToPanel:function(){var t=this.dependentsPanel.layout().scene().find(".pg-panel-content").find(".pg-panel-dependents-container"),i=new s.Grid({emptyText:"No data found",columns:[{name:"type",label:e("Type"),cell:s.Cell.extend({render:function(){return s.Cell.prototype.render.apply(this,arguments),this.$el.prepend(n("<i>",{class:"wcTabIcon "+this.model.get("icon")})),this}}),editable:!1},{name:"name",label:e("Name"),cell:"string",editable:!1},{name:"field",label:"",cell:"string",editable:!1}],collection:this.dependentCollection,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});return this.dependentGrid=i,t.append(i.render().el),!0},showDependents:function(t,i,s){var l=this,c=e("Please select an object in the tree view."),u=this.dependentsPanel.layout().scene().find(".pg-panel-content"),f=u.find(".pg-panel-depends-message"),p=u.find(".pg-panel-dependents-container"),h=s.getTreeNodeHierarchy(t),_=i._type,g=s.generate_url(t,"dependent",i,!0);if(s&&(c=e("No dependent information is available for the selected object."),s.hasDepends)){"tablespace"==s.type||"role"==s.type?this.dependentGrid.columns.models[2].set({label:e("Database")}):this.dependentGrid.columns.models[2].set({label:e("Restriction")}),f.addClass("d-none"),p.removeClass("d-none");var m="";n.ajax({url:g,type:"GET",beforeSend:function(t){t.setRequestHeader(a.csrf_token_header,a.csrf_token),m=setTimeout((function(){f.text(e("Fetching dependent information from the server...")),f.removeClass("d-none"),c=""}),1e3)}}).done((function(e){clearTimeout(m),e.length>0?(f.hasClass("d-none")||f.addClass("d-none"),p.removeClass("d-none"),l.dependentData=e,l.dependentCollection.reset(l.dependentData.splice(0,100),{parse:!0}),r.Events.on("pgadmin-browser:panel-dependents:"+d.EVENT.SCROLLED,l.__loadMoreRows)):(r.Events.off("pgadmin-browser:panel-dependents:"+d.EVENT.SCROLLED),l.dependentCollection.reset({silent:!0}),f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))})).fail((function(n,a,d){var c=h[_].label;r.Events.trigger("pgadmin:node:retrieval:error","depends",n,a,d),o.pgHandleItemError(n,a,d,{item:t,info:h})||o.pgNotifier(a,n,e("Error retrieving data from the server: %s",d||c),(function(e){"CRYPTKEY_SET"===e?l.showDependents(t,i,s):console.warn(arguments)})),f.text(e("Failed to retrieve data from the server."))}))}""!=c&&(f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))},__loadMoreRows:function(){if(!(this.dependentsPanel.length<1)){var e=this.dependentsPanel.$container.find(".pg-panel-dependents-container").closest(".wcFrameCenter")[0];e.scrollHeight-10<e.scrollTop+e.offsetHeight&&this.dependentData.length>0&&this.dependentCollection.add(this.dependentData.splice(0,100),{parse:!0})}}}),r.NodeDependents}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;n(15),n(7),i=[n(2),n(1),n(0),n(3),n(10),n(13)],void 0===(a=function(e,t,n,i,a,r){if(a.ShowNodeSQL=a.ShowNodeSQL||{},a.ShowNodeSQL.initialized)return a.ShowNodeSQL;var o=window.wcDocker;return t.extend(a.ShowNodeSQL,{init:function(){var e;this.initialized||(this.initialized=!0,t.bindAll(this,"showSQL","sqlPanelVisibilityChanged"),this.sqlPanels=e=a.docker.findPanels("sql"),a.Events.on("pgadmin-browser:panel-sql:"+o.EVENT.VISIBILITY_CHANGED,this.sqlPanelVisibilityChanged),a.Events.on("pgadmin:browser:node:updated",(function(){this.sqlPanels&&this.sqlPanels.length&&(n(this.sqlPanels[0]).data("node-prop",""),this.sqlPanelVisibilityChanged(this.sqlPanels[0]))}),this),0==e.length?a.Events.on("pgadmin-browser:panel-sql:"+o.EVENT.INIT,function(){(e[0].isVisible()||1!=e.length)&&(a.Events.on("pgadmin-browser:tree:selected",this.showSQL),a.Events.on("pgadmin-browser:tree:refreshing",this.refreshSQL,this))}.bind(this)):(e[0].isVisible()||1!=e.length)&&(a.Events.on("pgadmin-browser:tree:selected",this.showSQL),a.Events.on("pgadmin-browser:tree:refreshing",this.refreshSQL,this)))},refreshSQL:function(e,i,a){var r={node_type:i._type,url:a.generate_url(e,"sql",i,!0)};t.isEqual(n(this.sqlPanels[0]).data("node-prop"),r)&&(n(this.sqlPanels[0]).data("node-prop",""),this.showSQL(e,i,a))},showSQL:function(o,s,l){this.timeout&&clearTimeout(this.timeout);var d=this;this.timeout=setTimeout((function(){var c="-- "+e("Please select an object in the tree view.");if(l){c="-- "+e("No SQL could be generated for the selected object.");var u=s._type,f=l.generate_url(o,"sql",s,!0),p=l.getTreeNodeHierarchy(o),h={node_type:u,url:f};if(t.isEqual(n(d.sqlPanels[0]).data("node-prop"),h))return;if(n(d.sqlPanels[0]).data("node-prop",h),l.hasSQL){var _;c="";!function t(){n.ajax({url:f,type:"GET",beforeSend:function(t){t.setRequestHeader(i.csrf_token_header,i.csrf_token),_=setTimeout((function(){i.Browser.editor.setValue(e("Retrieving data from the server..."))}),1e3)}}).done((function(e){i.Browser.editor.getValue()!=e&&i.Browser.editor.setValue(e),clearTimeout(_)})).fail((function(n,i,s){var l=p[u].label;a.Events.trigger("pgadmin:node:retrieval:error","sql",n,i,s,o),r.pgHandleItemError(n,i,s,{item:o,info:p})||r.pgNotifier(i,n,e("Error retrieving the information - %s",s||l),(function(e){"CRYPTKEY_SET"===e?t():console.warn(arguments)}))}))}()}}""!=c&&i.Browser.editor.setValue(c)}),400)},sqlPanelVisibilityChanged:function(e){if(e.isVisible()){var t=a.tree,n=t.selected(),i=n&&t.itemData(n),r=n&&i&&a.Nodes[i._type];a.ShowNodeSQL.showSQL.apply(a.ShowNodeSQL,[n,i,r]),a.Events.on("pgadmin-browser:tree:selected",a.ShowNodeSQL.showSQL),a.Events.on("pgadmin-browser:tree:refreshing",a.ShowNodeSQL.refreshSQL,this)}else a.Events.off("pgadmin-browser:tree:selected",a.ShowNodeSQL.showSQL),a.Events.off("pgadmin-browser:tree:refreshing",a.ShowNodeSQL.refreshSQL,this)}}),a.ShowNodeSQL}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;n(28),n(8),n(21),n(32),n(15),n(12),n(79),n(35),n(43),n(7),i=[n(3),n(2),n(6),n(1),n(0),n(10),n(48)],void 0===(a=function(e,t,n,i,a,r,o){if(r.BackgroundProcessObsorver=r.BackgroundProcessObsorver||{},r.BackgroundProcessObsorver.initialized)return r.BackgroundProcessObsorver;var s=window.wcDocker,l=function(e,t){var n=this;setTimeout((function(){n.initialize.apply(n,[e,t])}),1)};return i.extend(l.prototype,{success_status_tpl:i.template('\n      <div class="d-flex px-2 py-1 bg-success-light border border-success rounded">\n        <div class="pr-2">\n          <i class="fa fa-check fa-lg text-success pg-bg-status-icon" aria-hidden="true" role="img"></i>\n        </div>\n        <div class="text-body mx-auto pg-bg-status-text"><%-status_text%></div>\n      </div>'),failed_status_tpl:i.template('\n      <div class="d-flex px-2 py-1 bg-danger-lighter border border-danger rounded">\n        <div class="pr-2">\n          <i class="fa fa-close fa-lg text-danger pg-bg-status-icon" aria-hidden="true" role="img"></i>\n        </div>\n        <div class="text-body mx-auto pg-bg-status-text"><%-status_text%></div>\n      </div>'),other_status_tpl:i.template('\n      <div class="d-flex px-2 py-1 bg-primary-light border border-primary rounded">\n        <div class="pr-2">\n          <i class="fa fa-info fa-lg text-primary pg-bg-status-icon" aria-hidden="true" role="img"></i>\n        </div>\n        <div class="text-body mx-auto pg-bg-status-text"><%-status_text%></div>\n      </div>'),initialize:function(e,t){i.extend(this,{details:!1,notify:i.isUndefined(t)||t,curr_status:null,state:0,completed:!1,id:e.id,type_desc:null,desc:null,detailed_desc:null,stime:null,exit_code:null,acknowledge:e.acknowledge,execution_time:null,out:-1,err:-1,lot_more:!1,notifier:null,container:null,panel:null,logs:a("<ol></ol>",{class:"pg-bg-process-logs"})}),this.notify&&(r.Events&&r.Events.on("pgadmin-bgprocess:started:"+this.id,(function(e){e.notifier||e.show.apply(e)})),r.Events&&r.Events.on("pgadmin-bgprocess:finished:"+this.id,(function(e){e.notifier||e.show.apply(e)})));var n=this;setTimeout((function(){n.update.apply(n,[e])}),1)},bgprocess_url:function(e){switch(e){case"status":return this.details&&-1!=this.out&&-1!=this.err?n("bgprocess.detailed_status",{pid:this.id,out:this.out,err:this.err}):n("bgprocess.status",{pid:this.id});case"acknowledge":return n("bgprocess.acknowledge",{pid:this.id});case"stop_process":return n("bgprocess.stop_process",{pid:this.id});default:return n("bgprocess.list")}},update:function(n){var a=this,o=[],s=[];"stime"in n&&(a.stime=new Date(n.stime)),"execution_time"in n&&(a.execution_time=parseFloat(n.execution_time)),"type_desc"in n&&(a.type_desc=n.type_desc),"desc"in n&&(a.desc=n.desc),"details"in n&&(a.detailed_desc=n.details),"exit_code"in n&&(a.exit_code=n.exit_code),"process_state"in n&&(a.state=n.process_state),"out"in n&&(a.out=n.out&&n.out.pos,n.out&&n.out.lines&&(o=n.out.lines)),"err"in n&&(a.err=n.err&&n.err.pos,n.err&&n.err.lines&&(s=n.err.lines)),a.completed=a.completed||"err"in n&&"out"in n&&n.err.done&&n.out.done||!a.details&&!i.isNull(a.exit_code);for(var l=0,d=0,c=[],u=document.createElement("textarea"),f=function(e){return u.textContent=e,u.innerHTML};l<o.length&&d<s.length;)e.natural_sort(o[l][0],s[d][0])<=0?c.push('<li class="pg-bg-res-out">'+f(o[l++][1])+"</li>"):c.push('<li class="pg-bg-res-err">'+f(s[d++][1])+"</li>");for(;l<o.length;)c.push('<li class="pg-bg-res-out">'+f(o[l++][1])+"</li>");for(;d<s.length;)c.push('<li class="pg-bg-res-err">'+f(s[d++][1])+"</li>");c.length&&(a.logs.append(c.join("")),setTimeout((function(){a.logs[0].scrollTop=a.logs[0].scrollHeight}))),a.logs_loading&&(a.logs_loading.remove(),a.logs_loading=null),a.stime&&(a.curr_status=a.other_status_tpl({status_text:t("Started")}),a.execution_time>=2&&(a.curr_status=a.other_status_tpl({status_text:t("Running...")})),i.isNull(a.exit_code)||(3===a.state?a.curr_status=a.failed_status_tpl({status_text:t("Terminated by user.")}):0==a.exit_code?a.curr_status=a.success_status_tpl({status_text:t("Successfully completed.")}):a.curr_status=a.failed_status_tpl({status_text:t("Failed (exit code: %s).",String(a.exit_code))})),0==a.state&&a.stime&&(a.state=1,r.Events&&r.Events.trigger("pgadmin-bgprocess:started:"+a.id,a,a)),1!=a.state||i.isNull(a.exit_code)||(a.state=2,r.Events&&r.Events.trigger("pgadmin-bgprocess:finished:"+a.id,a,a)),setTimeout((function(){a.show.apply(a)}),10)),a.completed||setTimeout((function(){a.status.apply(a)}),1e3)},status:function(){var e=this;a.ajax({typs:"GET",timeout:3e4,url:e.bgprocess_url("status"),cache:!1,async:!0,contentType:"application/json"}).done((function(t){setTimeout((function(){e.update(t)}),10)})).fail((function(t){410!=t.status&&setTimeout((function(){e.update(t)}),1e4)}))},show:function(){if(this.notify&&!this.details){if(!this.notifier){var e=a('\n            <div class="card">\n              <div class="card-header bg-primary d-flex">\n                <div>'.concat(this.type_desc,'</div>\n                <div class="ml-auto">\n                  <button class="btn btn-sm-sq btn-primary pg-bg-close"><i class="fa fa-lg fa-close" role="img"></i></button>\n                </div>\n              </div>\n              <div class="card-body px-2">\n                <div class="py-1">').concat(this.desc,'</div>\n                <div class="py-1">').concat(this.stime.toString(),'</div>\n                <div class="d-flex py-1">\n                  <div class="my-auto mr-2">\n                    <span class="fa fa-clock-o fa-2x" role="img"></span>\n                  </div>\n                  <div class="pg-bg-etime my-auto mr-2"></div>\n                  <div class="ml-auto">\n                    <button class="btn btn-secondary pg-bg-more-details"><span class="fa fa-info-circle" role="img"></span>&nbsp;').concat(t("More details..."),'</button>\n                    <button class="btn btn-danger bg-process-stop"><span class="fa fa-times-circle" role="img"></span>&nbsp;').concat(t("Stop Process"),'</button>\n                  </div>\n                </div>\n                <div class="pg-bg-status py-1">\n                </div>\n              </div>\n            </div>\n            ')),n=e.find(".pg-bg-more-details"),i=e.find(".pg-bg-close");this.container=e,this.notifier=o.notify(e.get(0),"bg-bgprocess",0,null),n.on("click",function(e){(e=e||window.event).cancelBubble=!0,e.stopPropagation(),this.notifier.dismiss(),this.notifier=null,this.completed=!1,this.show_detailed_view.apply(this)}.bind(this)),i.on("click",function(){this.notifier.dismiss(),this.notifier=null,this.acknowledge_server.apply(this)}.bind(this)),this.container.on("click",(function(e){(e=e||window.event).cancelBubble=!0,e.stopPropagation()})),e.find(".bg-process-stop").off("click").on("click",this.stop_process.bind(this))}this.container.find(".pg-bg-etime").empty().append(a("<span></span>").text(String(this.execution_time))).append(a("<span></span>").text(" "+t("seconds"))),a(this.container.find(".pg-bg-status")).html(this.curr_status);var r=a(this.container.find(".bg-process-stop"));isNaN(parseInt(this.exit_code))?r.attr("disabled",!1):r.attr("disabled",!0)}else this.show_detailed_view.apply(this)},show_detailed_view:function(){var e=this,n=this.panel,i=!1;e.panel||(i=!0,(n=this.panel=r.BackgroundProcessObsorver.create_panel()).title("Process Watcher - "+e.type_desc),n.focus());var o=n.$container,l=o.find(".bg-process-watcher"),d=o.find(".bg-process-details"),c=o.find(".bg-process-footer"),u=o.find(".bg-process-stop");if(isNaN(parseInt(e.exit_code))?u.attr("disabled",!1):u.attr("disabled",!0),u.off("click").on("click",e.stop_process.bind(this)),i&&(l.html(e.logs),setTimeout((function(){e.logs[0].scrollTop=e.logs[0].scrollHeight})),e.logs_loading=a('<li class="pg-bg-res-out loading-logs">'.concat(t("Loading process logs..."),"</li>")),e.logs.append(e.logs_loading),d.find(".bg-detailed-desc").html(e.detailed_desc)),d.find(".bg-process-stats .bgprocess-start-time").html(e.stime),c.find(".bg-process-status").html(e.curr_status),c.find(".bg-process-exec-time p").empty().append(a("<span></span>").text(String(e.execution_time))).append(a("<span></span>").text(" "+t("seconds"))),i){e.details=!0,e.err=0,e.out=0,setTimeout((function(){e.status.apply(e)}),1e3);var f=function(e,t,n){var i=t.outerHeight()+n.outerHeight();e.css("padding-bottom",i)}.bind(n,l,d,c);n.on(s.EVENT.RESIZED,f),n.on(s.EVENT.ATTACHED,f),n.on(s.EVENT.DETACHED,f),f(),n.on(s.EVENT.CLOSED,function(e){e.panel=null,e.details=!1,null!=e.exit_code&&e.acknowledge_server.apply(e)}.bind(n,this))}},acknowledge_server:function(){a.ajax({type:"PUT",timeout:3e4,url:this.bgprocess_url("acknowledge"),cache:!1,async:!0,contentType:"application/json"}).done((function(){})).fail((function(){console.warn(arguments)}))},stop_process:function(){this.state=3,a.ajax({type:"PUT",timeout:3e4,url:this.bgprocess_url("stop_process"),cache:!1,async:!0,contentType:"application/json"}).done((function(){})).fail((function(){console.warn(arguments)}))}}),i.extend(r.BackgroundProcessObsorver,{bgprocesses:{},init:function(){var e=this;e.initialized||(e.initialized=!0,setTimeout((function(){e.update_process_list.apply(e)}),1e3),r.Events.on("pgadmin-bgprocess:created",(function(){setTimeout((function(){r.BackgroundProcessObsorver.update_process_list(!0)}),1e3)})))},update_process_list:function(e){var t=this;a.ajax({typs:"GET",timeout:3e4,url:n("bgprocess.list"),cache:!1,async:!0,contentType:"application/json"}).done((function(n){if(n&&i.isArray(n)){for(var a in n){var r=n[a];"id"in r&&(r.id in t.bgprocesses||(t.bgprocesses[r.id]=new l(r)))}e&&0==n.length&&setTimeout((function(){t.update_process_list(!1)}),3e3)}})).fail((function(){console.warn(arguments)}))},create_panel:function(){return this.register_panel(),r.docker.addPanel("bg_process_watcher",s.DOCK.FLOAT,null,{w:screen.width<700?.95*screen.width:.5*screen.width,h:screen.height<500?.95*screen.height:.5*screen.height,x:screen.width<700?"2%":"25%",y:screen.height<500?"2%":"25%"})},register_panel:function(){var e=r.docker.findPanels("bg_process_watcher");e&&e.length>=1||new r.Panel({name:"bg_process_watcher",showTitle:!0,isCloseable:!0,isPrivate:!0,isLayoutMember:!1,content:'<div class="bg-process-details"><div class="bg-detailed-desc"></div><div class="bg-process-stats d-flex py-1"><div class="my-auto mr-2"><span class="fa fa-clock-o fa-2x" role="img"></span></div><div class="pg-bg-etime my-auto mr-2"><span>'+t("Start time")+': <span class="bgprocess-start-time"></span></span></div><div class="ml-auto"><button type="button" class="btn btn-danger bg-process-stop"><span class="fa fa-times-circle" role="img"></span>&nbsp;'+t("Stop Process")+'</button></div></div></div><div class="bg-process-watcher"></div><div class="bg-process-footer p-2 d-flex"><div class="bg-process-status flex-grow-1"></div><div class="bg-process-exec-time ml-4 my-auto"><div class="exec-div"><span>'+t("Execution time")+":</span><p></p></div></div></div>",onCreate:function(e,t){t.addClass("pg-no-overflow p-2")}}).load(r.docker)}}),r.BackgroundProcessObsorver}.apply(t,i))||(e.exports=a)},,function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(28),n(8),n(17),n(11),n(4),n(31),n(12),n(23),n(44),n(20),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.showDataGrid=function(e,t,n,i,s,u){var f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,_=t.treeMenu.findNodeByDomElement(s);if(void 0===_||!_.getData())return void n.alert((0,a.default)("Data Grid Error"),(0,a.default)("No object selected."));var g=o.getTreeNodeHierarchyFromIdentifier.call(t,s);if(function(e){return void 0===e.server||void 0===e.database}(g)||!function(e){return void 0!==e.schema||void 0!==e.view||void 0!==e.catalog}(g))return;var m=function(e,t,n,i){var a=(0,r.default)("datagrid.panel",{trans_id:e});return a+="?is_query_tool=".concat(!1)+"&cmd_type=".concat(t.mnuid)+"&obj_type=".concat(n._type)+"&obj_id=".concat(n._id)+"&sgid=".concat(i.server_group._id)+"&sid=".concat(i.server._id)+"&did=".concat(i.database._id)+"&server_type=".concat(i.server.server_type)}(u,i,_.getData(),g),b=h(t,s);if(f){!function(e,t){e.filterDialog||e.dialog("filterDialog",(function(){return{main:function(e,t,n,i,a){this.set("title",e),this.message=t,this.validateUrl=n,this.okCallback=a,this.preferences=i},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-secondary pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:(0,a.default)("Data Filter"),"aria-label":(0,a.default)("Help"),url:(0,r.default)("help.static",{filename:"viewdata_filter.html"})}},{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button"},{text:(0,a.default)("OK"),key:null,className:"btn btn-primary fa fa-check pg-alertify-button"}],options:{modal:0,resizable:!0,maximizable:!1,pinnable:!1,autoReset:!1}}},build:function(){var t=this;e.pgDialogBuild.apply(t),(0,c.default)(t.__internal.buttons[2].element).attr("title",(0,a.default)("Use SHIFT + ENTER to apply filter...")),(0,c.default)(t.elements.body).on("keypress",(function(e){e.shiftKey&&13==e.keyCode&&t.__internal.buttons[2].element.click()}))},prepare:function(){var e=this,n=(0,c.default)(this.message),i=n.find("#sql_filter");(0,c.default)(this.elements.header).attr("data-title",this.get("title")),(0,c.default)(this.elements.body.childNodes[0]).addClass("dataview_filter_dialog"),this.setContent(n.get(0)),e.__internal.buttons[2].element.disabled=!0,this.filter_obj=l.default.fromTextArea(i.get(0),{lineNumbers:!0,mode:"text/x-pgsql",extraKeys:t.editor_shortcut_keys,indentWithTabs:!e.preferences.use_spaces,indentUnit:e.preferences.tab_size,tabSize:e.preferences.tab_size,lineWrapping:e.preferences.wrap_code,autoCloseBrackets:e.preferences.insert_pair_brackets,matchBrackets:e.preferences.brace_matching});var a=d.calcFontSize(e.preferences.sql_font_size);(0,c.default)(this.filter_obj.getWrapperElement()).css("font-size",a),setTimeout((function(){e.filter_obj.refresh(),e.filter_obj.focus()}),500),e.filter_obj.on("change",(function(){""!==e.filter_obj.getValue()?e.__internal.buttons[2].element.disabled=!1:e.__internal.buttons[2].element.disabled=!0}))},callback:function(n){if(n.button.text==(0,a.default)("OK")){var i=this.filter_obj.getValue(),r=this;n.cancel=!0,c.default.ajax({url:r.validateUrl,method:"POST",async:!1,contentType:"application/json",data:JSON.stringify(i)}).done((function(t){t.data.status?(r.okCallback(i),r.close()):e.alert((0,a.default)("Validation Error"),t.data.result)})).fail((function(t){e.alert((0,a.default)("Validation Error"),t)}))}else if(0==n.index)return n.cancel=!0,void t.showHelp(n.button.element.name,n.button.element.getAttribute("url"),null,null)}}}))}(n,t);var v=function(e,t){var n={sid:t.server._id,did:t.database._id,obj_id:e._id};return(0,r.default)("datagrid.filter_validate",n)}(_.getData(),g),y=function(t){e.launch_grid(u,m,!1,b,null,t)};c.default.get((0,r.default)("datagrid.filter"),(function(e){n.filterDialog("Data Filter - ".concat(b),e,v,p,y).resizeTo(t.stdW.sm,t.stdH.sm)}))}else e.launch_grid(u,m,!1,b)},t.retrieveNameSpaceName=p,t.generateDatagridTitle=h;var a=f(n(2)),r=f(n(6)),o=n(53),s=n(76),l=f(n(75)),d=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(57)),c=f(n(0));function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return void 0!==e.schema?e.schema.label:void 0!==e.view?e.view.label:void 0!==e.catalog?e.catalog.label:""}function h(e,t){var n=(0,s.getPanelTitle)(e,t),i=p(o.getTreeNodeHierarchyFromIdentifier.call(e,t)),a=e.treeMenu.findNodeByDomElement(t);return"".concat(i,".").concat(a.getData().label,"/").concat(n)}},function(e,t,n){"use strict";(function(i){var a,r;n(8),n(34),n(15),a=[n(0),n(54),n(92)],void 0===(r=function(e,t){return function(){var n=window.Slick,a=new n.EventHandler,r=new n.Event,o=new n.Event,s=function(t,n,i){var a=i.column;if(t.focus(),f(a)){var o=e(n.target);if(u(n)){if(e(n.target).hasClass("slick-resizable-handle"))return;o=e(n.target).parents(".slick-header-column")}o.toggleClass("selected"),o.hasClass("selected")&&r.notify(i,n),n.isPropagationStopped()||n.isImmediatePropagationStopped()||c(t,a.id)}else l(t)},l=function(t){if(e(".copy-with-header").hasClass("visibility-hidden"))e(".slick-header-column").each((function(t,n){e(n).removeClass("selected")}));else{var n=t.getSelectedRows();e(".slick-header-column").each((function(i,a){0==n.length?(e(a).removeClass("selected"),t.getColumns()[i].selected=!1):i>0&&t.getColumns()[i].selectable&&(e(a).addClass("selected"),t.getColumns()[i].selected=!0)}))}}.bind(t),d=function(n,i,a){e(".slick-header-column").each((function(i,r){var o=e(r).find('[data-cell-type="column-header-row"]'),s=n.getColumnIndex(o.data("column-id"));p(n,a,s)?(e(r).addClass("selected"),s&&(n.getColumns()[s].selected=!0)):t.areAllRangesCompleteRows(n,a)||(e(r).removeClass("selected"),s&&(n.getColumns()[s].selected=!1))}))},c=function(e,n){var i,a=e.getSelectionModel(),r=a.getSelectedRanges(),o=e.getColumnIndex(n),s=t.rangeForColumn(e,o);i=t.isRangeSelected(r,s)?t.removeRange(r,s):t.areAllRangesSingleColumns(r,e)?t.addRange(r,s):[s],a.setSelectedRanges(i)},u=function(t){return!e(t.target).hasClass("slick-header-column")},f=function(e){return!1!==e.selectable},p=function(e,n,i){var a=t.areAllRangesCompleteRows(e,n);return h(e,n,i)&&!a},h=function(e,n,i){var a=t.isRangeEntirelyWithinSelectedRanges(n,t.rangeForColumn(e,i)),r=t.isAnyCellOfColumnSelected(n,i);return a||r};e.extend(this,{init:function(e){a.subscribe(e.onHeaderClick,s.bind(null,e)),e.getSelectionModel().onSelectedRangesChanged.subscribe(d.bind(null,e)),o.subscribe((function(e,t){c(t.grid,t.column.id)}))},getColumnDefinitions:function(e){return i.map(e,(function(e){if(f(e)){var t="<span data-cell-type='column-header-row'        data-test='output-column-header'       data-column-id='"+e.id+"'>  <span class='column-description'>    <span class='column-name'>"+e.display_name+"</span>    <span class='column-type'>"+e.column_type+"</span>  </span></span>";return i.extend(e,{name:t})}return e}))},onBeforeColumnSelectAll:r,onColumnSelectAll:o,toggleColumnHeaderForCopyHeader:l})}}.apply(t,a))||(e.exports=r)}).call(this,n(1))},function(e,t,n){"use strict";e.exports={TRANSACTION_STATUS_IDLE:0,TRANSACTION_STATUS_ACTIVE:1,TRANSACTION_STATUS_INTRANS:2,TRANSACTION_STATUS_INERROR:3,TRANSACTION_STATUS_UNKNOWN:5}},function(e,t,n){"use strict";n(32);var i=r(n(0)),a=r(n(33));function r(e){return e&&e.__esModule?e:{default:e}}var o={_verbose:function(){return!(0,i.default)(".explain-verbose").hasClass("visibility-hidden")},_costsEnabled:function(){return!(0,i.default)(".explain-costs").hasClass("visibility-hidden")},_buffers:function(){return!(0,i.default)(".explain-buffers").hasClass("visibility-hidden")},_timing:function(){return!(0,i.default)(".explain-timing").hasClass("visibility-hidden")},_summary:function(){return!(0,i.default)(".explain-summary").hasClass("visibility-hidden")},_settings:function(){return!(0,i.default)(".explain-settings").hasClass("visibility-hidden")},_clearMessageTab:function(){(0,i.default)(".sql-editor-message").html("")},executeQuery:function(e){this._clearMessageTab(),e.check_data_changes_to_execute_query()},explainAnalyze:function(e){var t={format:"json",analyze:!0,verbose:this._verbose(),costs:this._costsEnabled(),buffers:this._buffers(),timing:this._timing(),summary:this._summary(),settings:this._settings()};this._clearMessageTab(),e.check_data_changes_to_execute_query(t)},explain:function(e){var t={format:"json",analyze:!1,verbose:this._verbose(),costs:this._costsEnabled(),buffers:!1,timing:!1,summary:this._summary(),settings:this._settings()};this._clearMessageTab(),e.check_data_changes_to_execute_query(t)},download:function(e){var t=e.gridView.query_tool_obj.getSelection();if(t||(t=e.gridView.query_tool_obj.getValue()),t){var n="data-"+(new Date).getTime()+".csv";e.is_query_tool||(n=e.table_name+".csv"),e.trigger_csv_download(t,n)}},commentBlockCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.toggleComment(t.getCursor(!0),t.getCursor(!1))},commentLineCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.lineComment(t.getCursor(!0),t.getCursor(!1),{lineComment:"--"})},uncommentLineCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.uncomment(t.getCursor(!0),t.getCursor(!1),{lineComment:"--"})},focusOut:function(){document.activeElement.blur(),a.default.document.activeElement.blur()},toggleCaseOfSelectedText:function(e){var t=e.gridView.query_tool_obj,n=t.getSelection();n&&(n===n.toUpperCase()?t.replaceSelection(n.toLowerCase()):t.replaceSelection(n.toUpperCase()))},executeCommit:function(e){e.special_sql="COMMIT;",this.executeQuery(e)},executeRollback:function(e){e.special_sql="ROLLBACK;",this.executeQuery(e)},saveDataChanges:function(e){e.close_on_save=!1,e.save_data()}};e.exports=o},function(e,t,n){"use strict";n(4),n(35),n(83),Object.defineProperty(t,"__esModule",{value:!0}),t.calculateQueryRunTime=function(e,t){var n,i,r,o=(0,a.default)(t).diff(e);return n=parseInt(o/1e3),o%=1e3,i=parseInt(n/60),n%=60,r=parseInt(i/60),((r>0?r+" hr ":"")+((i%=60)>0?i+" min ":"")+(r<=0&&n>0?n+" secs ":"")+(r<=0&&i<=0?o+" msec ":"")).trim()};var i,a=(i=n(105))&&i.__esModule?i:{default:i}},,,,,,,,,,,,,function(e,t,n){"use strict";var i,a;n(16),n(5),n(9),n(74),i=[n(0),n(1)],void 0===(a=function(e,t){return function(e,n){if(t.isUndefined(n)||t.isNull(n))return!0;n.startsWith("coll-")&&(n=n.replace("coll-",""));if(t.indexOf(["server_group","server","catalog_object_column"],n)>=0)return!0;var i=e.get_preference("browser","show_node_"+n);return!i||i.value}}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";(function(e){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(17),n(32),n(11),n(4),n(31),n(41),n(12),n(23),n(44),n(20),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.pgBrowser=void 0;var a=f(n(3)),r=f(n(6)),o=f(n(0)),s=u(n(13)),l=u(n(57)),d=f(n(33));function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}function f(e){return e&&e.__esModule?e:{default:e}}var p=n(87),h=a.default.Browser=a.default.Browser||{};t.pgBrowser=h,e.extend(h,{preferences_cache:[],prefcache_version:0,generate_preference_version:function(){return(new Date).getTime()},preference_version:function(e){if(!e)return this.prefcache_version;this.prefcache_version=e},get_preference:function(t,n){var i=this;if(0!=e.size(i.preferences_cache))return e.findWhere(i.preferences_cache,{module:t,name:n});var a=setInterval((function(){if(i.preferences_cache.length>0)return clearInterval(a),e.findWhere(i.preferences_cache,{module:t,name:n})}),1e3)},get_preferences_for_module:function(t){var n={};if(e.each(e.where(this.preferences_cache,{module:t}),(function(e){n[e.name]=e.value})),Object.keys(n).length>0)return n},get_preference_for_id:function(t){return e.findWhere(this.preferences_cache,{id:t})},cache_preferences:function(t){var n=this,i={};i[a.default.csrf_token_header]=a.default.csrf_token,setTimeout((function(){o.default.ajax({url:(0,r.default)("preferences.get_all"),headers:i}).done((function(i){n.preferences_cache=i,n.preference_version(n.generate_preference_version()),h.keyboardNavigation.init(),h.tree&&(p.modifyAcitreeAnimation(n),p.modifyAlertifyAnimation(n)),h.browserTreeState.init(),t&&("string"==typeof t?o.default.event.trigger("prefchange:"+t):e.each(t,(function(e,t){o.default.event.trigger("prefchange:"+t)})))})).fail((function(e,t,n){s.pgRespErrorNotify(e,n)}))}),500)},reflectPreferences:function(e){if("sqleditor"===e||null==e){var t=this.get_preferences_for_module("sqleditor");(0,o.default)(this.editor.getWrapperElement()).css("font-size",l.calcFontSize(t.sql_font_size)),this.editor.setOption("tabSize",t.tab_size),this.editor.setOption("lineWrapping",t.wrap_code),this.editor.setOption("autoCloseBrackets",t.insert_pair_brackets),this.editor.setOption("matchBrackets",t.brace_matching),this.editor.refresh()}},onPreferencesChange:function(e,t){(0,o.default)(d.default).on("prefchange:"+e,(function(e){t(e)}))}})}).call(this,n(1))},,function(e,t){e.exports=a},function(e,t,n){"use strict";(function(e){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(17),n(11),n(4),n(31),n(12),n(23),n(44),n(20),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.pgBrowser=void 0;var a=u(n(3)),r=u(n(6)),o=u(n(0)),s=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(13)),l=u(n(2));n(58);var d=u(n(33));function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){return e&&e.__esModule?e:{default:e}}var f=a.default.Browser=a.default.Browser||{};t.pgBrowser=f;var p=window.wcDocker;e.extend(f,{lock_layout_levels:{PREVENT_DOCKING:"docking",FULL:"full",NONE:"none"},buildDefaultLayout:function(e){var t=e.addPanel("browser",p.DOCK.LEFT),n=e.addPanel("dashboard",p.DOCK.RIGHT,t);e.addPanel("properties",p.DOCK.STACKED,n,{tabOrientation:p.TAB.TOP}),e.addPanel("sql",p.DOCK.STACKED,n),e.addPanel("statistics",p.DOCK.STACKED,n),e.addPanel("dependencies",p.DOCK.STACKED,n),e.addPanel("dependents",p.DOCK.STACKED,n)},save_current_layout:function(e,t){if(t){var n={setting:e,value:t.save()};o.default.ajax({type:"POST",url:(0,r.default)("settings.store_bulk"),data:n})}},restore_layout:function(e,t,n){if(""!=t)try{e.restore(t)}catch(t){e.clear(),n&&n(e)}else n&&n(e);var i=d.default.pgAdmin.Browser,a=setInterval((function(){i.get_preferences_for_module("browser")&&(clearInterval(a),i.reflectLocklayoutChange(e),i.onPreferencesChange("browser",(function(){i.reflectLocklayoutChange(e)})))}),500)},reflectLocklayoutChange:function(e){var t=d.default.pgAdmin.Browser,n=t.get_preferences_for_module("browser");t.lock_layout(e,n.lock_layout)},lock_layout:function(t,n){var i=this.menus.file.mnu_locklayout.menu_items;switch(n){case this.lock_layout_levels.PREVENT_DOCKING:t.lockLayout(p.LOCK_LAYOUT_LEVEL.PREVENT_DOCKING);break;case this.lock_layout_levels.FULL:t.lockLayout(p.LOCK_LAYOUT_LEVEL.FULL);break;case this.lock_layout_levels.NONE:t.lockLayout(p.LOCK_LAYOUT_LEVEL.NONE)}e.each(i,(function(e){e.name!="mnu_lock_"+n?e.change_checked(!1):e.change_checked(!0)}))},save_lock_layout:function(e){var t=d.default.pgAdmin.Browser;o.default.ajax({url:(0,r.default)("browser.lock_layout"),method:"PUT",contentType:"application/json",data:JSON.stringify({value:e})}).done((function(){t.cache_preferences("browser")})).fail((function(e,t){s.pgNotifier(t,e,(0,l.default)("Failed to save the lock layout setting."))}))},mnu_lock_docking:function(){this.lock_layout(this.docker,this.lock_layout_levels.PREVENT_DOCKING),this.save_lock_layout(this.lock_layout_levels.PREVENT_DOCKING)},mnu_lock_full:function(){this.lock_layout(this.docker,this.lock_layout_levels.FULL),this.save_lock_layout(this.lock_layout_levels.FULL)},mnu_lock_none:function(){this.lock_layout(this.docker,this.lock_layout_levels.NONE),this.save_lock_layout(this.lock_layout_levels.NONE)}})}).call(this,n(1))},,function(e,t,n){"use strict";n(42),n(4),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.pgBrowser=void 0;var i=l(n(0)),a=l(n(1)),r=l(n(3)),o=l(n(33)),s=n(22);function l(e){return e&&e.__esModule?e:{default:e}}var d=r.default.Browser=r.default.Browser||{};t.pgBrowser=d;a.default.extend(d,{inactivity_timeout_at:null,logging_activity:!1,inactivity_timeout_daemon_running:!1,is_pgadmin_timedout:function(){return!o.default.pgAdmin},is_inactivity_timeout:function(){return o.default.pgAdmin.Browser.inactivity_timeout_at<this.get_epoch_now()},get_epoch_now:function(){return(0,s.getEpoch)()},log_activity:function(){var e=this;this.logging_activity||(this.logging_activity=!0,this.inactivity_timeout_at=this.get_epoch_now()+r.default.user_inactivity_timeout,setTimeout((function(){e.logging_activity=!1}),1e3))},register_to_activity_listener:function(e,t){var n=["mousemove","mousedown","keydown"],i=this;n.forEach((function(a){e.addEventListener(a,(function a(){i.is_pgadmin_timedout()?(n.forEach((function(t){e.removeEventListener(t,a,!0)})),t()):o.default.pgAdmin.Browser.log_activity()}),!0)}))},override_activity_event_decorator:function(e){return function(){return r.default.override_user_inactivity_timeout&&o.default.pgAdmin.Browser.log_activity(),e.apply(this,arguments)}},logout_inactivity_user:function(){a.default.isUndefined(d.utils)||a.default.isUndefined(d.utils.logout_url)||(window.location.href=d.utils.logout_url)},start_inactivity_timeout_daemon:function(){var e=this;if(r.default.user_inactivity_timeout>0&&!e.inactivity_timeout_daemon_running)var t=setInterval((function(){e.inactivity_timeout_daemon_running=!0,e.is_inactivity_timeout()&&(clearInterval(t),e.inactivity_timeout_daemon_running=!1,(0,i.default)(window).off("beforeunload"),e.logout_inactivity_user())}),1e3)}})},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(8),n(17),n(15),n(4),n(31),n(12),n(23),n(44),n(20),n(7);var a=h(n(1)),r=h(n(3)),o=h(n(0)),s=h(n(96)),l=p(n(22)),d=h(n(109)),c=p(n(69)),u=h(n(33));function f(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return f=function(){return e},e}function p(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=f();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}function h(e){return e&&e.__esModule?e:{default:e}}var _=r.default.Browser=r.default.Browser||{};_.keyboardNavigation=_.keyboardNavigation||{},a.default.extend(_.keyboardNavigation,{init:function(){s.default.reset(),_.preferences_cache.length>0&&(this.keyboardShortcut={file_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_file").value),object_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_object").value),tools_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_tools").value),help_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_help").value),left_tree_shortcut:l.parseShortcutValue(_.get_preference("browser","browser_tree").value),tabbed_panel_backward:l.parseShortcutValue(_.get_preference("browser","tabbed_panel_backward").value),tabbed_panel_forward:l.parseShortcutValue(_.get_preference("browser","tabbed_panel_forward").value),sub_menu_query_tool:l.parseShortcutValue(_.get_preference("browser","sub_menu_query_tool").value),sub_menu_view_data:l.parseShortcutValue(_.get_preference("browser","sub_menu_view_data").value),sub_menu_properties:l.parseShortcutValue(_.get_preference("browser","sub_menu_properties").value),sub_menu_create:l.parseShortcutValue(_.get_preference("browser","sub_menu_create").value),sub_menu_delete:l.parseShortcutValue(_.get_preference("browser","sub_menu_delete").value),sub_menu_refresh:l.parseShortcutValue(_.get_preference("browser","sub_menu_refresh").value),context_menu:l.parseShortcutValue(_.get_preference("browser","context_menu").value),direct_debugging:l.parseShortcutValue(_.get_preference("browser","direct_debugging").value),drop_multiple_objects:l.parseShortcutValue(_.get_preference("browser","grid_menu_drop_multiple").value),drop_cascade_multiple_objects:l.parseShortcutValue(_.get_preference("browser","grid_menu_drop_cascade_multiple").value),add_grid_row:l.parseShortcutValue(_.get_preference("browser","add_grid_row").value)},this.shortcutMethods={bindMainMenu:{shortcuts:[this.keyboardShortcut.file_shortcut,this.keyboardShortcut.object_shortcut,this.keyboardShortcut.tools_shortcut,this.keyboardShortcut.help_shortcut]},bindRightPanel:{shortcuts:[this.keyboardShortcut.tabbed_panel_backward,this.keyboardShortcut.tabbed_panel_forward]},bindLeftTree:{shortcuts:this.keyboardShortcut.left_tree_shortcut},bindSubMenuQueryTool:{shortcuts:this.keyboardShortcut.sub_menu_query_tool},bindSubMenuViewData:{shortcuts:this.keyboardShortcut.sub_menu_view_data},bindSubMenuProperties:{shortcuts:this.keyboardShortcut.sub_menu_properties},bindSubMenuCreate:{shortcuts:this.keyboardShortcut.sub_menu_create},bindSubMenuDelete:{shortcuts:this.keyboardShortcut.sub_menu_delete},bindSubMenuRefresh:{shortcuts:this.keyboardShortcut.sub_menu_refresh,bindElem:"#tree"},bindContextMenu:{shortcuts:this.keyboardShortcut.context_menu},bindDirectDebugging:{shortcuts:this.keyboardShortcut.direct_debugging},bindDropMultipleObjects:{shortcuts:this.keyboardShortcut.drop_multiple_objects},bindDropCascadeMultipleObjects:{shortcuts:this.keyboardShortcut.drop_cascade_multiple_objects},bindAddGridRow:{shortcuts:this.keyboardShortcut.add_grid_row}},this.bindShortcuts())},bindShortcuts:function(){var e=this;a.default.each(e.shortcutMethods,(function(t,n){e._bindWithMousetrap(t.shortcuts,e[n],t.bindElem)}));(0,o.default)(".pg-navbar").on("keydown",(function(t){switch(t.keyCode){case 37:e.bindMainMenuLeft(t);break;case 38:e.bindMainMenuUpDown(t,"up");break;case 39:e.bindMainMenuRight(t);break;case 40:e.bindMainMenuUpDown(t,"down")}}))},_bindWithMousetrap:function(e,t,n){var i=this;if(s.default.unbind(e),n){var a=document.querySelector(n);(0,s.default)(a).bind(e,function(){t.apply(this,arguments)}.bind(a))}else s.default.bind(e,(function(){t.apply(i,arguments)}))},unbindShortcuts:function(){a.default.each(this.mousetrapInstances,(function(e){e.instance.reset()})),this.mousetrapInstances=[]},bindMainMenu:function(e,t){var n=this.keyboardShortcut;t===n.file_shortcut&&(0,o.default)("#mnu_file a.dropdown-toggle").dropdown("toggle"),t===n.object_shortcut&&(0,o.default)("#mnu_obj a.dropdown-toggle").first().dropdown("toggle"),t===n.tools_shortcut&&(0,o.default)("#mnu_tools a.dropdown-toggle").dropdown("toggle"),t===n.help_shortcut&&(0,o.default)("#mnu_help a.dropdown-toggle").dropdown("toggle")},bindRightPanel:function(e,t){var n=0,i=r.default.Browser.docker.findPanels().length-1,o=0,s=!1,l=this.keyboardShortcut;a.default.each(r.default.Browser.docker.findPanels(),(function(e,t){e.isVisible()&&!s&&"browser"!==e._type&&(o=t,s=!0)})),t===l.tabbed_panel_backward?n=o>0?o-1:1:t===l.tabbed_panel_forward&&(n=o<i?o+1:i),r.default.Browser.docker.findPanels()[n].focus(),setTimeout((function(){document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()}),1e3)},bindMainMenuLeft:function(e){if((0,o.default)(e.target).hasClass("nav-link")){var t=(0,o.default)(e.target).closest(".nav-item");for(c._stopEventPropagation(e),t=t.prev(".nav-item");t.hasClass("d-none");)t=t.prev(".nav-item");t.find(".dropdown-toggle").first().dropdown("toggle")}else if((0,o.default)(e.target).closest(".dropdown-menu").length>0){var n=(0,o.default)(e.target).closest("li");c._stopEventPropagation(e);var i=n.closest(".dropdown-menu");i.closest(".dropdown-submenu").length>0&&(i.removeClass("show"),i.closest(".dropdown-submenu").removeClass("dropdown-submenu-visible"),(n=i.closest(".dropdown-submenu")).find(".dropdown-item").trigger("focus"))}},bindMainMenuRight:function(e){if((0,o.default)(e.target).hasClass("nav-link")){var t=(0,o.default)(e.target).closest(".nav-item");for(c._stopEventPropagation(e),t=t.next(".nav-item");t.hasClass("d-none");)t=t.next(".nav-item");t.find(".dropdown-toggle").first().dropdown("toggle")}else if((0,o.default)(e.target).closest(".dropdown-menu").length>0){var n=(0,o.default)(e.target).closest("li");c._stopEventPropagation(e),n.hasClass("dropdown-submenu")&&(n.addClass("dropdown-submenu-visible"),n.find(".dropdown-menu").addClass("show"),n=n.find(".dropdown-menu .dropdown-item").first().trigger("focus"))}},bindMainMenuUpDown:function(e,t){if((0,o.default)(e.target).closest(".dropdown-menu").length>0){c._stopEventPropagation(e);var n=(0,o.default)(e.target).closest("li"),i=(0,o.default)(e.target).closest(".dropdown-menu");for(i.find(".show").removeClass("show"),i.find(".dropdown-submenu").removeClass("dropdown-submenu-visible"),"up"===t?n=n.prev():"down"===t&&(n=n.next());n.hasClass("dropdown-divider")||n.find(".dropdown-item").first().hasClass("disabled");)"up"===t?n=n.prev():"down"===t&&(n=n.next());n.find(".dropdown-item").trigger("focus")}},bindLeftTree:function(){var e=this.getTreeDetails();(0,o.default)("#tree").trigger("focus"),e.t.focus(e.i),e.t.select(e.i)},bindSubMenuQueryTool:function(){var e=this.getTreeDetails();e.d&&r.default.DataGrid.show_query_tool("",e.i)},bindSubMenuViewData:function(){var e=this.getTreeDetails();e.d&&r.default.DataGrid.show_data_grid({mnuid:1},e.i)},bindSubMenuProperties:function(){var e=this.getTreeDetails();e.d&&!0!==r.default.Browser.Nodes[e.t.itemData(e.i)._type].collection_node&&r.default.Browser.Node.callbacks.show_obj_properties.call(r.default.Browser.Nodes[e.t.itemData(e.i)._type],{action:"edit"})},bindSubMenuCreate:function(){var e=this.getTreeDetails(),t=r.default.Browser.Nodes[e.t.itemData(e.i)._type];if(e.d){if(!0===t.collection_node){if(!t.node)return;t=r.default.Browser.Nodes[t.node]}r.default.Browser.Node.callbacks.show_obj_properties.call(t,{action:"create",item:e.i})}},bindSubMenuDelete:function(){var e=this.getTreeDetails();e.d&&!0!==r.default.Browser.Nodes[e.t.itemData(e.i)._type].collection_node&&r.default.Browser.Node.callbacks.delete_obj.call(r.default.Browser.Nodes[e.t.itemData(e.i)._type])},bindSubMenuRefresh:function(e){e.preventDefault();var t=_.keyboardNavigation.getTreeDetails();r.default.Browser.Node.callbacks.refresh.call(r.default.Browser.Nodes[t.t.itemData(t.i)._type])},bindContextMenu:function(e){var t=this.getTreeDetails(),n=e.srcElement||e.target,i=(0,o.default)(n).find(".aciTreeEntry").position().left+70,a=(0,o.default)(n).find(".aciTreeEntry").position().top+70;t.t.blur(t.i),(0,o.default)("#tree").trigger("blur"),t.i.children().contextMenu({x:i,y:a})},bindDirectDebugging:function(){var e=this.getTreeDetails(),t=e.t.itemData(e.i)._type;!e.d||"function"!==t&&"procedure"!==t||r.default.Tools.Debugger.can_debug(e.d,e.i,{debug_type:"direct"})&&r.default.Tools.Debugger.get_function_information(r.default.Browser.Nodes[t])},bindDropMultipleObjects:function(){!0===this.isPropertyPanelVisible()&&(0,o.default)("button.delete_multiple").length>0&&(0,o.default)("button.delete_multiple").click()},bindDropCascadeMultipleObjects:function(){!0===this.isPropertyPanelVisible()&&(0,o.default)("button.delete_multiple_cascade").length>0&&(0,o.default)("button.delete_multiple_cascade").click()},bindAddGridRow:function(){var e=(0,o.default)(document.activeElement).closest(".object.subnode");(0,o.default)(e).length&&(0,o.default)(e).find(".add").click()},isPropertyPanelVisible:function(){var e=!1;return a.default.each(r.default.Browser.docker.findPanels(),(function(t){"properties"===t._type&&(e=t.isVisible())})),e},getTreeDetails:function(){var e=r.default.Browser.tree,t=e.selected().length>0?e.selected():e.first(),n=t&&1===t.length?e.itemData(t):void 0;return{t:e,i:t,d:n}},getDialogTabNavigator:function(e){var t=u.default.pgAdmin.Browser.get_preference("browser","dialog_tab_backward").value,n=u.default.pgAdmin.Browser.get_preference("browser","dialog_tab_forward").value;return new d.default.dialogTabNavigator(e,t,n)}}),e.exports=r.default.Browser.keyboardNavigation},,,,,,,function(e,t,n){"use strict";n(4),n(83),Object.defineProperty(t,"__esModule",{value:!0}),t.ModelValidation=void 0;var i=o(n(2)),a=o(n(1)),r=n(234);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.err={},this.errmsg="",this.model=t}var t,n,o;return t=e,o=[{key:"isEmptyString",value:function(e){return a.default.isUndefined(e)||a.default.isNull(e)||""===String(e).trim()}}],(n=[{key:"validate",value:function(){var t=this.model.get("service");return!this.model.isNew()&&"id"in this.model.sessAttrs?(this.err.id=(0,i.default)("The ID cannot be changed."),this.errmsg=this.err.id):this.model.errorModel.unset("id"),this.checkForEmpty("name",(0,i.default)("Name must be specified.")),e.isEmptyString(t)?(this.setNullValueForEmptyString("service"),this.checkHostAndHostAddress(),this.checkForEmpty("db",(0,i.default)("Maintenance database must be specified.")),this.checkForEmpty("username",(0,i.default)("Username must be specified.")),this.checkForEmpty("port",(0,i.default)("Port must be specified."))):(this.checkForEmpty("db",(0,i.default)("Maintenance database must be specified.")),this.clearHostAddressAndDbErrors()),this.model.get("use_ssh_tunnel")&&(this.checkForEmpty("tunnel_host",(0,i.default)("SSH Tunnel host must be specified.")),this.checkForEmpty("tunnel_port",(0,i.default)("SSH Tunnel port must be specified.")),this.checkForEmpty("tunnel_username",(0,i.default)("SSH Tunnel username must be specified.")),this.model.get("tunnel_authentication")&&this.checkForEmpty("tunnel_identity_file",(0,i.default)("SSH Tunnel identity file must be specified."))),this.model.errorModel.set(this.err),a.default.size(this.err)?this.errmsg:null}},{key:"setNullValueForEmptyString",value:function(e){var t=this.model.get(e);a.default.isUndefined(t)||a.default.isNull(t)||""===String(t).trim()&&this.model.set(e,null)}},{key:"clearHostAddressAndDbErrors",value:function(){var e=this;a.default.each(["host","hostaddr","db","username","port"],(function(t){e.setNullValueForEmptyString(t),e.model.errorModel.unset(t)}))}},{key:"checkHostAndHostAddress",value:function(){var e=(0,i.default)("Either Host name, Address or Service must be specified.");this.checkForEmpty("host",e)&&this.checkForEmpty("hostaddr",e)?this.errmsg=this.errmsg||e:(this.errmsg=void 0,delete this.err.host,delete this.err.hostaddr),this.checkForValidIp(this.model.get("hostaddr"),(0,i.default)("Host address must be valid IPv4 or IPv6 address."))}},{key:"checkForValidIp",value:function(e,t){if(e){var n=new r.Address6(e).isValid();new r.Address4(e).isValid()||n||(this.err.hostaddr=t,this.errmsg=t)}else this.model.errorModel.unset("hostaddr")}},{key:"checkForEmpty",value:function(t,n){var i=this.model.get(t);return e.isEmptyString(i)?(this.err[t]=n,this.errmsg=this.errmsg||n,!0):(this.model.errorModel.unset(t),!1)}}])&&s(t.prototype,n),o&&s(t,o),e}();t.ModelValidation=l},,,,function(e,t,n){"use strict";var i,a;n(38),n(16),n(34),n(95),n(11),n(5),n(9),n(29),n(7),i=[n(2),n(0),n(1),n(14),n(10),n(18),n(30),n(25)],void 0===(a=function(e,t,n,i,a,r,o){o.PartitionRow=o.Row.extend({modelDuplicateClass:"bg-model-duplicate",initialize:function(){o.Row.prototype.initialize.apply(this,arguments);var e=this;e.model.on("change:is_attach",(function(){setTimeout((function(){e.columns.each((function(t){if("partition_name"==t.get("name")){var n=e.columns.indexOf(t),i=new(t.get("cellFunction").apply(t,[e.model]))({column:t,model:e.model});e.cells[n].remove(),e.cells[n]=i,e.render()}}))}),10)})),e.listenTo(e.model,"pgadmin-session:model:duplicate",e.modelDuplicate),e.listenTo(e.model,"pgadmin-session:model:unique",e.modelUnique)},modelDuplicate:function(){t(this.el).removeClass("new"),t(this.el).addClass(this.modelDuplicateClass)},modelUnique:function(){t(this.el).removeClass(this.modelDuplicateClass)}});r.PartitionKeyModel=a.Node.Model.extend({defaults:{key_type:"column",pt_column:void 0,expression:void 0},keys:["pt_column"],schema:[{id:"key_type",label:e("Key type"),type:"select2",editable:!0,cell:"select2",cellHeaderClasses:"width_percent_25",select2:{allowClear:!1},options:[{label:e("Column"),value:"column"},{label:e("Expression"),value:"expression"}]},{id:"pt_column",label:e("Column"),type:"text",cell:o.Extension.Select2DepCell.extend({keyPathAccessor:function(e,t){var i=e;if(n.isArray(i))return n.map(i,(function(e){return e.pt_column}));t=t.split(".");for(var a=0;a<t.length;a++){if(n.isNull(i))return null;n.isEmpty(t[a])||(n.isUndefined(i[t[a]])||(i=i[t[a]]))}return n.isObject(i)&&!n.isArray(i)?null:i},initialize:function(){var e=this;if(this.model.handler){if(o.Extension.Select2DepCell.prototype.initialize.apply(this,arguments),n.isUndefined(e.model.get("oid"))){var t=e.model.top.get("columns");e.listenTo(t,"remove",e.resetColOptions),e.listenTo(t,"change:name",e.resetColOptions)}e.custom_options()}},resetColOptions:function(){var e=this;setTimeout((function(){e.custom_options(),e.render.apply(e)}),50)},custom_options:function(){var e=this.model.top.get("columns"),t=this.model.top.get("typname"),i=this.model.top.of_types_tables,a=[];e.length>0?n.each(e.models,(function(e){var t=e.get("name");n.isUndefined(t)||n.isNull(t)||a.push({label:t,value:t,image:"icon-column"})})):!n.isUndefined(t)&&!n.isNull(t)&&!n.isUndefined(i)&&i.length>0&&n.each(i,(function(e){e.label==t&&n.each(e.oftype_columns,(function(e){a.push({label:e.name,value:e.name,image:"icon-column"})}))})),this.column.set("options",a)},remove:function(){if(this.model.handler){var e=this,t=e.model.top.get("columns");e.stopListening(t,"remove",e.resetColOptions),e.stopListening(t,"change:name",e.resetColOptions),o.Extension.Select2DepCell.prototype.remove.apply(this,arguments)}}}),deps:["key_type"],cellHeaderClasses:"width_percent_30",transform:function(e){var t=[];return e&&n.isArray(e)&&n.each(e,(function(e){t.push({label:e.label,value:e.label,image:"icon-column"})})),t},select2:{allowClear:!1},editable:function(e){return"expression"!=e.get("key_type")||(setTimeout((function(){e.set("pt_column",void 0)}),10),!1)}},{id:"expression",label:e("Expression"),type:"text",cell:o.Extension.StringDepCell,cellHeaderClasses:"width_percent_45",deps:["key_type"],editable:function(e){return"column"!=e.get("key_type")||(setTimeout((function(){e.set("expression",void 0)}),10),!1)}}],validate:function(){var t,i=this.get("key_type"),a=this.get("pt_column"),r=this.get("expression");return this.errorModel.clear(),n.isUndefined(i)||n.isNull(i)||""==String(i).replace(/^\s+|\s+$/g,"")?(t=e("Partition key type cannot be empty."),this.errorModel.set("key_type",t),t):"column"==i&&n.isUndefined(a)||n.isNull(a)||""==String(a).replace(/^\s+|\s+$/g,"")?(t=e("Partition key column cannot be empty."),this.errorModel.set("pt_column",t),t):"expression"==i&&n.isUndefined(r)||n.isNull(r)||""==String(r).replace(/^\s+|\s+$/g,"")?(t=e("Partition key expression cannot be empty."),this.errorModel.set("expression",t),t):null}}),r.PartitionsModel=a.Node.Model.extend({idAttribute:"oid",defaults:{oid:void 0,is_attach:!1,partition_name:void 0,is_default:void 0,values_from:void 0,values_to:void 0,values_in:void 0,values_modulus:void 0,values_remainder:void 0,is_sub_partitioned:!1,sub_partition_type:"range"},keys:["partition_name"],schema:[{id:"oid",label:e("OID"),type:"text",mode:["properties"]},{id:"is_attach",label:e("Operation"),cell:"switch",type:"switch",options:{onText:e("Attach"),offText:e("Create"),width:65},cellHeaderClasses:"width_percent_5",editable:function(e){return!(!(e instanceof i.Model&&e.isNew())||e.top.isNew())},disabled:function(e){return!(e instanceof i.Model&&e.isNew()&&!e.top.isNew())}},{id:"partition_name",label:e("Name"),type:"text",cell:"string",cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e instanceof i.Model&&e.isNew())},cellFunction:function(e){if(e.get("is_attach")){var t=[];return e.set({partition_name:void 0},{silent:!0}),n.each(e.top.table_options,(function(e){t.push([e.label,e.value])})),o.Extension.Select2Cell.extend({optionValues:t})}return o.StringCell},disabled:function(e){return!(e instanceof i.Model&&e.isNew())}},{id:"is_default",label:e("Default"),type:"switch",cell:"switch",cellHeaderClasses:"width_percent_5",min_version:11e4,options:{onText:e("Yes"),offText:e("No")},editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&("range"===e.handler.top.attributes.partition_type||"list"===e.handler.top.attributes.partition_type)&&e instanceof i.Model&&e.isNew()&&e.handler.top.node_info.server.version>=11e4)},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&("range"===e.handler.top.attributes.partition_type||"list"===e.handler.top.attributes.partition_type)&&e instanceof i.Model&&e.isNew()&&e.handler.top.node_info.server.version>=11e4)}},{id:"values_from",label:e("From"),type:"text",cell:o.Extension.StringDepCell,deps:["is_default"],cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew()&&!0!==e.get("is_default"))},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew()&&!0!==e.get("is_default"))}},{id:"values_to",label:e("To"),type:"text",cell:o.Extension.StringDepCell,deps:["is_default"],cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew()&&!0!==e.get("is_default"))},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew()&&!0!==e.get("is_default"))}},{id:"values_in",label:e("In"),type:"text",cell:o.Extension.StringDepCell,deps:["is_default"],cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"list"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew()&&!0!==e.get("is_default"))},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"list"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew()&&!0!==e.get("is_default"))}},{id:"values_modulus",label:e("Modulus"),type:"int",cell:o.Extension.StringDepCell,cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew())},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew())}},{id:"values_remainder",label:e("Remainder"),type:"int",cell:o.Extension.StringDepCell,cellHeaderClasses:"width_percent_15 width_percent_20",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew())},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof i.Model&&e.isNew())}},{id:"is_sub_partitioned",label:e("Partitioned table?"),cell:"switch",group:"Partition",type:"switch",mode:["properties","create","edit"],deps:["is_attach"],disabled:function(e){return!e.isNew()||!!e.get("is_attach")&&(setTimeout((function(){e.set("is_sub_partitioned",!1)}),10),!0)}},{id:"sub_partition_type",label:e("Partition Type"),editable:!1,type:"select2",select2:{allowClear:!1},group:"Partition",deps:["is_sub_partitioned"],options:function(){var t=[{label:e("Range"),value:"range"},{label:e("List"),value:"list"}];return!n.isUndefined(this.node_info)&&!n.isUndefined(this.node_info.server)&&!n.isUndefined(this.node_info.server.version)&&this.node_info.server.version>=11e4&&t.push({label:e("Hash"),value:"hash"}),t},visible:function(e){return!!e.isNew()},disabled:function(e){return!e.isNew()||!e.get("is_sub_partitioned")}},{id:"sub_partition_keys",label:e("Partition Keys"),model:r.PartitionKeyModel,subnode:r.PartitionKeyModel,editable:!0,type:"collection",group:"Partition",mode:["properties","create","edit"],deps:["is_sub_partitioned","sub_partition_type"],canEdit:!1,canDelete:!0,control:"sub-node-collection",canAdd:function(e){return!(!e.isNew()||!e.get("is_sub_partitioned"))},canAddRow:function(e){var t=e.top.get("columns"),i=e.top.get("typname"),a=!1,r=1e3;return e.get("sub_partition_type")&&"list"==e.get("sub_partition_type")&&(r=1),t.length<=0&&!n.isUndefined(i)&&!n.isNull(i)&&e.of_types_tables.length>0?n.each(e.of_types_tables,(function(e){e.label==i&&e.oftype_columns.length>0&&(a=!0)})):t.length>0&&(a=n.some(t.pluck("name"))),e.get("sub_partition_keys")&&e.get("sub_partition_keys").length<r&&a},disabled:function(e){e.get("sub_partition_keys")&&e.get("sub_partition_keys").models.length>0&&setTimeout((function(){var t=e.get("sub_partition_keys");t.remove(t.filter((function(){return!0})))}),10)},visible:function(e){return!!e.isNew()}},{id:"sub_partition_scheme",label:e("Partition Scheme"),type:"note",group:"Partition",mode:["edit"],visible:function(e){return!e.isNew()&&!n.isUndefined(e.get("sub_partition_scheme"))&&""!=e.get("sub_partition_scheme")},disabled:function(e){e.isNew()||(this.text=e.get("sub_partition_scheme"))}}],validate:function(){var t,i=this.get("partition_name"),a=this.get("is_default"),r=this.get("values_from"),o=this.get("values_to"),s=this.get("values_in"),l=this.get("values_modulus"),d=this.get("values_remainder"),c=this.get("is_sub_partitioned"),u=this.get("sub_partition_keys");if(this.errorModel.clear(),this.top.errorModel.clear(),n.isUndefined(i)||n.isNull(i)||""===String(i).replace(/^\s+|\s+$/g,""))return t=e("Partition name cannot be empty."),this.errorModel.set("partition_name",t),t;if(c&&this.isNew()&&!n.isNull(u)&&u.length<=0)return t=e("Please specify at least one key for partitioned table."),this.top.errorModel.set("sub_partition_keys",t),t;if("range"===this.top.get("partition_type")){if(!0!==a&&(n.isUndefined(r)||n.isNull(r)||""===String(r).replace(/^\s+|\s+$/g,"")))return t=e("For range partition From field cannot be empty."),this.errorModel.set("values_from",t),t;if(!0!==a&&(n.isUndefined(o)||n.isNull(o)||""===String(o).replace(/^\s+|\s+$/g,"")))return t=e("For range partition To field cannot be empty."),this.errorModel.set("values_to",t),t}else if("list"===this.top.get("partition_type")){if(!0!==a&&(n.isUndefined(s)||n.isNull(s)||""===String(s).replace(/^\s+|\s+$/g,"")))return t=e("For list partition In field cannot be empty."),this.errorModel.set("values_in",t),t}else if("hash"===this.top.get("partition_type")){if(n.isUndefined(l)||n.isNull(l)||""===String(l).replace(/^\s+|\s+$/g,""))return t=e("For hash partition Modulus field cannot be empty."),this.errorModel.set("values_modulus",t),t;if(n.isUndefined(d)||n.isNull(d)||""===String(d).replace(/^\s+|\s+$/g,""))return t=e("For hash partition Remainder field cannot be empty."),this.errorModel.set("values_remainder",t),t}return null}})}.apply(t,i))||(e.exports=a)},,function(e,t,n){"use strict";var i,a;n(34),i=[n(0),n(1),n(98),n(54),n(290)],void 0===(a=function(e,t,n,i,a){var r=function(){return!e(".copy-with-header").hasClass("visibility-hidden")},o=function(t,n){t&&e("#btn-paste-row").prop("disabled",!n)};return function(){var e=this||window,t=e.slickgrid,s=t.getColumns(),l=t.getSelectionModel().getSelectedRanges(),d=t.getData(),c=t.getSelectedRows(),u=t.CSVOptions;i.areAllRangesCompleteRows(t,l)?(e.copied_rows=c.map((function(e){return t.getDataItem(e)})),o(e.can_edit,!0)):(e.copied_rows=[],o(e.can_edit,!1));var f=a.rangesToCsv(d.getItems(),s,l,u,r());f&&n.copyTextToClipboard(f)}}.apply(t,i))||(e.exports=a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(t){n(8),n(7);var i=d(n(2)),a=d(n(6)),r=d(n(0)),o=d(n(13)),s=d(n(3)),l=n(97);function d(e){return e&&e.__esModule?e:{default:e}}e.exports=o.default.dialog("fileSelectionDlg",(function(){return{main:function(e){t.isUndefined(e.dialog_title)&&(e.dialog_title="Select file"),this.dialog_type=e.dialog_type,this.set("title",e.dialog_title),this.params=JSON.stringify(e),this.elements.dialog.style.minWidth="630px",this.show()},settings:{label:void 0},settingUpdated:function(e,t,n){switch(e){case"message":this.setMessage(n);break;case"label":this.__internal.buttons[0].element&&(this.__internal.buttons[0].element.innerHTML=n)}},prepare:function(){var e=this;e.$container.find(".storage_content").remove(),e.$container.append("<div class='storage_content'></div>");var t=e.$container.find(".storage_content");t.empty(),(0,r.default)(this.elements.body.childNodes[0]).addClass("alertify_tools_dialog_properties"),r.default.get((0,a.default)("file_manager.index"),(function(e){t.append(e)}));var n,i=(0,l.getTransId)(e.params);4==i.readyState&&(n=JSON.parse(i.responseText)),e.trans_id=n.data.fileTransId,setTimeout((function(){(0,r.default)(e.$container.find(".file_manager")).on("enter-key",(function(){(0,r.default)((0,r.default)(e.elements.footer).find(".file_manager_ok")).trigger("click")}))}),200),e.__internal.buttons[1].element.disabled=!0},setup:function(){return{buttons:[{text:(0,i.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button"},{text:(0,i.default)("Select"),key:13,className:"btn btn-primary fa fa-file file_manager_ok pg-alertify-button disabled"}],options:{closableByDimmer:!1,maximizable:!1,closable:!1,movable:!0,padding:!1,overflow:!1,model:0,resizable:!0,pinnable:!1,modal:!1,autoReset:!1}}},callback:function(e){var t;if(e.button.text==(0,i.default)("Select")){var n=(0,r.default)(".storage_dialog #uploader .input-path").val(),a={path:(0,r.default)(".currentpath").val()};s.default.Browser.Events.trigger("pgadmin-storage:finish_btn:"+this.dialog_type,n),t=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(t).find("*").off(),t.remove(),(0,l.removeTransId)(this.trans_id),(0,l.set_last_traversed_dir)(a,this.trans_id)}else e.button.text==(0,i.default)("Cancel")&&(t=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(t).find("*").off(),t.remove(),(0,l.removeTransId)(this.trans_id),s.default.Browser.Events.trigger("pgadmin-storage:cancel_btn:"+this.dialog_type))},build:function(){this.$container=(0,r.default)('<div class="storage_dialog file_selection_dlg"></div>'),this.elements.content.appendChild(this.$container.get(0)),o.default.pgDialogBuild.apply(this)},hooks:{onshow:function(){}}}}))}).call(this,n(1))},function(e,t,n){"use strict";(function(t){n(8),n(231),n(106),n(5),n(232),n(29);var i=d(n(2)),a=d(n(6)),r=d(n(0)),o=d(n(13)),s=d(n(3)),l=n(97);function d(e){return e&&e.__esModule?e:{default:e}}e.exports=o.default.dialog("createModeDlg",(function(){return{setup:function(){return{buttons:[{text:(0,i.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times file_manager_create_cancel pg-alertify-button"},{text:(0,i.default)("Create"),key:13,className:"btn btn-primary fa fa-file file_manager_create file_manager_ok pg-alertify-button disabled"}],options:{closableByDimmer:!1,maximizable:!1,closable:!1,movable:!0,padding:!1,overflow:!1,model:0,resizable:!0,pinnable:!1,modal:!1,autoReset:!1}}},replace_file:function(){var e=(0,r.default)(".replace_file .btn_yes"),t=(0,r.default)(".replace_file .btn_no");(0,r.default)(".storage_dialog #uploader .input-path").attr("disabled",!0),(0,r.default)(".file_manager_ok").addClass("disabled"),(0,r.default)(".replace_file, .fm_dimmer").show(),e.on("click",(function(){(0,r.default)(".replace_file, .fm_dimmer").hide(),e.off(),t.off();var n=(0,r.default)(".storage_dialog #uploader .input-path").val();s.default.Browser.Events.trigger("pgadmin-storage:finish_btn:create_file",n),(0,r.default)(".file_manager_create_cancel").trigger("click"),(0,r.default)(".storage_dialog #uploader .input-path").attr("disabled",!1),(0,r.default)(".file_manager_ok").removeClass("disabled")})),t.on("click",(function(){(0,r.default)(".replace_file, .fm_dimmer").hide(),e.off(),t.off(),(0,r.default)(".storage_dialog #uploader .input-path").attr("disabled",!1),(0,r.default)(".file_manager_ok").removeClass("disabled")}))},is_file_exist:function(){var e=(0,r.default)(".storage_dialog #uploader .input-path").val(),t=e.substr(0,e.lastIndexOf("/")+1),n=e.substr(e.lastIndexOf("/")+1),i=!1,o={path:t,name:n,mode:"is_file_exist"};return r.default.ajax({type:"POST",data:JSON.stringify(o),url:(0,a.default)("file_manager.filemanager",{trans_id:this.trans_id}),dataType:"json",contentType:"application/x-download; charset=utf-8",async:!1}).done((function(e){var t=e.data.result;i=1===t.Code})),i},check_permission:function(e){var t=!1,n={path:e,mode:"permission"};return r.default.ajax({type:"POST",data:JSON.stringify(n),url:(0,a.default)("file_manager.filemanager",{trans_id:this.trans_id}),dataType:"json",contentType:"application/json; charset=utf-8",async:!1}).done((function(e){var n=e.data.result;1===n.Code?t=!0:((0,r.default)(".file_manager_ok").addClass("disabled"),o.default.error(n.Error))})).fail((function(){(0,r.default)(".file_manager_ok").addClass("disabled"),o.default.error((0,i.default)("Error occurred while checking access permission."))})),t},callback:function(e){if(e.button.text==(0,i.default)("Create")){var n,a=(0,r.default)(".storage_dialog #uploader .input-path").val(),o={path:(0,r.default)(".currentpath").val()},d="/",c=(0,r.default)(".allowed_file_types select").val();if("win32"===(0,r.default)(".file_manager").attr("data-platform")&&(d="\\"),a.includes(".")&&!a.split(".").pop().includes(d)||"*"==c||(a=a+"."+c,(0,r.default)(".storage_dialog #uploader .input-path").val(a)),!this.check_permission(a))return void(e.cancel=!0);!t.isUndefined(a)&&""!==a&&this.is_file_exist()?(this.replace_file(),this.$container.find(".replace_file").find(".btn_yes").trigger("focus"),e.cancel=!0):(s.default.Browser.Events.trigger("pgadmin-storage:finish_btn:create_file",a),n=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(n).find("*").off(),n.remove(),(0,l.removeTransId)(this.trans_id)),(0,l.set_last_traversed_dir)(o,this.trans_id)}else e.button.text==(0,i.default)("Cancel")&&(n=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(n).find("*").off(),n.remove(),(0,l.removeTransId)(this.trans_id),s.default.Browser.Events.trigger("pgadmin-storage:cancel_btn:create_file"))}}}),!0,"fileSelectionDlg")}).call(this,n(1))},,,,,,,,function(e,t){e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.disableTriggers=function(e,t,n,i){return r(e,t,n,i,{is_enable_trigger:"D"})},t.enableTriggers=function(e,t,n,i){return r(e,t,n,i,{is_enable_trigger:"O"})};var i,a=(i=n(66))&&i.__esModule?i:{default:i};function r(e,t,n,i,r){var o=function(e,t){var n=(e||{}).item||t.selected();return t.findNodeByDomElement(n)}(i,e);if(!o||null===o.getData()||void 0===o.getData())return!1;a.default.put(n(o.getHtmlIdentifier(),"set_trigger",o.getData(),!0),r).then((function(n){1===n.data.success&&(t.success(n.data.info),o.reload(e))})).catch((function(n){try{var i=n.response.data;0===i.success&&t.error(i.errormsg)}catch(e){console.warn(e.stack||e)}o.unload(e)}))}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(17),n(4),n(31),n(12),n(23),n(44),n(20),Object.defineProperty(t,"__esModule",{value:!0}),t.show_advanced_tab=function(e){if(function(e){return!a.isUndefined(e.node_info)&&!a.isUndefined(e.node_info.server)&&"gpdb"===e.node_info.server.server_type}(e))return!1;return!0};var a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(n(1));function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}},,,,,function(e,t,n){"use strict";var i,a;function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(19),n(28),n(38),n(8),n(42),n(16),n(17),n(106),n(34),n(56),n(91),n(47),n(186),n(32),n(15),n(11),n(118),n(62),n(4),n(31),n(63),n(41),n(12),n(35),n(5),n(43),n(23),n(59),n(9),n(29),n(83),n(50),n(20),n(7),n(200),i=[n(2),n(6),n(0),n(281),n(353),n(1),n(13),n(3),n(14),n(75),n(283),n(287),n(289),n(98),n(201),n(54),n(354),n(292),n(293),n(57),n(294),n(111),n(295),n(297),n(298),n(299),n(302),n(69),n(165),n(303),n(150),n(87),n(166),n(304),n(305),n(164),n(86),n(76),n(33),n(280),n(228),n(359),n(360),n(306),n(10),n(110)],void 0===(a=function(e,t,n,i,a,r,l,d,c,u,f,p,h,_,g,m,b,v,y,w,x,C,S,k,T,E,P,q,O,D,N,j,A,M,R,I,L,B,V){if(d.SqlEditor)return d.SqlEditor;var U=window.wcDocker,F=d.Browser,H=u.default,z=window.Slick,K=T.default,G=E.default,$=P.QuerySources;L.setPGCSRFToken(d.csrf_token_header,d.csrf_token);var Q=!1,J=c.View.extend({initialize:function(e){this.$el=e.el,this.handler=e.handler,this.handler.col_size={};var t=V.default.pgAdmin.Browser;this.preferences=t.get_preferences_for_module("sqleditor"),this.handler.preferences=this.preferences,this.connIntervalId=null,this.layout=e.layout,this.set_server_version(e.server_ver),this.trigger("pgadmin-sqleditor:view:initialised")},events:{"click .btn-load-file":"on_file_load","click #btn-save-file":"on_save_file","click #btn-file-menu-save":"on_save_file","click #btn-file-menu-save-as":"on_save_as","click #btn-find":"on_find","click #btn-find-menu-find":"on_find","click #btn-find-menu-find-next":"on_find_next","click #btn-find-menu-find-previous":"on_find_previous","click #btn-find-menu-replace":"on_replace","click #btn-find-menu-replace-all":"on_replace_all","click #btn-find-menu-find-persistent":"on_find_persistent","click #btn-find-menu-jump":"on_jump","click #btn-delete-row":"on_delete","click #btn-save-data":"on_save_data","click #btn-filter":"on_show_filter","click #btn-filter-menu":"on_show_filter","click #btn-include-filter":"on_include_filter","click #btn-exclude-filter":"on_exclude_filter","click #btn-remove-filter":"on_remove_filter","click #btn-cancel":"on_cancel","click #btn-copy-row":"on_copy_row","click #btn-copy-with-header":"on_copy_row_with_header","click #btn-paste-row":"on_paste_row","click #btn-flash":"on_flash","click #btn-flash-menu":"on_flash","click #btn-cancel-query":"on_cancel_query","click #btn-download":"on_download","click #btn-clear":"on_clear","click #btn-auto-commit":"on_auto_commit","click #btn-auto-rollback":"on_auto_rollback","click #btn-clear-history":"on_clear_history","click .noclose":"do_not_close_menu","click #btn-explain":"on_explain","click #btn-explain-analyze":"on_explain_analyze","click #btn-explain-verbose":"on_explain_verbose","click #btn-explain-costs":"on_explain_costs","click #btn-explain-buffers":"on_explain_buffers","click #btn-explain-timing":"on_explain_timing","click #btn-explain-summary":"on_explain_summary","click #btn-explain-settings":"on_explain_settings","change .limit":"on_limit_change",keydown:"keyAction","click #btn-comment-code":"on_toggle_comment_block_code","click #btn-toggle-comment-block":"on_toggle_comment_block_code","click #btn-comment-line":"on_comment_line_code","click #btn-uncomment-line":"on_uncomment_line_code","click #btn-indent-code":"on_indent_code","click #btn-unindent-code":"on_unindent_code","click #btn-commit":"on_commit_transaction","click #btn-rollback":"on_rollback_transaction"},reflectPreferences:function(){var e=V.default.pgAdmin.Browser;F.preference_version()<e.preference_version()&&(F.preference_version(e.preference_version()),this.preferences=e.get_preferences_for_module("sqleditor"),this.handler.preferences=this.preferences,R.updateUIPreferences(this))},buildDefaultLayout:function(e){var t=e.addPanel("sql_panel",U.DOCK.TOP);e.addPanel("scratch",U.DOCK.RIGHT,t),e.addPanel("history",U.DOCK.STACKED,t);var n=e.addPanel("data_output",U.DOCK.BOTTOM);e.addPanel("explain",U.DOCK.STACKED,n),e.addPanel("messages",U.DOCK.STACKED,n),e.addPanel("notifications",U.DOCK.STACKED,n)},set_server_version:function(e){var t=this;t.server_ver=e,this.$el.find("*[data-min-ver]").map((function(){var e=n(this);parseInt(e.attr("data-min-ver"))>t.server_ver?e.addClass("d-none"):e.removeClass("d-none")}))},set_editor_title:function(e){this.$el.find(".editor-title").text(e)},render:function(){var i=this;i.gain_focus=function(){setTimeout((function(){w.updateConnectionStatusFlag("visible")}),100)},i.lost_focus=function(){setTimeout((function(){w.updateConnectionStatusFlag("hidden")}),100)},i.docker=new U("#editor-panel",{allowContextMenu:!0,allowCollapse:!1,loadingClass:"pg-sp-icon",themePath:t("static",{filename:"css"}),theme:"webcabin.overrides.css"});var a=new d.Browser.Panel({name:"sql_panel",title:e("Query Editor"),width:"75%",height:"33%",isCloseable:!1,isPrivate:!0}),s=new d.Browser.Panel({name:"data_output",title:e("Data Output"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,extraClasses:"hide-vertical-scrollbar",content:'<div id ="datagrid" class="sql-editor-grid-container text-12" tabindex="0"></div>'}),c=new d.Browser.Panel({name:"explain",title:e("Explain"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div class="sql-editor-explain" tabindex="0"></div>'}),u=new d.Browser.Panel({name:"messages",title:e("Messages"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div role="status" class="sql-editor-message" tabindex="0"></div>'}),f=new d.Browser.Panel({name:"history",title:e("Query History"),width:"100%",height:"33%",isCloseable:!1,isPrivate:!0,content:'<div id ="history_grid" class="sql-editor-history-container" tabindex="0"></div>'}),p=new d.Browser.Panel({name:"scratch",title:e("Scratch Pad"),width:"25%",height:"33%",isCloseable:!0,isPrivate:!1,content:'<div class="sql-scratch"><textarea wrap="off" tabindex="0"></textarea></div>'}),h=new d.Browser.Panel({name:"notifications",title:e("Notifications"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div id ="notification_grid" class="sql-editor-notifications" tabindex="0"></div>'}),_=new d.Browser.Panel({name:"geometry_viewer",title:e("Geometry Viewer"),width:"100%",height:"100%",isCloseable:!0,isPrivate:!0,isLayoutMember:!1,content:'<div id ="geometry_viewer_panel" class="sql-editor-geometry-viewer" tabindex="0"></div>'});a.load(i.docker),s.load(i.docker),c.load(i.docker),u.load(i.docker),f.load(i.docker),p.load(i.docker),h.load(i.docker),_.load(i.docker),F.restore_layout(i.docker,this.layout,this.buildDefaultLayout.bind(this)),i.docker.on(U.EVENT.LAYOUT_CHANGED,(function(){F.save_current_layout("SQLEditor/Layout",i.docker)})),i.sql_panel_obj=i.docker.findPanels("sql_panel")[0],i.history_panel=i.docker.findPanels("history")[0],i.data_output_panel=i.docker.findPanels("data_output")[0],i.explain_panel=i.docker.findPanels("explain")[0],i.messages_panel=i.docker.findPanels("messages")[0],i.notifications_panel=i.docker.findPanels("notifications")[0],i.sql_panel_obj.on(U.EVENT.RESIZE_ENDED,(function(){setTimeout((function(){i&&i.query_tool_obj&&i.query_tool_obj.refresh()}),200)})),i.render_history_grid(),F.Events.on("pgadmin:query_tool:connected:"+i.handler.transId,(function(){i.fetch_query_history()})),D.renderNotificationsGrid(i.notifications_panel);var g=n('<textarea id="sql_query_tool" tabindex="-1"></textarea>'),m=n('<div id="output-panel" tabindex="0"></div>').append(g);i.sql_panel_obj.$container.find(".pg-panel-content").append(m),i.query_tool_obj=H.fromTextArea(g.get(0),{tabindex:"0",lineNumbers:!0,styleSelectedText:!0,mode:"gpdb"===i.handler.server_type?"text/x-gpsql":"text/x-pgsql",foldOptions:{widget:""},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:F.editor_shortcut_keys,scrollbarStyle:"simple",dragDrop:!1}),i.handler.is_query_tool&&(i.query_tool_obj.setOption("dragDrop",!0),i.query_tool_obj.on("drop",(function(e,t){var n=null;try{n=JSON.parse(t.dataTransfer.getData("text")),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()}catch(e){return}var i=e.coordsChar({left:t.x,top:t.y});e.replaceRange(n.text,i),e.focus(),e.setSelection(o({},i,{ch:i.ch+n.cur.from}),o({},i,{ch:i.ch+n.cur.to}))}))),F.Events.on("pgadmin:query_tool:sql_panel:focus",(function(){i.query_tool_obj.focus()})),F.Events.on("pgadmin:query_tool:explain:focus",(function(){setTimeout((function(){n(".sql-editor-explain .backform-tab .nav-link.active").focus()}),200)})),i.preferences.new_browser_tab||(r.each(V.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(e){e.isVisible()&&(e.on(U.EVENT.CLOSING,(function(){return i.handler.check_needed_confirmations_before_closing_panel(!0)})),e.on(U.EVENT.GAIN_FOCUS,(function(){var e=n(this.$container),t=i.handler.transId;e.hasClass("wcPanelTabContentHidden")||(setTimeout((function(){i.handler.gridView.query_tool_obj.focus()}),200),F.Events.trigger("pgadmin:query_tool:panel:gain_focus:"+t))})),e.on(U.EVENT.LOST_FOCUS,(function(){var e=n(this.$container),t=i.handler.transId;e.hasClass("wcPanelTabContentHidden")&&F.Events.trigger("pgadmin:query_tool:panel:lost_focus:"+t)})))})),F.Events.on("pgadmin:query_tool:panel:gain_focus:"+i.handler.transId,i.gain_focus,i),F.Events.on("pgadmin:query_tool:panel:lost_focus:"+i.handler.transId,i.lost_focus,i)),setTimeout((function(){i.query_tool_obj.focus()}),500),H.registerHelper("hint","sql",(function(e){var a=[],o=e.getDoc(),s=o.getCursor(),l=s.ch,c={editor:e,url:t("sqleditor.autocomplete",{trans_id:i.transId}),data:a,current_line:s.line,hint_render:function(e,t,n){var i=document.createElement("span");switch(n.type){case"database":i.className="sqleditor-hint pg-icon-"+n.type;break;case"datatype":i.className="sqleditor-hint icon-type";break;case"keyword":i.className="fa fa-key";break;case"table alias":i.className="fa fa-at";break;default:i.className="sqleditor-hint icon-"+n.type}i.appendChild(document.createTextNode(n.text)),e.appendChild(i)}};return a.push(o.getValue()),a.push(o.getRange({line:0,ch:0},{line:c.current_line,ch:l})),{then:function(e){var t=this;n.ajax({url:t.url,method:"POST",contentType:"application/json",data:JSON.stringify(t.data)}).done((function(n){var i=[];r.each(n.data.result,(function(e,n){i.push({text:n,type:e.object_type,render:t.hint_render})})),i.sort((function(e,t){var n=e.text.toLowerCase(),i=t.text.toLowerCase();return n<i?-1:n>i?1:0}));var a,o,l,d=t.editor.getTokenAt(s);d.end>s.ch&&(d.end=s.ch,d.string=d.string.slice(0,s.ch-d.start)),d.string.match(/^[.`\w@]\w*$/)?(l=d.string,a=d.start,o=d.end):(a=o=s.ch,l=""),"."!=l.charAt(0)&&"``"!=l.charAt(0)||(a+=1),e({list:i,from:{line:t.current_line,ch:a},to:{line:t.current_line,ch:o}})})).fail((function(e){return C.handleLoginRequiredAndTransactionRequired(d,t,e,null,[],!1)}))}.bind(c)}})),n(".dropdown-submenu").on("mouseenter",(function(){var e=n(this).find("ul.dropdown-menu");if(n(e).offset().left+e.width()>n(window).width()){var t=-n(e).width();e.css("left",t)}})).on("mouseleave",(function(){n(this).find("ul.dropdown-menu").css("left","")})),i.reflectPreferences(),i.preferences.auto_commit?n(".auto-commit").removeClass("visibility-hidden"):n(".auto-commit").addClass("visibility-hidden"),i.preferences.auto_rollback?n(".auto-rollback").removeClass("visibility-hidden"):n(".auto-rollback").addClass("visibility-hidden"),V.default.pgAdmin.Browser.onPreferencesChange("sqleditor",(function(){i.reflectPreferences()})),i.preferences.new_browser_tab&&(F.bind_beforeunload(),setInterval((function(){V.default.pgAdmin&&i.reflectPreferences()}),1e3)),F.register_to_activity_listener(document,(function(){l.alert(e("Timeout"),e("Your session has timed out due to inactivity. Please close the window and login again."))}))},render_grid:function(t,i,a,o,d){var c=this;c.handler.numberOfModifiedCells=0,c.handler.reset_data_store(),c.handler.rows_to_disable=new Array,c.handler.temp_new_rows=new Array,c.handler.primary_keys_data={},c.client_primary_key=o,c.client_primary_key_counter=0,c.handler.slickgrid&&c.handler.slickgrid.destroy(),r.isArray(t)&&r.size(t)||(t=[]);var u,f=[],_=c.handler.col_size,g=c.handler.query,m=g.match(/select.*from\s+\w+\.*(\w+)/i);u=m?m[1]:w.getHash(g),c.handler.table_name=u,_[u]=_[u]||{},r.each(i,(function(t){t.display_name=r.escape(t.display_name),t.column_type=r.escape(t.column_type);var i={id:t.name,pos:t.pos,field:t.name,name:t.label,display_name:t.display_name,column_type:t.column_type,column_type_internal:t.column_type_internal,cell:t.cell,not_null:t.not_null,has_default_val:t.has_default_val,is_array:t.is_array,can_edit:t.can_edit},a=t.column_type.trim(),o=t.name.length>a.length?r.escape(t.display_name):a;if(r.isUndefined(_[u][t.name])?(i.width=w.calculateColumnWidth(o),_[u][t.name]=i.width):i.width=_[u][t.name],"oid"==t.cell&&"oid"==t.name?i.editor=null:"Json"==t.cell?(i.editor=t.can_edit?z.Editors.JsonText:z.Editors.ReadOnlyJsonText,i.formatter=z.Formatters.JsonString):"number"==t.cell||"oid"==t.cell||-1!==n.inArray(t.type,["xid","real"])?(i.editor=t.can_edit?z.Editors.CustomNumber:z.Editors.ReadOnlyText,i.formatter=z.Formatters.Numbers):"boolean"==t.cell?(i.editor=t.can_edit?z.Editors.Checkbox:z.Editors.ReadOnlyCheckbox,i.formatter=z.Formatters.Checkmark):"binary"==t.cell?i.formatter=z.Formatters.Binary:"geometry"==t.cell||"geography"==t.cell?(i.width+=28,i.can_edit=!1):(i.editor=t.can_edit?z.Editors.pgText:z.Editors.ReadOnlypgText,i.formatter=z.Formatters.Text),!r.isUndefined(t.can_edit)){i.width+=12;var s="";s=t.can_edit?e("Editable column"):e("Read-only column"),i.toolTip=s}f.push(i)}));var x=new p;f=c.grid_columns=x.getColumnDefinitions(f),r.each(f,(function(e){"geometry"!=e.column_type_internal&&"geography"!=e.column_type_internal||k.add_header_button(e),r.isUndefined(e.can_edit)||w.addEditableIcon(e,e.can_edit)})),d&&(f[0].width=w.calculateColumnWidth(d));var C={editable:!0,enableAddRow:a,enableCellNavigation:!0,enableColumnReorder:!1,asyncEditorLoading:!1,autoEdit:!1},S=n("#datagrid"),T=n(this.data_output_panel.$container.parent().parent()).height()-35;S.height(T);var E=c.dataView=new z.Data.DataView,P=c.grid=new z.Grid(S,E,f,C);E.getItemMetadata=function(e){var t="",n=c.handler.data_store;return r.has(c.handler,"data_store")&&(e in n.added_index&&n.added_index[e]in n.added?(t="new_row",n.added[n.added_index[e]].err&&(t+=" error")):e in n.updated_index&&e in n.updated&&(t="updated_row",n.updated[n.updated_index[e]].err&&(t+=" error"))),!r.isUndefined(c.handler.rows_to_disable)&&c.handler.rows_to_disable.length>0&&-1!==r.indexOf(c.handler.rows_to_disable,e)&&(t+=" disabled_row"),{cssClasses:t}},P.registerPlugin(new z.AutoTooltips({enableForHeaderCells:!1})),P.registerPlugin(new h),P.setSelectionModel(new v),P.registerPlugin(x),P.registerPlugin(new z.AutoColumnSize);var q=new z.Plugins.HeaderButtons;q.onCommand.subscribe((function(e,t){if("view-geometries"===t.command){var n=t.grid.getColumns(),i=n.indexOf(t.column),a=t.grid.getSelectedRows();if(0===a.length)if(c.handler.has_more_rows)c.fetch_next_all((function(){x.onGridSelectAll.notify(t,new z.EventData);var e=t.grid.getData().getItems();k.render_geometries(c.handler,e,n,i)}));else{x.onGridSelectAll.notify(t,new z.EventData);var o=t.grid.getData().getItems();k.render_geometries(c.handler,o,n,i)}else{var s=t.grid.getData().getItems(),l=r.map(a,(function(e){return s[e]}));k.render_geometries(c.handler,l,n,i)}}})),P.registerPlugin(q);var O={keys:r.isEmpty(c.handler.primary_keys)&&c.handler.has_oids?c.handler.oids:c.handler.primary_keys,vals:t,columns:i,grid:P,selection:P.getSelectionModel(),editor:c,client_primary_key:c.client_primary_key,has_oids:c.handler.has_oids};c.handler.slickgrid=P,c.handler.slickgrid.CSVOptions={quoting:c.preferences.results_grid_quoting,quote_char:c.preferences.results_grid_quote_char,field_separator:c.preferences.results_grid_field_separator},O.selection&&O.selection.onSelectedRangesChanged.subscribe(y.bind(O)),P.onColumnsResized.subscribe(function(){var e=this.getColumns();r.each(e,(function(e){c.handler.col_size[c.handler.table_name][e.id]=e.width}))}.bind(P)),x.onBeforeGridSelectAll.subscribe((function(e,t){c.handler.has_more_rows&&(e.stopImmediatePropagation(),c.fetch_next_all((function(){x.onGridSelectAll.notify(t,new z.EventData)})))})),x.onBeforeGridColumnSelectAll.subscribe((function(e,t){c.handler.has_more_rows&&(e.stopImmediatePropagation(),c.fetch_next_all((function(){x.onGridColumnSelectAll.notify(t,new z.EventData)})))})),E.onRowCountChanged.subscribe((function(){P.updateRowCount(),P.render()})),E.onRowsChanged.subscribe((function(e,t){P.invalidateRows(t.rows),P.render()})),P.onBeforeEditCell.subscribe((function(e,t){if("bytea"==t.column.column_type_internal||"bytea[]"==t.column.column_type_internal)return!1;var n=t.item;if(c.handler.rows_to_disable&&r.contains(c.handler.rows_to_disable,t.row))return!1;if(c.handler.can_edit&&n&&c.client_primary_key in n){var i=n[c.client_primary_key],a=c.handler.primary_keys,o={};if(i in c.handler.primary_keys_data)return;r.each(a,(function(e,t){o[t]=n[t]})),c.handler.primary_keys_data[i]=o}})),P.onKeyDown.subscribe((function(e,t){var n=e.keyCode;(e.ctrlKey||e.metaKey)&&65==n&&c.handler.has_more_rows?c.fetch_next_all((function(){b(e,t)})):b(e,t)})),P.onCellChange.subscribe(function(e,t){var i=t.grid.getColumns()[t.cell].field,a=t.item[i],o=t.item[c.client_primary_key]||null,l={};c.handler.numberOfModifiedCells++,t.grid.addCellCssStyles(c.handler.numberOfModifiedCells,s({},t.row,s({},i,"highlighted_grid_cells")));var d=t.grid.getDataItem(t.row);if(c.primary_keys&&r.all(r.values(r.pick(d,c.primary_keys)),(function(e){return null!=e}))&&c.handler.temp_new_rows){var u=c.handler.temp_new_rows.indexOf(t.row);u>-1&&c.handler.temp_new_rows.splice(u,1)}l[i]=a,o&&(o in c.handler.data_store.added?(r.extend(c.handler.data_store.added[o].data,l),c.handler.data_store.added[o].err=!1):o in c.handler.data_store.updated?(r.extend(c.handler.data_store.updated[o].data,l),c.handler.data_store.updated[o].err=!1):(c.handler.data_store.updated[o]={err:!1,data:l,primary_keys:c.handler.primary_keys_data[o]},c.handler.data_store.updated_index[t.row]=o)),n("#btn-save-data").prop("disabled",!1)}.bind(O)),P.onAddNewRow.subscribe(function(e,t){var i=t.column,a=t.item,o=this.grid.getDataLength(),l=(c.client_primary_key_counter++).toString(),d=this.grid.getData();r.isUndefined(a[0])&&c.handler.temp_new_rows.push(o),a&&(a[c.client_primary_key]=l),d.addItem(a),c.handler.data_store.added[l]={err:!1,data:a},c.handler.data_store.added_index[o]=l;({})[i.name]=r.where(this.columns,{pos:i.pos})[0].type,P.updateRowCount(),P.render();var u=d.getRowByItem(a);c.handler.numberOfModifiedCells++,t.grid.addCellCssStyles(c.handler.numberOfModifiedCells,s({},u,s({},i.field,"highlighted_grid_cells"))),n("#btn-save-data").prop("disabled",!1)}.bind(O)),P.onViewportChanged.subscribe((function(e,t){var n=t.grid.getRenderedRange(),i=t.grid.getDataLength();c.handler.has_more_rows&&!c.handler.fetching_rows&&n.bottom>i-100&&setTimeout(c.fetch_next.bind(c))})),P.onValidationError.subscribe((function(e,t){l.error(t.validationResults.msg)})),n(window).resize((function(){c.data_output_panel.isVisible()&&c.grid_resize(P)})),c.data_output_panel.on(U.EVENT.RESIZE_ENDED,(function(){c.data_output_panel.isVisible()&&c.grid_resize(P)})),c.data_output_panel.on(U.EVENT.VISIBILITY_CHANGED,(function(){c.data_output_panel.isVisible()&&c.grid_resize(P)}));for(var D=0;D<t.length;D++){for(var N={},j=1;j<f.length;j++)N[f[j].field]=t[D][f[j].pos];N[c.client_primary_key]=(c.client_primary_key_counter++).toString(),t[D]=N}E.setItems(t,c.client_primary_key)},fetch_next_all:function(e){this.fetch_next(!0,e)},fetch_next:function(i,a){var r=this,o="";r.handler.fetching_rows=!0,n("#btn-flash").prop("disabled",!0),n("#btn-download").prop("disabled",!0),i?(r.handler.trigger("pgadmin-sqleditor:loading-icon:show",e("Fetching all records...")),o=t("sqleditor.fetch_all",{trans_id:r.transId,fetch_all:1})):o=t("sqleditor.fetch",{trans_id:r.transId}),n.ajax({url:o,method:"GET"}).done((function(e){r.handler.has_more_rows=e.data.has_more_rows,n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),r.handler.trigger("pgadmin-sqleditor:loading-icon:hide"),r.update_grid_data(e.data.result),r.handler.fetching_rows=!1,"function"==typeof a&&a()})).fail((function(e){n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),r.handler.trigger("pgadmin-sqleditor:loading-icon:hide"),r.handler.has_more_rows=!1,r.handler.fetching_rows=!1,"function"==typeof a&&a();var t=C.handleQueryToolAjaxError(d,r,e,null,[],!1);r.update_msg_history(!1,t)}))},update_grid_data:function(e){this.dataView.beginUpdate();for(var t=0;t<e.length;t++){for(var n={},i=1;i<this.grid_columns.length;i++)n[this.grid_columns[i].field]=e[t][this.grid_columns[i].pos];n[this.client_primary_key]=(this.client_primary_key_counter++).toString(),this.dataView.addItem(n)}this.dataView.endUpdate()},grid_resize:function(e){var t=n("#datagrid").height(),i=n(this.data_output_panel.$container.parent().parent()).height()-35,a=e.getViewport(),r=e.getRenderedRange(),o=e.getActiveCell();t!=i&&n("#datagrid").css({height:i+"px"}),e.resizeCanvas(),o&&e.scrollCellIntoView(o.row,o.cell),a.top!=r.top&&(a.bottom-2==r.bottom?e.scrollRowIntoView(a.bottom):e.scrollRowIntoView(a.bottom-2))},fetch_query_history:function(){var e=this;n.ajax({url:t("sqleditor.get_query_history",{trans_id:e.handler.transId}),method:"GET",contentType:"application/json"}).done((function(t){t.data.result.map((function(t){var n=JSON.parse(t);n.start_time=new Date(n.start_time),e.history_collection.add(n)}))})).fail((function(){}))},render_history_grid:function(){var e=this;e.history_collection||(e.history_collection=new K([])),e.historyComponent||(e.historyComponent=new G(n("#history_grid"),e.history_collection),e.historyComponent.onCopyToEditorClick((function(t){e.query_tool_obj.setValue(t),e.sql_panel_obj.focus(),setTimeout((function(){e.query_tool_obj.focus(),e.query_tool_obj.setCursor(e.query_tool_obj.lineCount(),0)}),100)})),e.historyComponent.render(),e.history_panel.off(U.EVENT.VISIBILITY_CHANGED),e.history_panel.on(U.EVENT.VISIBILITY_CHANGED,(function(){e.history_panel.isVisible()&&setTimeout((function(){e.historyComponent.focus()}),100)}))),e.handler.is_query_tool||e.historyComponent.setEditorPref({copy_to_editor:!1})},on_delete:function(){this.handler.trigger("pgadmin-sqleditor:button:deleterow",this,this.handler)},_stopEventPropogation:function(e){(e=e||window.event).cancelBubble=!0,e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()},_closeDropDown:function(e){var t=e&&(e.currentTarget||e.target);t&&n(t).closest(".editor-toolbar").find(".show").removeClass("show")},on_save_file:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.close_on_save=!1,this.handler.trigger("pgadmin-sqleditor:button:save_file")},on_save_as:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.close_on_save=!1,this.handler.trigger("pgadmin-sqleditor:button:save_file",this,this.handler,!0)},on_find:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("find")},on_find_next:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("findNext")},on_find_previous:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("findPrev")},on_replace:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("replace")},on_replace_all:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("replaceAll")},on_find_persistent:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("findPersistent")},on_jump:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("jumpToLine")},on_show_filter:function(){this.handler.trigger("pgadmin-sqleditor:button:show_filter",this,this.handler)},on_include_filter:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:include_filter",this,this.handler)},on_exclude_filter:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:exclude_filter",this,this.handler)},on_remove_filter:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:remove_filter",this,this.handler)},on_cancel:function(){n("#filter").addClass("d-none"),n("#editor-panel").removeClass("sql-editor-busy-fetching")},on_copy_row:function(){this.handler.trigger("pgadmin-sqleditor:button:copy_row",this,this.handler)},on_copy_row_with_header:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:copy_row_with_header",this,this.handler)},on_paste_row:function(){this.handler.trigger("pgadmin-sqleditor:button:paste_row",this,this.handler)},on_limit_change:function(){this.handler.trigger("pgadmin-sqleditor:button:limit",this,this.handler)},on_save_data:function(){this.handler.history_query_source=$.SAVE_DATA,O.saveDataChanges(this.handler)},on_flash:function(){var e=n("#btn-flash").attr("data-click-counter");e=(parseInt(e)+1)%10,n("#btn-flash").attr("data-click-counter",e),this.handler.history_query_source=$.EXECUTE,O.executeQuery(this.handler)},on_cancel_query:function(){this.handler.trigger("pgadmin-sqleditor:button:cancel-query",this,this.handler)},on_comment_line_code:function(){O.commentLineCode(this.handler)},on_uncomment_line_code:function(){O.uncommentLineCode(this.handler)},on_toggle_comment_block_code:function(){O.commentBlockCode(this.handler)},on_indent_code:function(){this.handler.trigger("pgadmin-sqleditor:indent_selected_code",this,this.handler)},on_unindent_code:function(){this.handler.trigger("pgadmin-sqleditor:unindent_selected_code",this,this.handler)},on_clear:function(t){var n=this;this._stopEventPropogation(t),this._closeDropDown(t),n.handler.is_query_changed?l.confirm(e("Unsaved changes"),e("Are you sure you wish to discard the current changes?"),(function(){n.query_tool_obj.setValue(""),setTimeout((function(){n.query_tool_obj.focus()}),200)}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")}):n.query_tool_obj.setValue("")},on_clear_history:function(i){var a=this;this._stopEventPropogation(i),this._closeDropDown(i),a.history_collection.length()&&l.confirm(e("Clear history"),e("Are you sure you wish to clear the history?")+"</br>"+e("This will remove all of your query history from this and other sessions for this database."),(function(){a.history_collection&&a.history_collection.reset(),a.handler.is_query_tool&&n.ajax({url:t("sqleditor.clear_query_history",{trans_id:a.handler.transId}),method:"DELETE",contentType:"application/json"}).done((function(){})).fail((function(){})),setTimeout((function(){a.query_tool_obj.focus()}),200)}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")})},on_auto_commit:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:auto_commit",this,this.handler)},on_auto_rollback:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:auto_rollback",this,this.handler)},on_explain:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.history_query_source=$.EXPLAIN,O.explain(this.handler)},on_explain_analyze:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.history_query_source=$.EXPLAIN_ANALYZE,O.explainAnalyze(this.handler)},on_explain_verbose:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-verbose",this,this.handler)},on_explain_costs:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-costs",this,this.handler)},on_explain_buffers:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-buffers",this,this.handler)},on_explain_timing:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-timing",this,this.handler)},on_explain_summary:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-summary",this,this.handler)},on_explain_settings:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-settings",this,this.handler)},do_not_close_menu:function(e){e.stopPropagation()},on_file_load:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:load_file",this,this.handler)},on_download:function(){O.download(this.handler)},keyAction:function(e){var t;t=q.processEventQueryTool(this.handler,O,e,this.docker),r.isNull(t)||r.isUndefined(t)||""==t||setTimeout((function(){F.Events.trigger("pgadmin:query_tool:".concat(t,":focus"))}),100)},on_commit_transaction:function(){this.handler.close_on_idle_transaction=!1,this.handler.history_query_source=$.COMMIT,O.executeCommit(this.handler)},on_rollback_transaction:function(){this.handler.close_on_idle_transaction=!1,this.handler.history_query_source=$.ROLLBACK,O.executeRollback(this.handler)}}),W=function(){this.initialize.apply(this,arguments)};return r.extend(W.prototype,c.Events,{initialize:function(t){var i=this;this.container=t,this.state={},this.csrf_token=d.csrf_token,j.modifyAlertifyAnimation(),l.dlgGetServerPass||l.dialog("dlgGetServerPass",(function(){return{main:function(e,t){this.set("title",e),this.setting("message",t)},setup:function(){return{buttons:[{text:e("OK"),key:13,className:"btn btn-primary"},{text:e("Cancel"),key:27,className:"btn btn-danger"}],focus:{element:"#password",select:!0},options:{modal:0,resizable:!1,maximizable:!1,pinnable:!1}}},build:function(){},settings:{message:null},prepare:function(){this.setContent(this.setting("message"))},callback:function(t){if(t.button.text==e("OK")){var a=n(this.elements.content).find("#frmPassword").serialize();i.init_connection(!1,a)}}}})),this.on("pgadmin-datagrid:transaction:created",(function(e){i.transId=e.gridTransId,i.warn_before_continue()})),F.Events.on("pgadmin:user:logged-in",(function(){i.initTransaction()}))},saveState:function(e,t){this.state=e?{fn:e,args:t}:{}},initTransaction:function(){var e,i=this;i.is_query_tool?(e="datagrid.initialize_query_tool",i.url_params.did&&(e="datagrid.initialize_query_tool_with_did")):e="datagrid.initialize_datagrid";var a=t(e,o({},i.url_params,{trans_id:i.transId}));n.ajax({url:a,type:"POST",data:i.is_query_tool?null:JSON.stringify(i.url_params.sql_filter),contentType:"application/json"}).done((function(e){F.Events.trigger("pgadmin:query_tool:connected:"+i.transId,e.data)})).fail((function(e,t,n){F.Events.trigger("pgadmin:query_tool:connected_fail:"+i.transId,e,n)}))},handle_connection_lost:function(e,t){void 0!==t.responseJSON&&t.responseJSON.data&&!t.responseJSON.data.conn_id?this.init_connection(e):void 0!==t.data&&t.data.data&&!t.data.data.conn_id?this.init_connection(e):this.warn_before_continue()},handle_cryptkey_missing:function(){var e=this;F.set_master_password("",(function(){e.warn_before_continue()}))},warn_before_continue:function(){var t=this;l.confirm(e("Connection Warning"),'<p style="float:left"><span class="fa fa-exclamation-triangle warn-icon" aria-hidden="true" role="img"></span></p><p style="display: inline-block;"><span class="warn-header">'+e("The application has lost the database connection:")+'</span><br><span class="warn-body">'+e(" If the connection was idle it may have been forcibly disconnected.")+"<br>"+e(" The application server or database server may have been restarted.")+"<br>"+e(" The user session may have timed out.")+'</span><br><span class="warn-footer">'+e("Do you want to continue and establish a new session?")+"</span></p>",(function(){if("fn"in t.state){var e=t.state.fn,n=t.state.args;t.saveState(),-1==n.indexOf("connect")&&n.push("connect"),t[e].apply(t,n)}}),(function(){t.saveState()})).set({labels:{ok:e("Continue"),cancel:e("Cancel")}})},init_connection:function(i,a){var r=this;n.post(t("NODE-server.connect_id",{gid:this.url_params.sgid,sid:this.url_params.sid}),a).done((function(e){if(1==e.success)if(l.success(e.info),i)r.initTransaction();else if("fn"in r.state){var t=r.state.fn,n=r.state.args;r.saveState(),r[t].apply(r,n)}})).fail((function(t){var n=C.handleQueryToolAjaxError(d,r,t,null,[],!1);l.dlgGetServerPass(e("Connect to Server"),n)}))},start:function(t,i,a){var o=this;if(o.is_query_tool="true"===i.is_query_tool,o.rows_affected=0,o.marked_line_no=0,o.has_more_rows=!1,o.fetching_rows=!1,o.close_on_save=!1,o.close_on_idle_transaction=!1,o.last_transaction_status=-1,o.server_type=i.server_type,o.url_params=i,o.is_transaction_buttons_disabled=!0,!o.gridView){o.gridView=new J({el:o.container,handler:o,layout:a}),o.transId=o.gridView.transId=t,o.gridView.current_file=void 0,o.gridView.render(),o.trigger("pgadmin-sqleditor:loading-icon:hide"),o.gridView.set_editor_title("(".concat(e("Obtaining connection...")," ").concat(r.unescape(i.title)));var s=function(){(o.is_query_tool?["#btn-flash","#btn-explain","#btn-explain-analyze"]:["#btn-flash"]).forEach((function(e){n(e).prop("disabled",!1)})),n("#btn-conn-status i").removeClass("obtaining-conn"),o.gridView.set_editor_title(r.unescape(i.title))};if(F.Events.on("pgadmin:query_tool:connected:"+t,s),F.Events.on("pgadmin:query_tool:connected_fail:"+t,s),F.Events.on("pgadmin:query_tool:connected:"+t,(function(e){o.gridView.set_server_version(e.serverVersion)})),F.Events.on("pgadmin:query_tool:connected_fail:"+t,(function(e,t){l.pgRespErrorNotify(e,t)})),o.initTransaction(),n(window).on("keydown",(function(e){0===n(".sql-editor").find(e.target).length&&e.target!=n("body.wcDesktop")[0]||!o.gridView.keyAction||o.gridView.keyAction(e)})),o.is_query_tool)i.query_url?n.ajax({url:i.query_url,type:"GET"}).done((function(e){o.gridView.query_tool_obj.refresh(),e&&""!==e&&o.gridView.query_tool_obj.setValue(e),o.init_events()})).fail((function(t){var n;o.init_events(),n=C.handleQueryToolAjaxError(d,o,t,null,[],!1),F.report_error(e("Error fetching SQL for script: %s.",n))})):o.init_events();else{o.init_events(),o.gridView.query_tool_obj.setOption("readOnly",!0);var c=o.gridView.query_tool_obj.getWrapperElement();c&&(c.className+=" bg-gray-lighter opacity-5 hide-cursor-workaround"),o.disable_tool_buttons(!0),F.Events.on("pgadmin:query_tool:connected:"+t,(function(){o.check_data_changes_to_execute_query()}))}}},set_value_to_editor:function(e){this.gridView&&this.gridView.query_tool_obj&&!r.isUndefined(e)&&this.gridView.query_tool_obj.setValue(e)},init_events:function(){d.Browser.Events.on("pgadmin-storage:finish_btn:select_file",this._select_file_handler,this),d.Browser.Events.on("pgadmin-storage:finish_btn:create_file",this._save_file_handler,this),this.is_query_tool&&this.gridView.query_tool_obj.on("change",this._on_query_change.bind(this)),this.on("pgadmin-sqleditor:button:load_file",this._load_file,this),this.on("pgadmin-sqleditor:button:save_file",this._save_file,this),this.on("pgadmin-sqleditor:button:deleterow",this._delete,this),this.on("pgadmin-sqleditor:button:show_filter",this._show_filter,this),this.on("pgadmin-sqleditor:button:include_filter",this._include_filter,this),this.on("pgadmin-sqleditor:button:exclude_filter",this._exclude_filter,this),this.on("pgadmin-sqleditor:button:remove_filter",this._remove_filter,this),this.on("pgadmin-sqleditor:button:copy_row",this._copy_row,this),this.on("pgadmin-sqleditor:button:copy_row_with_header",this._copy_row_with_header,this),this.on("pgadmin-sqleditor:button:paste_row",this._paste_row,this),this.on("pgadmin-sqleditor:button:limit",this._set_limit,this),this.on("pgadmin-sqleditor:button:cancel-query",this._cancel_query,this),this.on("pgadmin-sqleditor:button:auto_rollback",this._auto_rollback,this),this.on("pgadmin-sqleditor:button:auto_commit",this._auto_commit,this),this.on("pgadmin-sqleditor:button:explain-verbose",this._explain_verbose,this),this.on("pgadmin-sqleditor:button:explain-costs",this._explain_costs,this),this.on("pgadmin-sqleditor:button:explain-buffers",this._explain_buffers,this),this.on("pgadmin-sqleditor:button:explain-timing",this._explain_timing,this),this.on("pgadmin-sqleditor:button:explain-summary",this._explain_summary,this),this.on("pgadmin-sqleditor:button:explain-settings",this._explain_settings,this),this.on("pgadmin-sqleditor:indent_selected_code",this._indent_selected_code,this),this.on("pgadmin-sqleditor:unindent_selected_code",this._unindent_selected_code,this)},check_data_changes_to_execute_query:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this;r.has(i,"data_store")&&(r.size(i.data_store.added)||r.size(i.data_store.updated)||r.size(i.data_store.deleted))?l.confirm(e("Unsaved changes"),e("The data has been modified, but not saved. Are you sure you wish to discard the changes?"),(function(){i.is_query_tool?i._execute_sql_query(t,n):i._execute_view_data_query()}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")}):i.is_query_tool?i._execute_sql_query(t,n):i._execute_view_data_query()},_execute_view_data_query:function(){var i=this,a=t("sqleditor.view_data_start",{trans_id:i.transId});i.query_start_time=new Date,i.rows_affected=0,i._init_polling_flags(),i.has_more_rows=!1,i.fetching_rows=!1,i.trigger("pgadmin-sqleditor:loading-icon:show",e("Running query...")),n("#btn-flash").prop("disabled",!0),n("#btn-download").prop("disabled",!0),i.trigger("pgadmin-sqleditor:loading-icon:message",e("Waiting for the query to complete...")),arguments.length>0&&"connect"==arguments[arguments.length-1]&&(a+="?connect=1"),n.ajax({url:a,method:"GET"}).done((function(e){e.data.status?(i.can_edit=e.data.can_edit,i.can_filter=e.data.can_filter,i.info_notifier_timeout=e.data.info_notifier_timeout,i.gridView.query_tool_obj.setValue(e.data.sql),i.query=e.data.sql,i.can_filter&&e.data.filter_applied?(n("#btn-filter").removeClass("btn-secondary"),n("#btn-filter-dropdown").removeClass("btn-secondary"),n("#btn-filter").addClass("btn-primary"),n("#btn-filter-dropdown").addClass("btn-primary")):(n("#btn-filter").removeClass("btn-primary"),n("#btn-filter-dropdown").removeClass("btn-primary"),n("#btn-filter").addClass("btn-secondary"),n("#btn-filter-dropdown").addClass("btn-secondary")),n("#btn-copy-row").prop("disabled",!0),n("#btn-paste-row").prop("disabled",!0),n(".limit").val(e.data.limit),i._poll()):(i.trigger("pgadmin-sqleditor:loading-icon:hide"),i.update_msg_history(!1,e.data.result))})).fail((function(e){i.trigger("pgadmin-sqleditor:loading-icon:hide");var t=C.handleQueryToolAjaxError(d,i,e,"_execute_view_data_query",[],!0);i.update_msg_history(!1,t)}))},_execute_sql_query:function(e,t){var n="";if(this.has_more_rows=!1,this.fetching_rows=!1,r.isUndefined(this.special_sql)){var i=this.gridView.query_tool_obj.getSelection();n=i.length>0?i:this.gridView.query_tool_obj.getValue()}else n=this.special_sql;var a=new x.ExecuteQuery(this,d.Browser.UserManagement);a.poll=F.override_activity_event_decorator(a.poll).bind(a),a.execute(n,e,t)},call_render_after_poll:function(e){M.callRenderAfterPoll(this,l,e)},_poll:function(){new x.ExecuteQuery(this,d.Browser.UserManagement).delayedPoll(this)},_render:function(t){this.colinfo=t.colinfo,this.primary_keys=r.isEmpty(t.primary_keys)&&t.has_oids?t.oids:t.primary_keys,this.client_primary_key=t.client_primary_key,this.cell_selected=!1,this.selected_model=null,this.changedModels=[],this.has_oids=t.has_oids,this.oids=t.oids,n(".sql-editor-explain").empty(),this.explain_plan=!1,null!==this.primary_keys&&void 0!==this.primary_keys&&0!==r.size(this.primary_keys)||0!=this.has_oids?this.can_edit=!0:this.can_edit=!1,this.can_filter&&(n(".limit").prop("disabled",!1),n(".limit").addClass("limit-enabled"),n("#btn-filter").prop("disabled",!1),n("#btn-filter-dropdown").prop("disabled",!1)),n("#btn-save-data").prop("disabled",!0),n("#btn-delete-row").prop("disabled",!0),this.can_edit||(n("#btn-delete-row").prop("disabled",!0),n("#btn-copy-row").prop("disabled",!0),n("#btn-paste-row").prop("disabled",!0)),this._fetch_column_metadata.call(this,t,function(){var i=this;i.trigger("pgadmin-sqleditor:loading-icon:message",e("Loading data from the database server and rendering..."),i),i.total_time=A.calculateQueryRunTime(i.query_start_time,i.query_end_time);var a=e("Successfully run. Total query runtime: %s.",i.total_time),o=e("%s rows affected.",i.rows_affected);i.info_notifier_timeout>=0&&l.success(a+" "+o,i.info_notifier_timeout);var s=a+"\n"+o;r.isNull(t.additional_messages)||r.isUndefined(t.additional_messages)||(s=t.additional_messages+"\n"+s),i.update_msg_history(!0,s,!1);var d=[],c=null;if(t.result&&!r.isEmpty(i.colinfo)&&"QUERY PLAN"==i.colinfo[0].name&&!r.isEmpty(t.types)&&t.types[0]&&"json"===t.types[0].typname&&(c=JSON.parse(t.result[0][0])),c&&c[0]&&c[0].hasOwnProperty("Plan")&&r.isObject(c[0].Plan)){var u=[JSON.stringify(c,null,2)];d.push(u),i.gridView.data_output_panel.focus(),setTimeout((function(){i.gridView.render_grid(d,i.columns,i.can_edit,i.client_primary_key,0),i.gridView.explain_panel.focus(),f.DrawJSONPlan(n(".sql-editor-explain"),c)}),10)}else i.gridView.data_output_panel.focus(),setTimeout((function(){i.gridView.render_grid(t.result,i.columns,i.can_edit,i.client_primary_key,t.rows_affected)}),10);i.trigger("pgadmin-sqleditor:loading-icon:hide"),n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1)}.bind(this))},_fetch_column_metadata:function(e,t){var n=e.colinfo,i=e.primary_keys,a=[],o=this,s=new Array;r.each(e.types,(function(e){s[e.oid]=[e.typname]})),r.each(n,(function(e){var t=!1,n=o.can_edit&&(!o.is_query_tool||e.is_editable);n&&r.size(i)>0&&r.each(i,(function(n,i){i===e.name&&(t=!0)}));var l,d,c="",u=s[e.type_code]?s[e.type_code][0]:s[s.length-1][0]?s[s.length-1][0]:"unknown";switch(c+=t?"[PK] "+u:u,e.precision&&e.precision>=0&&65535!=e.precision&&(c+=" ("+e.precision,c+=e.scale&&65535!=e.scale?","+e.scale+")":")"),u){case"oid":d="oid";break;case"json":case"json[]":case"jsonb":case"jsonb[]":d="Json";break;case"smallint":case"smallint[]":case"integer":case"integer[]":case"bigint":case"bigint[]":case"decimal":case"decimal[]":case"numeric":case"numeric[]":case"real":case"real[]":case"double precision":case"double precision[]":d="number";break;case"boolean":d="boolean";break;case"character":case"character[]":case'"char"':case'"char"[]':case"character varying":case"character varying[]":e.internal_size&&e.internal_size>=0&&65535!=e.internal_size&&(c+=" ("+e.internal_size+")"),d="string";break;case"bytea":case"bytea[]":d="binary";break;case"geometry":d="geometry";break;case"geography":d="geography";break;default:d="string"}l=e.display_name+"<br>"+c;var f=u.lastIndexOf("[]"),p={name:e.name,display_name:e.display_name,column_type:c,column_type_internal:u,pos:e.pos,label:l,cell:d,can_edit:"oid"!=e.name&&n,type:u,not_null:e.not_null,has_default_val:e.has_default_val,is_array:f>-1&&f+2==u.length};a.push(p)})),o.columns=a,t&&"function"==typeof t&&t()},resetQueryHistoryObject:function(e){e.total_time="-"},set_sql_message:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?n(".sql-editor-message").append(e):n(".sql-editor-message").text(e),setTimeout((function(){n(".sql-editor-message").scrollTop(n(".sql-editor-message")[0].scrollHeight)}),10)},update_msg_history:function(t,i,a){if(void 0===a&&(a=!0),this.gridView.messages_panel.focus(),a?(this.gridView.handler.slickgrid&&this.gridView.handler.slickgrid.destroy(),this.columns=void 0,this.collection=void 0,this.set_sql_message(i)):this.set_sql_message(r.escape(i),!0),"Busy"!=t){n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),this.trigger("pgadmin-sqleditor:loading-icon:hide"),this.total_time||(this.total_time=A.calculateQueryRunTime(this.query_start_time,new Date)),r.isUndefined(this.history_query_source)&&(this.history_query_source=$.VIEW_DATA);var o={status:t,start_time:this.query_start_time,query:this.query,row_affected:this.rows_affected,total_time:this.total_time,message:i,query_source:this.history_query_source,is_pgadmin_query:!this.is_query_tool};if(!this.is_query_tool){var s=e('This query was generated by pgAdmin as part of a "View/Edit Data" operation');o.info=s}this.add_to_history(o)}},add_to_history:function(e){n.ajax({url:t("sqleditor.add_query_history",{trans_id:this.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(e)}).done((function(){})).fail((function(){})),this.gridView.history_collection.add(e)},is_editable:function(e){return!(e instanceof c.Collection)&&this.get("can_edit")},rows_to_delete:function(e){var t=this,n=t.primary_keys;t.temp_new_rows=[],e.forEach((function(e,i){var a=r.pick(e,r.keys(n));Object.keys(a).length>0||t.temp_new_rows.push(i)})),t.rows_to_disable=r.clone(t.temp_new_rows)},_delete:function(){var t=this,i=[],a=r.size(t.data_store.added),o=r.size(t.data_store.updated);if(a&&r.each(t.data_store.added,(function(e,n){n in t.data_store.staged_rows&&i.push(n)})),r.size(t.data_store.staged_rows)>0&&r.size(t.data_store.staged_rows)===r.size(i)){var s=t.slickgrid,d=s.getData();s.resetActiveCell(),d.beginUpdate();for(var c=0;c<i.length;c++)delete t.data_store.staged_rows[i[c]],delete t.data_store.added[i[c]],delete t.data_store.added_index[i[c]],d.deleteItem(i[c]);d.endUpdate(),t.rows_to_delete.apply(t,[d.getItems()]),s.resetActiveCell(),s.setSelectedRows([]),s.invalidate(),n("#btn-delete-row").prop("disabled",!0),n("#btn-copy-row").prop("disabled",!0),r.size(t.data_store.added)||o?n("#btn-save-data").prop("disabled",!1):n("#btn-save-data").prop("disabled",!0),l.success(e("Row(s) deleted."))}else{var u=!0;r.each(r.keys(t.data_store.staged_rows),(function(e){e in t.data_store.deleted&&(u=!1)})),u?(t.data_store.deleted=Object.assign({},t.data_store.deleted,t.data_store.staged_rows),n(t.gridView.grid.getCanvasNode()).find("div.selected").addClass("strikeout")):(n(t.gridView.grid.getCanvasNode()).find("div.selected").removeClass("strikeout"),r.each(r.keys(t.data_store.staged_rows),(function(e){e in t.data_store.deleted&&delete t.data_store.deleted[e]}))),r.size(t.data_store.added)||o||r.size(t.data_store.deleted)?n("#btn-save-data").prop("disabled",!1):n("#btn-save-data").prop("disabled",!0)}},_save_file:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,n=t.gridView.current_file;if(r.isUndefined(n)||e){var i={supported_types:["*","sql"],dialog_type:"create_file",dialog_title:"Save File",btn_primary:"Save"};d.FileManager.init(),d.FileManager.show_dialog(i)}else t._save_file_handler(n)},save_data:function(){var i=this;if(i.can_edit){var a=r.size(i.data_store.added),o=r.size(i.data_store.updated),s=r.size(i.data_store.deleted);if(a||o||s){i.trigger("pgadmin-sqleditor:loading-icon:show",e("Saving the updated data...")),i.is_query_tool&&i.disable_tool_buttons(!0,!0);var c=i.data_store,u=i.gridView;c.columns=u?u.handler.columns:i.columns;var f=!1,p=new Date;n.ajax({url:t("sqleditor.save",{trans_id:i.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(c)}).done((function(t){var o=i.slickgrid,d=o.getData(),u=d.getLength(),h=[],_=t.data.transaction_status;i.last_transaction_status=_;var g=_>0;if(g?i.disable_transaction_buttons(!1):i.disable_transaction_buttons(!0),i.is_query_tool&&i.disable_tool_buttons(!1),t.data.status){n("#btn-save-data").prop("disabled",!0),f=!0;for(var m=1;m<=i.numberOfModifiedCells;m++)o.removeCellCssStyles(m);if(i.numberOfModifiedCells=0,a&&(d.beginUpdate(),r.each(t.data.query_results,(function(e){if(!r.isNull(e.row_added)){var t=Object.keys(e.row_added)[0];r.each(c.added_index,(function(n,i){if(n==t){var a=o.getDataItem(i);r.extend(a,e.row_added[t])}}))}})),d.endUpdate()),r.each(h,(function(e){e.is_row_copied&&delete e.is_row_copied})),o.copied_rows&&delete o.copied_rows,s){var b=r.keys(i.data_store.deleted);if(u==b.length)h=[],d.setItems(h,i.client_primary_key);else{d.beginUpdate();for(var v=0;v<b.length;v++){var y=o.getDataItem(b[v]);h.push(y),d.deleteItem(y[i.client_primary_key])}d.endUpdate()}i.rows_to_delete.apply(i,[h])}o.setSelectedRows([]),i.reset_data_store(),i.primary_keys_data={},i.set_sql_message(""),l.success(e("Data saved successfully.")),g&&l.info(e("Auto-commit is off. You still need to commit changes to the database."))}else{i.set_sql_message(t.data.result);var w=e("%s.",t.data.result);if(l.error(w,20),0!=_&&l.info(e("Saving data changes was rolled back but the current transaction is still active; previous queries are unaffected.")),o.setSelectedRows([]),r.has(t.data,"_rowid")&&(!r.isUndefined(t.data._rowid)||!r.isNull(t.data._rowid))){var x=i._find_rowindex(t.data._rowid);if(x in i.data_store.added_index){var C=i.handler.temp_new_rows.indexOf(t.data._rowid);C>-1&&i.handler.temp_new_rows.splice(C,1),i.data_store.added[i.data_store.added_index[x]].err=!0}else x in i.data_store.updated_index&&(i.data_store.updated[i.data_store.updated_index[x]].err=!0)}o.gotoCell(x,1)}var S=e('This query was generated by pgAdmin as part of a "Save Data" operation');r.each(t.data.query_results,(function(e){var t={status:e.status,start_time:p,query:e.sql,row_affected:e.rows_affected,total_time:null,message:e.result,query_source:$.SAVE_DATA,is_pgadmin_query:!0,info:S};i.add_to_history(t)})),i.trigger("pgadmin-sqleditor:loading-icon:hide"),o.invalidate(),i.close_on_save&&(f?i.check_needed_confirmations_before_closing_panel():i.close_on_save=!1)})).fail((function(e){var t=[u],n=C.handleQueryToolAjaxError(d,i,e,"save_data",t,!0);i.is_query_tool&&i.disable_tool_buttons(!1),i.update_msg_history(!1,n)}))}}},reset_data_store:function(){this.data_store={updated:{},added:{},staged_rows:{},deleted:{},updated_index:{},added_index:{}}},_find_rowindex:function(e){var t,n=this.slickgrid.getData().getItems(),i=0,a=-1;if(r.isObject(e))t=e;else{if(!r.isString(e))return a;(e={})[this.client_primary_key]=e,t=e}return r.find(n,(function(e){var n=[];if(n.push(e),r.findWhere(n,t))return a=i,!0;i++})),a},_save_as:function(){return this._save_file(!0)},setTitle:function(e,t){var n=this;n.preferences.new_browser_tab?window.document.title=e:r.each(V.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(i){i.isVisible()&&B.setQueryToolDockerTitle(i,n.is_query_tool,e,t)}))},_load_file:function(){var t=this;t.is_query_changed?l.confirm(e("Unsaved changes"),e("Are you sure you wish to discard the current changes?"),(function(){t._open_select_file_manager()}),(function(){return!0})).set("labels",{ok:"Yes",cancel:"No"}):t._open_select_file_manager()},_open_select_file_manager:function(){d.FileManager.init(),d.FileManager.show_dialog({supported_types:["sql"],dialog_type:"select_file"})},_select_file_handler:function(i){var a=this,r=i,o={file_name:decodeURI(i)};a.trigger("pgadmin-sqleditor:loading-icon:show",e("Loading the file..."));var s=n(".sql-editor-busy-fetching");s.addClass("show_progress"),n.ajax({url:t("sqleditor.load_file"),method:"POST",contentType:"application/json",data:JSON.stringify(o)}).done((function(e){a.gridView.query_tool_obj.setValue(e),a.gridView.current_file=i,a.setTitle(a.gridView.current_file.split("\\").pop().split("/").pop(),!0),a.trigger("pgadmin-sqleditor:loading-icon:hide"),s.removeClass("show_progress"),n("#btn-save-file").prop("disabled",!0),n("#btn-file-menu-save").css("display","none"),a.is_query_changed=!1,setTimeout((function(){a.gridView.query_tool_obj.focus()}),200)})).fail((function(e){a.trigger("pgadmin-sqleditor:loading-icon:hide");var t=[r],n=C.handleQueryToolAjaxError(d,a,e,"_select_file_handler",t,!1);l.error(n),s.removeClass("show_progress")}))},_save_file_handler:function(i){var a=this,r=i,o={file_name:decodeURI(i),file_content:a.gridView.query_tool_obj.getValue()};a.trigger("pgadmin-sqleditor:loading-icon:show",e("Saving the queries in the file...")),n.ajax({url:t("sqleditor.save_file"),method:"POST",contentType:"application/json",data:JSON.stringify(o)}).done((function(t){t.data.status&&(l.success(e("File saved successfully.")),a.gridView.current_file=i,a.setTitle(a.gridView.current_file.replace(/^.*[\\\/]/g,""),!0),n("#btn-save-file").prop("disabled",!0),n("#btn-file-menu-save").css("display","none"),a.is_query_changed=!1,setTimeout((function(){a.gridView.query_tool_obj.focus()}),200)),a.trigger("pgadmin-sqleditor:loading-icon:hide"),a.close_on_save&&a.check_needed_confirmations_before_closing_panel()})).fail((function(e){a.trigger("pgadmin-sqleditor:loading-icon:hide");var t=[r],n=C.handleQueryToolAjaxError(d,a,e,"_save_file_handler",t,!1);l.error(n)}))},_on_query_change:function(){var e=this;if(!e.is_query_changed){if(e.is_query_changed=!0,e.gridView.current_file){var t=e.gridView.current_file.replace(/^.*[\\\/]/g,"")+" *";e.setTitle(t,!0)}else e.preferences.new_browser_tab?t=window.document.title+" *":(r.each(V.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(t){t.isVisible()&&(e.gridView.panel_title=n(t._title).text())})),t=e.gridView.panel_title+" *"),e.setTitle(t);n("#btn-save-file").prop("disabled",!1),n("#btn-file-menu-save").css("display","block"),n("#btn-file-menu-dropdown").prop("disabled",!1)}},_init_polling_flags:function(){var e=this;e.POLL_FALLBACK_TIME=function(){var t=parseInt((Date.now()-e.query_start_time.getTime())/1e3);return t>=10&&t<30?500:t>=30&&t<60?1e3:t>=60&&t<90?2e3:t>=90?5e3:1}},_show_filter:function(){var e=this,t=!1;arguments.length>0&&"connect"==arguments[arguments.length-1]&&(t=!0),S.dialog(e,t)},_include_filter:function(){var i,a,o,s,c=this,u={};a=(i=c.slickgrid).getActiveCell(),r.isNull(a)||r.isUndefined(a)||(o=i.getColumns()[a.cell],s=i.getDataItem(a.row,a.cell),r.isNull(s)||r.isUndefined(s)||(u[o.field]=s[o.field]||"",c.trigger("pgadmin-sqleditor:loading-icon:show",e("Applying the new filter...")),n.ajax({url:t("sqleditor.inclusive_filter",{trans_id:c.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(u)}).done((function(t){c.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?O.executeQuery(c):l.alert(e("Filter By Selection Error"),t.data.result)}))})).fail((function(t){c.trigger("pgadmin-sqleditor:loading-icon:hide");var n=C.handleQueryToolAjaxError(d,c,t,"_include_filter",[],!0);l.alert(e("Filter By Selection Error"),n)}))))},_exclude_filter:function(){var i,a,o,s,c=this,u={};a=(i=c.slickgrid).getActiveCell(),r.isNull(a)||r.isUndefined(a)||(o=i.getColumns()[a.cell],s=i.getDataItem(a.row,a.cell),r.isNull(s)||r.isUndefined(s)||(u[o.field]=s[o.field]||"",c.trigger("pgadmin-sqleditor:loading-icon:show",e("Applying the new filter...")),n.ajax({url:t("sqleditor.exclusive_filter",{trans_id:c.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(u)}).done((function(t){c.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?O.executeQuery(c):l.alert(e("Filter Exclude Selection Error"),t.data.result)}),10)})).fail((function(t){c.trigger("pgadmin-sqleditor:loading-icon:hide");var n=C.handleQueryToolAjaxError(d,c,t,"_exclude_filter",[],!0);l.alert(e("Filter Exclude Selection Error"),n)}))))},_remove_filter:function(){var i=this;i.trigger("pgadmin-sqleditor:loading-icon:show",e("Removing the filter...")),n.ajax({url:t("sqleditor.remove_filter",{trans_id:i.transId}),method:"POST"}).done((function(t){i.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?O.executeQuery(i):l.alert(e("Remove Filter Error"),t.data.result)}))})).fail((function(t){i.trigger("pgadmin-sqleditor:loading-icon:hide");var n=C.handleQueryToolAjaxError(d,i,t,"_remove_filter",[],!0);l.alert(e("Remove Filter Error"),n)}))},_copy_row:g,_copy_row_with_header:function(){n(".copy-with-header").toggleClass("visibility-hidden")},_paste_row:function(){var e=this,t=e.slickgrid,i=t.getData(),a=i.getItems(),o=i.getLength(),s=t.getSelectedRows().sort((function(e,t){return e-t})),l=s.map((function(e){return a[e]})),d=[];for(var c in e.columns)e.columns[c].is_array&&d.push(e.columns[c].name);if(s=0==s.length?e.last_copied_rows:s,e.last_copied_rows=s,l.length>0){n("#btn-save-data").prop("disabled",!1);i.beginUpdate(),r.each(l,(function(t){var n,a,s=(n=t,a={},r.each(n,(function(e,t){void 0!==n[t]&&(r.isObject(n[t])&&-1==d.indexOf(t)?a[String(t)]=JSON.stringify(n[t]):a[String(t)]=n[t])})),a),l=(e.gridView.client_primary_key_counter++).toString();s.is_row_copied=!0,e.temp_new_rows.push(o),s[e.client_primary_key]=l,e.has_oids&&s.oid&&(s.oid=null),i.addItem(s),e.data_store.added[l]={err:!1,data:s},e.data_store.added_index[o]=l,o++})),i.endUpdate(),t.updateRowCount(),t.scrollRowIntoView(i.getLength()),t.setSelectedRows([])}},_set_limit:function(){var i=this,a=parseInt(n(".limit").val());i.trigger("pgadmin-sqleditor:loading-icon:show",e("Setting the limit on the result...")),n.ajax({url:t("sqleditor.set_limit",{trans_id:i.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(a)}).done((function(t){i.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?O.executeQuery(i):l.alert(e("Change limit Error"),t.data.result)}),10)})).fail((function(t){i.trigger("pgadmin-sqleditor:loading-icon:hide");var n=C.handleQueryToolAjaxError(d,i,t,"_set_limit",[],!0);l.alert(e("Change limit Error"),n)}))},disable_tool_buttons:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e;this.is_query_tool||(i=!0),n("#btn-explain").prop("disabled",i),n("#btn-explain-analyze").prop("disabled",i),n("#btn-explain-options-dropdown").prop("disabled",i),n("#btn-edit-dropdown").prop("disabled",i),n("#btn-load-file").prop("disabled",i),n("#btn-save-file").prop("disabled",i),n("#btn-file-menu-dropdown").prop("disabled",i),n("#btn-find").prop("disabled",i),n("#btn-find-menu-dropdown").prop("disabled",i),this.is_query_tool?(null!==t?n("#btn-cancel-query").prop("disabled",t):n("#btn-cancel-query").prop("disabled",!e),this.is_transaction_buttons_disabled?n("#btn-query-dropdown").prop("disabled",e):n("#btn-query-dropdown").prop("disabled",!0)):n("#btn-query-dropdown").prop("disabled",i)},disable_transaction_buttons:function(e){this.is_transaction_buttons_disabled=e,this.is_query_tool&&(n("#btn-commit").prop("disabled",e),n("#btn-rollback").prop("disabled",e))},_highlight_error:function(e){var t=0,n=0,i=0,a=0;this.gridView.query_tool_obj.removeLineClass(this.marked_line_no,"wrap","CodeMirror-activeline-background"),this.gridView.query_tool_obj.getSelection().length>0&&(a=this.gridView.query_tool_obj.getCursor(!0).line);var r=/LINE (\d+)/.exec(e),o=/Character: (\d+)/.exec(e);if(null!=r&&null!=o){t=this.marked_line_no=parseInt(r[1])-1+a;for(var s=parseInt(o[1])-1,l=0,d=a>0?a:0;d<t;d++)l+=this.gridView.query_tool_obj.getLine(d).length+1;n=s-l;var c=this.gridView.query_tool_obj.getLine(t);(i=c.indexOf(" ",n))<0&&(i=c.length),this.gridView.marker=this.gridView.query_tool_obj.markText({line:t,ch:n},{line:t,ch:i},{className:"sql-editor-mark"}),this.gridView.query_tool_obj.addLineClass(this.marked_line_no,"wrap","CodeMirror-activeline-background")}},_cancel_query:function(){var i=this;n.ajax({url:t("sqleditor.cancel_transaction",{trans_id:i.transId}),method:"POST",contentType:"application/json"}).done((function(t){t.data.status||l.alert(e("Cancel Query Error"),t.data.result),i.disable_tool_buttons(!1),Q=!1,r.isUndefined(i.download_csv_obj)||(i.download_csv_obj.abort(),n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),i.trigger("pgadmin-sqleditor:loading-icon:hide")),setTimeout((function(){i.gridView.query_tool_obj.focus()}),200)})).fail((function(t){i.disable_tool_buttons(!1);var n=C.handleQueryToolAjaxError(d,i,t,"_cancel_query",[],!1);l.alert(e("Cancel Query Error"),n)}))},trigger_csv_download:function(i,a){var o=this,s=t("sqleditor.query_tool_download",{trans_id:o.transId}),c={query:i,filename:a};n("#btn-flash").prop("disabled",!0),n("#btn-download").prop("disabled",!0),o.disable_tool_buttons(!0),o.set_sql_message(""),o.trigger("pgadmin-sqleditor:loading-icon:show",e("Downloading CSV...")),o.download_csv_obj=n.ajax({type:"POST",url:s,data:c,cache:!1}).done((function(e){if(r.isUndefined(e.data)){var t=new Blob([e],{type:"text/csv"}),i=(window.URL||window.webkitURL).createObjectURL(t),s=d.Browser.get_browser(),l=document.createElement("a");document.body.appendChild(l),"IE"===s.name&&window.navigator.msSaveBlob?window.navigator.msSaveBlob(t,a):(l.setAttribute("href",i),l.setAttribute("download",a),l.click()),document.body.removeChild(l),o.download_csv_obj=void 0}else e.status||(o._highlight_error(e.data.result),o.set_sql_message(e.data.result));n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),o.disable_tool_buttons(!1),o.trigger("pgadmin-sqleditor:loading-icon:hide")})).fail((function(t){var i="";n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),o.disable_tool_buttons(!1),o.trigger("pgadmin-sqleditor:loading-icon:hide"),i="abort"==t.statusText?e("CSV Download cancelled."):C.handleQueryToolAjaxError(d,o,t,e("Download CSV"),[],!0),l.alert(e("Download CSV error"),i)}))},call_cache_preferences:function(){V.default.pgAdmin.Browser.cache_preferences("sqleditor"),F.preference_version(F.generate_preference_version())},_auto_rollback:function(){var i=this,a=!0;!0===n(".auto-rollback").hasClass("visibility-hidden")?n(".auto-rollback").removeClass("visibility-hidden"):(n(".auto-rollback").addClass("visibility-hidden"),a=!1),n.ajax({url:t("sqleditor.auto_rollback",{trans_id:i.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(a)}).done((function(t){t.data.status||l.alert(e("Auto Rollback Error"),t.data.result)})).fail((function(t){var n=C.handleQueryToolAjaxError(d,i,t,"_auto_rollback",[],!0);l.alert(e("Auto Rollback Error"),n)}))},_auto_commit:function(){var i=this,a=!0;!0===n(".auto-commit").hasClass("visibility-hidden")?n(".auto-commit").removeClass("visibility-hidden"):(n(".auto-commit").addClass("visibility-hidden"),a=!1),n.ajax({url:t("sqleditor.auto_commit",{trans_id:i.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(a)}).done((function(t){t.data.status||l.alert(e("Auto Commit Error"),t.data.result)})).fail((function(t){var n=C.handleQueryToolAjaxError(d,i,t,"_auto_commit",[],!0);l.alert(e("Auto Commit Error"),n)}))},_toggle_explain_option:function(e){var t=".explain-".concat(e);n(t).toggleClass("visibility-hidden")},_explain_verbose:function(){this._toggle_explain_option("verbose")},_explain_costs:function(){this._toggle_explain_option("costs")},_explain_buffers:function(){this._toggle_explain_option("buffers")},_explain_timing:function(){this._toggle_explain_option("timing")},_explain_summary:function(){this._toggle_explain_option("summary")},_explain_settings:function(){this._toggle_explain_option("settings")},_indent_selected_code:function(){this.gridView.query_tool_obj.execCommand("indentMore")},_unindent_selected_code:function(){this.gridView.query_tool_obj.execCommand("indentLess")},isQueryRunning:function(){return Q},setIsQueryRunning:function(e){Q=e},check_needed_confirmations_before_closing_panel:function(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this;i.ignore_on_close&&!n||(i.ignore_on_close={unsaved_data:!1,unsaved_query:!1});var a=i.ignore_on_close.unsaved_data,o=i.ignore_on_close.unsaved_query;if(!a&&i.can_edit&&i.preferences.prompt_save_data_changes&&i.data_store&&(r.size(i.data_store.added)||r.size(i.data_store.updated)||r.size(i.data_store.deleted)))t=e("The data has changed. Do you want to save changes?"),i.unsaved_changes_user_confirmation(t,!0);else if(!o&&i.is_query_tool&&i.is_query_changed&&i.preferences.prompt_save_query_changes)t=e("The text has changed. Do you want to save changes?"),i.unsaved_changes_user_confirmation(t,!1);else if(!i.preferences.prompt_commit_transaction||i.last_transaction_status!==I.TRANSACTION_STATUS_INTRANS&&i.last_transaction_status!==I.TRANSACTION_STATUS_INERROR)i.ignore_on_close=void 0,i.close();else{var s=i.last_transaction_status==I.TRANSACTION_STATUS_INERROR;i.uncommitted_transaction_user_confirmation(s)}return!1},uncommitted_transaction_user_confirmation:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this;l.confirmCommit||l.dialog("confirmCommit",(function(){return{main:function(e,t,n){this.is_commit_disabled=n,this.setHeader(e),this.setContent(t)},setup:function(){return{buttons:[{text:e("Cancel"),key:27,invokeOnClose:!0,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button"},{text:e("Rollback"),className:"btn btn-primary fa fa-lg pg-alertify-button"},{text:e("Commit"),className:"btn btn-primary fa fa-lg pg-alertify-button"}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},prepare:function(){this.is_commit_disabled?this.__internal.buttons[2].element.disabled=!0:this.__internal.buttons[2].element.disabled=!1},callback:function(e){switch(e.index){case 0:break;case 1:n.close_on_idle_transaction=!0,O.executeRollback(n);break;case 2:n.close_on_idle_transaction=!0,O.executeCommit(n)}}}}));var i=e("The current transaction is not commited to the database.Do you want to commit or rollback the transaction?");l.confirmCommit(e("Commit transaction?"),i,t)},unsaved_changes_user_confirmation:function(t,n){var i=this;l.confirmSave||l.dialog("confirmSave",(function(){return{main:function(e,t,n){this.is_unsaved_data=n,this.setHeader(e),this.setContent(t)},setup:function(){return{buttons:[{text:e("Cancel"),key:27,invokeOnClose:!0,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button"},{text:e("Don't save"),className:"btn btn-secondary fa fa-lg fa-trash-o pg-alertify-button"},{text:e("Save"),className:"btn btn-primary fa fa-lg fa-save pg-alertify-button"}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},callback:function(e){switch(e.index){case 0:break;case 1:i.close_on_save=!1,this.is_unsaved_data?i.ignore_on_close.unsaved_data=!0:i.ignore_on_close.unsaved_query=!0,i.check_needed_confirmations_before_closing_panel();break;case 2:i.close_on_save=!0,this.is_unsaved_data?i.save_data():i._save_file()}}}})),l.confirmSave(e("Save changes?"),t,n)},close:function(){var e=this;F.Events.off("pgadmin:user:logged-in",this.initTransaction),r.each(V.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(t){t.isVisible()&&(window.onbeforeunload=null,t.off(U.EVENT.CLOSING),r.isUndefined(e.col_size)||delete e.col_size,V.default.pgAdmin.Browser.docker.removePanel(t))}))},update_notifications:function(e){D.updateNotifications(e)}}),d.SqlEditor={create:function(e){return new W(e)},jquery:n},d.SqlEditor}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;n(28),n(38),n(8),n(42),n(17),n(21),n(56),n(36),n(32),n(11),n(12),n(35),n(5),n(43),n(29),n(74),n(20),n(7),n(37),i=[n(6),n(0),n(1),n(3),n(14),n(284),n(285),n(286),n(2),n(119)],void 0===(a=function(t,i,a,r,o,s,l,d,c){r=r||window.pgAdmin||{},l=l.default;var u=null;if(r.Explain)return r.Explain;var f=r.Explain={prefix:t("misc.index")+"static/explain/img/"},p=a.template(['<tr<% if (className) {%> class="<%=className%>"<%}%>>',' <td class="renderable name"><%- data.name %></td>',' <td class="renderable text-right"><%- data.count %></td>',' <td class="renderable timings d-none text-right">',"<%=Math.ceil10(data.sum_of_times, -3)%> ms","</td>",' <td class="renderable timings d-none text-right">',"<%=Math.ceil10(((data.sum_of_times||0)/(total_time||1)) * 100, -2)%>%","</td>","</tr>"].join("")),h=a.template(['<tr class="pga-ex-row','<% if (data["Plans"] && data["Plans"].length > 0) {%>'," pga-ex-collapsible","<%}%>",'<% if (data["exclusive_flag"] !== "undefined") {%>'," pga-ex-exclusive-",'<%- data["exclusive_flag"] %>',"<%}%>",'<% if (data["inclusive_flag"] !== "undefined") {%>'," pga-ex-inclusive-",'<%- data["inclusive_flag"] %>',"<%}%>",'<% if (data["rowsx_flag"] !== "undefined") {%>'," pga-ex-rowsx-",'<%- data["rowsx_flag"] %>',"<%}%>",'"','<% if (data["parent_node"]) {%>',' data-parent="pga_ex_<%= data["parent_node"] %>"',"<%}%>",' data-ex-id="pga_ex_<%= data["level"].join("_") %>">',' <td class="renderable pg-ex-highlighter clickable">','  <i class="fa fa-circle invisible"></i>',"</td>",' <td class="renderable clickable serial text-right">','<%= (data["_serial"]) %>.</td>',' <td class="renderable clickable" style="padding-left: ','<%= (data["level"].length) * 30%>px"','title="<%= tooltip_text %>"',">",'  <i class="pg-ex-subplans fa fa-long-arrow-right"></i>',"<%= display_text %>","<%if (node_extra_info && node_extra_info.length > 0 ) {%>","<ui>","<%  for (var node_info_idx=0; "," node_info_idx<node_extra_info.length;node_info_idx++) {%>"," <li>","<%= node_extra_info[node_info_idx] %>","</li>","<% }%>","</ui>","<%}%>"," </td>",' <td class="renderable timings d-none text-right ','<% if (data["exclusive_flag"] !== "undefined") {%>',"pga-ex-exclusive-",'<%- data["exclusive_flag"] %>',"<%}%>",'">','<% if (typeof(data["exclusive"]) !== "undefined") {%>','<%= data["exclusive"] %> ms',"<%}%>"," </td>",' <td class="renderable timings d-none text-right ','<% if (data["inclusive_flag"] !== "undefined") {%>',"pga-ex-inclusive-",'<%- data["inclusive_flag"] %>',"<%}%>",'">','<% if (typeof(data["inclusive"]) !== "undefined") {%>','<%= data["inclusive"] %> ms',"<%}%>"," </td>",' <td class="renderable rowsx d-none text-right ','<% if (data["rowsx_flag"] !== "undefined") {%>',"pga-ex-rowsx-",'<%- data["rowsx_flag"] %>',"<%}%>",'">','<% if (data["rowsx_direction"] === "positive") {%>',"&uarr;","<%} else {%>","&darr;","<%}%> ",'<% if (typeof(data["rowsx"]) !== "undefined") {%>','<%- data["rowsx"] %>',"<%}%>  "," </td>",' <td class="renderable rowsx rows d-none text-right">','<% if (typeof(data["Actual Rows"]) !== "undefined") {%>','<%= data["Actual Rows"] %>',"<%}%>"," </td>",' <td class="renderable rowsx plan_rows d-none text-right">','<%= data["Plan Rows"] %>'," </td>",' <td class="renderable rows rowsx d-none text-right">','<% if (typeof(data["Actual Loops"]) !== "undefined") {%>','<%= data["Actual Loops"] %>',"<%}%>"," </td>",' <td class="renderable d-none">','  <i class="fa fa-ellipsis-h"></i>'," </td>","</tr>"].join("")),_=o.Model.extend({defaults:{Plans:[],level:[],image:void 0,image_text:void 0,xpos:void 0,ypos:void 0,width:100,height:100},_createSame:function(){return new _},parse:function(e,t){var n=1,i=e.level=e.level||[n],r=[],o=e["Node Type"],s=e.xpos=e.xpos-100,l=e.ypos,c=0;t.ctx.totalNodes++,t.ctx._explainTable.total_time=e.total_time||e["Actual Total Time"],e._serial=t.ctx.totalNodes,e.width=100,e.height=100,"SubPlan"===e["Parent Relationship"]&&(e.width+=62.5,e.height+=50,e.ypos+=25,s-=25,l+=25),o.startsWith("(slice")&&(o=o.substring(0,7));var u=d.default,f=a.isFunction(u[o])&&u[o].apply(void 0,[e])||u[o]||{image:"ex_unknown.svg",image_text:o};if(e.image=f.image,e.image_text=f.image_text,"Actual Total Time"in e&&"Actual Loops"in e&&(e.inclusive=Math.ceil10(e["Actual Total Time"]*e["Actual Loops"],-3),e.exclusive=e.inclusive,e.inclusive_factor=e.inclusive/(e.total_time||e["Actual Total Time"]),e.inclusive_flag=e.inclusive_factor<=.1?"1":e.inclusive_factor<.5?"2":e.inclusive_factor<=.9?"3":"4"),"Actual Rows"in e&&"Plan Rows"in e&&(0===e["Actual Rows"]||e["Actual Rows"]>e["Plan Rows"]?(e.rowsx=0===e["Plan Rows"]?0:e["Actual Rows"]/e["Plan Rows"],e.rowsx_direction="negative"):(e.rowsx=0===e["Actual Rows"]?0:e["Plan Rows"]/e["Actual Rows"],e.rowsx_direction="positive"),e.rowsx_flag=e.rowsx<=10?"1":e.rowsx<=100?"2":e.rowsx<=1e3?"3":"4",e.rowsx=Math.ceil10(e.rowsx,-2)),"Plans"in e){var p,h=this;e.width+=200,a.each(e.Plans,(function(o){var d=a.clone(i),u=h._createSame();d.push(n),u.set(u.parse(a.extend(o,{level:d,xpos:s-200,ypos:l,total_time:e.total_time||e["Actual Total Time"],parent_node:i.join("_")}),t)),c<u.get("width")&&(c=u.get("width")),"exclusive"in e&&(p=u.get("inclusive"))&&(e.exclusive-=p);var f=u.get("height");1!==n?e.height=e.height+f+60:f>e.height&&(e.height=f),l+=f+60,r.push(u),n++}))}return"exclusive"in e&&(e.exclusive=Math.ceil10(e.exclusive,-3),e.exclusive_factor=e.exclusive/(e.total_time||e["Actual Total Time"]),e.exclusive_flag=e.exclusive_factor<=.1?"1":e.exclusive_factor<.5?"2":e.exclusive_factor<=.9?"3":"4"),e.width+=c,e.Plans=r,e},draw:function(e,t,n,i,r,o,s,l){var d=e.g(),c=t+this.get("xpos"),u=n+this.get("ypos"),p="SubPlan"===this.get("Parent Relationship");!function(e,t){var n,i,r=['<span class="pg-explain-text-name">'],o=[],s=[],l=t._explainTable;if(/Scan/.test(e["Node Type"])?(r.push(e["Node Type"]),o.push(e["Node Type"])):(r.push(e.image_text),o.push(e.image_text)),n=o.join(""),r.push("</span>"),void 0!==e["Index Name"]&&(r.push(" using "),o.push(" using "),r.push('<span class="pg-explain-text-name">'),r.push(a.escape(e["Index Name"])),o.push(e["Index Name"]),r.push("</span>")),void 0!==e["Relation Name"]&&(r.push(" on "),o.push(" on "),void 0!==e.Schema&&(r.push('<span class="pg-explain-text-name">'),r.push(a.escape(e.Schema)),o.push(e.Schema),r.push("</span>"),r.push("."),o.push(".")),r.push('<span class="pg-explain-text-name">'),r.push(a.escape(e["Relation Name"])),o.push(e["Relation Name"]),r.push("</span>"),void 0!==e.Alias&&(r.push(" as "),o.push(" as "),r.push('<span class="pg-explain-text-name">'),r.push(a.escape(e.Alias)),o.push(a.escape(e.Alias)),r.push("</span>"))),void 0!==e["Plan Rows"]&&void 0!==e["Plan Width"]){var d=[" (cost=",void 0!==e["Startup Cost"]?e["Startup Cost"]:"","..",void 0!==e["Total Cost"]?e["Total Cost"]:""," rows=",e["Plan Rows"]," width=",e["Plan Width"],")"].join("");r.push(d),o.push(d)}if(void 0!==e["Actual Startup Time"]||void 0!==e["Actual Total Time"]||void 0!==e["Actual Rows"]){var c=[" (",void 0!==e["Actual Startup Time"]?"actual="+e["Actual Startup Time"]+"..":"",void 0!==e["Actual Total Time"]?e["Actual Total Time"]+" ":"",void 0!==e["Actual Rows"]?"rows="+e["Actual Rows"]:"",void 0!==e["Actual Loops"]?" loops="+e["Actual Loops"]:"",")"].join("");r.push(c),o.push(c)}if("Join Filter"in e&&s.push("<b>Join Filter</b>: "+a.escape(e["Join Filter"])),"Filter"in e&&s.push("<b>Filter</b>: "+a.escape(e.Filter)),"Index Cond"in e&&s.push("<b>Index Cond</b>: "+a.escape(e["Index Cond"])),"Hash Cond"in e&&s.push("<b>Hash Cond</b>: "+a.escape(e["Hash Cond"])),"Rows Removed by Filter"in e&&s.push("<b>Rows Removed by Filter</b>: "+a.escape(e["Rows Removed by Filter"])),"Peak Memory Usage"in e){var u=["<b>Buckets</b>:",a.escape(e["Hash Buckets"]),"<b>Batches</b>:",a.escape(e["Hash Batches"]),"<b>Memory Usage</b>:",a.escape(e["Peak Memory Usage"]),"kB"].join(" ");s.push(u)}if("Recheck Cond"in e&&s.push("<b>Recheck Cond</b>: "+e["Recheck Cond"]),"Exact Heap Blocks"in e&&s.push("<b>Heap Blocks</b>: exact="+e["Exact Heap Blocks"]),l.rows.push(h({data:e,display_text:r.join(""),tooltip_text:o.join(""),node_extra_info:s})),void 0!==e.exclusive_flag&&(l.show_timings=!0),void 0!==e.rowsx_flag&&(l.show_rowsx=!0),void 0!==e["Actual Loops"]&&(l.show_rows=!0),void 0!==e["Plan Rows"]&&(l.show_plan_rows=!0),void 0!==e.total_time&&(l.total_time=e.total_time),void 0!==e["Relation Name"]){var f=(void 0!==e.Schema?e.Schema+".":"")+e["Relation Name"],p=l.statistics.tables[f]||{name:f,count:0,sum_of_times:0,nodes:{}};i=p.nodes[n]||{name:n,count:0,sum_of_times:0},p.count++,p.sum_of_times+=e.exclusive,i.count++,i.sum_of_times+=e.exclusive,p.nodes[n]=i,l.statistics.tables[f]=p}(i=l.statistics.nodes[n]||{name:n,count:0,sum_of_times:0}).count++,i.sum_of_times+=e.exclusive,l.statistics.nodes[n]=i}(this.toJSON(),l),p&&(d.rect(c-this.get("width")+100+25,u-this.get("height")+100+25-5,this.get("width")-25,this.get("height")+(u-25),5).attr({stroke:"#444444",strokeWidth:1.2,fill:"gray",fillOpacity:.2}),d.text(c+100-this.get("width")/2-25,u+100-this.get("height")/2-25,this.get("Subplan Name")).attr({fontSize:"15px","text-anchor":"start",fill:"red"})),this._drawImage(e,d,f.prefix+this.get("image"),c,u,o,s,l);var _=null==this.get("Schema")?this.get("image_text"):this.get("Schema")+"."+this.get("image_text");if(d.multitext(c+50+5,u+100-5,_,150,{"font-size":"15px","text-anchor":"middle"}),!a.isUndefined(r)){var g=c+100,m=u+50,b=i-10,v=r+50,y=this.get("Startup Cost"),w=this.get("Total Cost"),x=2;null!=y&&null!=w&&(x=(x=Math.round(Math.log((y+w)/2+y)))<1?1:x>10?10:x);var C={stroke:"#000000",strokeWidth:x+2},S={stroke:"#866486",strokeWidth:x+2},k={viewBox:[0,0,20,20].join(" ")};this.drawPolyLine(d,g,m,b,v,p?S:C,k)}var T=this.get("Plans");a.each(T,(function(i){i.draw(e,t,n,c,u,o,s,l)}))},_drawImage:function(e,t,n,i,a,r,o){this.drawImage(t,n,i,a,r,o)},toJSON:function(e){var t=o.Model.prototype.toJSON.apply(this,arguments);if(e)delete t.Plans;else{var n=[];a.each(t.Plans,(function(e){n.push(e.toJSON())})),t.Plans=n}return t},drawPolyLine:function(e,t,n,i,a,r,o){var s=t+(i-t)/3,l=t+(i-t)/3*2,d=e.polygon([0,10,5,10,2.5,0,0,10]).transform("r90").marker(0,0,10,10,0,5).attr(o);e.line(t,n,s,n).attr(r),e.line(s-1,n,l,a).attr(r),e.line(l,a,i,a).attr(r).attr({markerEnd:d})},drawImage:function(e,t,n,r,o,s){var l=e.image(t,n+25,r+25,50,50),d=this.toJSON(),c="<title>";a.each(d,(function(e,t){"image"!==t&&"Plans"!==t&&"level"!==t&&"image"!==t&&"image_text"!==t&&"xpos"!==t&&"ypos"!==t&&"width"!==t&&"height"!==t&&(c+="".concat(t,": ").concat(e,"\n"))})),c+="</title>",l.append(u.parse(c)),l.mouseover((function(){s.empty(),l.node.textContent="";var e=i("<table></table>",{class:"pgadmin-tooltip-table"}).appendTo(s);a.each(d,(function(t,n){"image"!==n&&"Plans"!==n&&"level"!==n&&"image"!==n&&"image_text"!==n&&"xpos"!==n&&"ypos"!==n&&"width"!==n&&"height"!==n&&(n=a.escape(n),t=a.escape(t),e.append('\n              <tr>\n                <td class="label explain-tooltip">'.concat(n,'</td>\n                <td class="label explain-tooltip-val">').concat(t,"</td>\n              </tr>\n            ")))}));var t=o.data("zoom-factor"),c=(n+100)*t-o.scrollLeft(),u=r*t-o.scrollTop();c=c<0?0:c,u=u<0?0:u,s.css({opacity:"0.8"}),s.css("left",c),s.css("top",u),i(".pgadmin-explain-tooltip").css("padding","5px"),i(".pgadmin-explain-tooltip").css("border","1px solid white")})),l.mouseout((function(){l.append(u.parse(c)),s.empty(),s.css({opacity:"0"}),s.css("left",0),s.css("top",0)}))}}),g=_.extend({_createSame:function(){return new g({parse:!0})},_drawImage:function(e,t,n,i,a,o,s,l){var d=r.Browser.get_browser();if("IE"===d.name||"Safari"===d.name&&parseInt(d.version)<10)this.drawImage(t,n,i,a,o,s);else{var c=this,p=f.prefix+this.get("image");u.load(p,(function(n){var r=u();r.append(n),c.drawImage(t,r.toDataURL(),i,a,o,s),e.parent().attr({"xmlns:xlink":"http://www.w3.org/1999/xlink"}),setTimeout((function(){l._onImageDownloaded()}),100)}))}}}),m=o.Model.extend({defaults:{Plan:void 0,xpos:0,ypos:0},initialize:function(){this.set("Plan",new _),this.set("Statistics",new s)},parse:function(e,t){if(e&&"Plan"in e){var n=this.get("Plan");n.set(n.parse(a.extend(e.Plan,{xpos:0,ypos:0}),t)),e.xpos=0,e.ypos=0,e.width=n.get("width")+50,e.height=n.get("height")+100,delete e.Plan}var i=this.get("Statistics");if(e&&"JIT"in e&&(i.set("JIT",e.JIT),delete e.JIT),e&&"Triggers"in e&&(i.set("Triggers",e.Triggers),delete e.Triggers),e){var r={};["Planning Time","Execution Time"].forEach((function(t){t in e&&(r[t]=e[t])})),i.set("Summary",r)}return e&&"Settings"in e&&(i.set("Settings",e.Settings),delete e.Settings),e},toJSON:function(){var e=o.Model.prototype.toJSON.apply(this,arguments);return e.Plan&&(e.Plan=e.Plan.toJSON()),e},draw:function(e,t,n,i,a,r){var o=e.g();o.rect(0,0,this.get("width")-10,this.get("height")-10,5).attr({fill:"#FFF"}),this.get("Plan").draw(o,t,n,void 0,void 0,i,a,r),this.get("Statistics").set_statistics(a)}});return a.extend(f,{DrawJSONPlan:function(t,i,a,r){var o=this;n.e(16).then(function(s){(function(e){e=n(202);(u=e).plugin((function(e,t,n){n.prototype.multitext=function(t,n,i,a,r){var o=e(),s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",l=o.text(0,0,s);l.attr(r);var d=l.getBBox().width/s.length,c=Math.round(a/d)-1;o.remove();for(var u=i.split(" "),f=0,p=[],h="",_=function e(t,n,i){var r=i.length,o=[];return 0==r?o:(n&&n+r*d>a?(o.push(t),o=o.concat(e("",0,i))):n?o.push(t+" "+i):(t&&o.push(t),i.length>c+1?o.push(i.slice(0,c)+"-"):o.push(i),o=o.concat(e("",0,i.slice(c)))),o)},g=0;g<u.length;g++){var m=_(h,f,u[g]);h&&(p=p.slice(0,p.length-1)),f=(h=(p=p.concat(m))[p.length-1]).length*d}var b=this.text(t,n,p).attr(r);return b.selectAll("tspan:nth-child(n+2)").attr({dy:"1.2em",x:t}),b}})),o.goForDraw(t,i,a,r)}).call(this,n(103)(e))}.bind(null,n)).catch((function(e){throw e}))},goForDraw:function(e,t,n,o){var d=a.extend(o||{},{totalNodes:0,totalDownloadedNodes:0,isDownloaded:0});e.empty().attr("el","sm").addClass("pg-no-overflow pg-el-container");var h=function e(){var t=e.cnt=(e.cnt||0)+1,n=function(e,n,i,a){return['   <li class="nav-item" role="presentation">','    <a class="nav-link ',a?"active":"",'"','       data-toggle="tab" tabindex="0"','       data-tab-index="'.concat(e,'"'),'       aria-selected="',a?"true":"false",'"','       role="tab" data-explain-role="'.concat(n,'"'),'       href="#pga_explain_'.concat(n,"_").concat(t,'"'),'       aria-controls="pga_explain_'.concat(n,"_").concat(t,'"'),'       id="pgah_explain_'.concat(n,"_").concat(t,'"> '),i,"</a>","</li>"].join("")},a=function(e,n,i){return['   <div role="tabpanel" tabindex="0" class="tab-pane pg-el-sm-12',"        pg-el-md-12 pg-el-lg-12 pg-el-12 fade collapse",n?" active show":""," ".concat(i,'"'),'        data-explain-tabpanel="'.concat(e,'"'),'        id="pga_explain_'.concat(e,"_").concat(t,'"'),'        aria-labelledby="pgah_explain_'.concat(e,"_").concat(t,'">'),"   </div>"].join("")};return i(['<div class="obj_properties container-fluid">',' <div tabindex="1" class="backform-tab pg-el-12" role="tabpanel">','  <ul class="nav nav-tabs" role="tablist">',"   </li>",'   <li class="nav-item" role="presentation">',n(1,"graphical",c("Graphical"),!0),n(2,"table",c("Analysis"),!1),n(3,"statistics",c("Statistics"),!1),"  </ul>",'  <div class="tab-content pg-el-sm-12 pg-el-12">',a("graphical",!0,"w-100 h-100 p-0"),a("table",!1,"p-0"),a("statistics",!1,""),"   </div>","  </div>"," </div>","</div>"].join(""))}(),_=i(['<table class="backgrid table presentation table-bordered ','       table-noouter-border table-hover">'," <thead>","  <tr>",'    <th class="renderable pga-ex-collapsible" rowspan="2"></th>','    <th class="renderable" rowspan="2"><button disabled>',c("#"),"</button></th>",'    <th class="renderable" rowspan="2"><button disabled>',c("Node"),"</button></th>",'    <th class="renderable timings d-none" colspan="2"><button disabled>',c("Timings"),"</button></th>",'    <th class="renderable rowsx rows plan_rows d-none" colspan="3">',"<button disabled>",c("Rows"),"</button></th>",'    <th class="renderable rows rowsx d-none" rowspan="2">',"<button disabled>",c("Loops"),"</button></th>",'    <th class="renderable d-none" rowspan="2"><button disabled>',"  </tr>","  <tr>",'    <th class="renderable timings d-none"><button disabled>',c("Exclusive"),"</button></th>",'    <th class="renderable timings d-none"><button disabled>',c("Inclusive"),"</button></th>",'    <th class="renderable rowsx d-none"><button disabled>',c("Rows X"),"</button></th>",'    <th class="renderable rows rowsx d-none"><button disabled>',c("Actual"),"</button></th>",'    <th class="renderable plan_rows rowsx d-none"><button disabled>',c("Plan"),"</button></th>","  </tr>"," </thead>","</table>"].join("")),b=i(['<div class="row row-eq-height">',' <div class="col-sm-6 col-xs-6">','  <div class="col-xs-12 badge">',c("Statistics per Node Type"),"  </div>",'  <table class="backgrid table presentation table-bordered ','         table-hover" for="per_node_type">',"   <thead>","    <tr>",'      <th class="renderable"><button disabled>',c("Node type"),"</button></th>",'      <th class="renderable"><button disabled>',c("Count"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("Time spent"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("%% of query"),"</button></th>","    </tr>","   </thead>","  </table>"," </div>",' <div class="col-sm-6 col-xs-6">','  <div class="col-xs-12 badge">',c("Statistics per Table"),"  </div>",'  <table class="backgrid table presentation table-bordered ','         table-hover" for="per_table">',"   <thead>","    <tr>",'      <th class="renderable"><button disabled>',c("Table name"),"</button></th>",'      <th class="renderable"><button disabled>',c("Scan count"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("Total time"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("%% of query"),"</button></th>","    </tr>","    <tr>",'      <th class="renderable"><button disabled>',c("Node type"),"</button></th>",'      <th class="renderable"><button disabled>',c("Count"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("Sum of times"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("%% of table"),"</button></th>","    </tr>","   </thead>","  </table>"," </div>","</div>"].join("")),v=h.find("[data-explain-tabpanel=graphical]"),y=h.find("[data-explain-tabpanel=table]");d.currentTab=e.find(".nav-link[aria-selected=true]").attr("data-explain-role"),h.appendTo(e),_.appendTo(y),b.appendTo(h.find("[data-explain-tabpanel=statistics]"));var w=i.extend(!0,[],t),x=1,C=i("<div></div>",{class:"pg-explain-zoom-area btn-group btn-group-sm",role:"group"}).appendTo(v),S=i("<button></button>",{class:"btn btn-secondary pg-explain-zoom-btn",title:c("Zoom in"),"aria-label":c("Zoom in"),tabindex:0}).appendTo(C).append(i("<i></i>",{class:"fa fa-search-plus"})),k=i("<button></button>",{class:"btn btn-secondary pg-explain-zoom-btn",title:c("Zoom to original"),"aria-label":c("Zoom to original"),tabindex:0}).appendTo(C).append(i("<i></i>",{class:"fa fa-arrows-alt"})),T=i("<button></button>",{class:"btn btn-secondary pg-explain-zoom-btn",title:c("Zoom out"),"aria-label":c("Zoom out"),tabindex:0}).appendTo(C).append(i("<i></i>",{class:"fa fa-search-minus"})),E=i("<div></div>",{class:"pg-explain-download-area btn-group btn-group-sm",role:"group"}).appendTo(v),P=i("<button></button>",{id:"btn-explain-download",class:"btn btn-secondary pg-explain-download-btn",title:c("Download"),"aria-label":c("Download"),tabindex:0,disabled:function(){var e=r.Browser.get_browser();return"IE"===e.name?(this.title="Not supported for Internet Explorer",!0):"Safari"===e.name&&parseInt(e.version)<10&&(this.title="Not supported for Safari version less than 10.1",!0)}}).appendTo(E).append(i("<i></i>",{class:"fa fa-download"})),q=i("<div></div>",{class:"pg-explain-stats-area btn-group btn-group-sm d-none",role:"group"}).appendTo(v);i("<button></button>",{id:"btn-explain-stats",class:"btn btn-secondary pg-explain-stats-btn",title:c("Statistics"),"aria-label":c("Statistics"),tabindex:0}).appendTo(q).append(i("<i></i>",{class:"fa fa-line-chart"}));var O=i("<div></div>",{class:"pgadmin-explain-container w-100 h-100 overflow-auto"}).appendTo(v),D=i("<div></div>",{id:"toolTip",class:"pgadmin-explain-tooltip"}).appendTo(v);D.empty(),O.data("zoom-factor",x);var N,j,A,M=0,R=25;d._explainTable={rows:[],statistics:{tables:{},nodes:{}}},d._onImageDownloaded=function(){if(d.totalDownloadedNodes++,!d.isDownloaded&&d.totalNodes===d.totalDownloadedNodes){d.isDownloaded=!0;var e=u("#".concat(v.attr("id")," .pgadmin-explain-container svg")),t="explain_plan_"+(new Date).getTime()+".svg";l.downloadSVG(e.toString(),t)}},a.each(t,(function(t){var a;n?a=new(m.extend({initialize:function(){this.set("Plan",new g({parse:!0})),this.set("Statistics",new s)}}))({parse:!0}):a=new m;a.set(a.parse(t,{ctx:d})),M=a.get("width"),R=a.get("height");var r=u(M,R),o=i(r.node).detach();O.append(o),a.draw(r,M-25,25,O,D,d);var c=O.width();if(c<M){x=(x=(x=c/M)<.01?.01:x)>1?1:x;var p=new u.matrix;p.scale(x,x),o.find("g").first().attr({transform:p}),o.attr({width:M*x,height:R*x}),O.data("zoom-factor",x)}S.on("click",(function(){x=x+.05>2?2:x+.05;var e=new u.matrix;e.scale(x,x),o.find("g").first().attr({transform:e}),o.attr({width:M*x,height:R*x}),O.data("zoom-factor",x)})),T.on("click",(function(){x=x-.05<.01?.01:x-.05;var e=new u.matrix;e.scale(x,x),o.find("g").first().attr({transform:e}),o.attr({width:M*x,height:R*x}),O.data("zoom-factor",x)})),k.on("click",(function(){x=1;var e=new u.matrix;e.scale(x,x),o.find("g").first().attr({transform:e}),o.attr({width:M*x,height:R*x}),O.data("zoom-factor",x)})),P.on("click",(function(){f.DrawJSONPlan(e,w,!0),O.on("explain:svg:downloaded",(function(){if(d.totalDownloadedNodes++,!d.isDownloaded&&d.totalNodes===d.totalDownloadedNodes){d.isDownloaded=!0;var e=u(".pgadmin-explain-container svg"),t="explain_plan_"+(new Date).getTime()+".svg";l.downloadSVG(e.toString(),t)}}))}))})),N=d._explainTable,j=_,A=i("<tbody></tbody>"),a.each(N.rows,(function(e){i(e).appendTo(A)})),A.appendTo(j),!0===N.show_timings&&j.find(".timings").removeClass("d-none"),!0===N.show_rowsx?j.find(".rowsx").removeClass("d-none"):!0===N.show_rows?(j.find(".rows").removeClass("d-none"),j.find("thead .rows[colspan=3]").attr("colspan",1)):!0===N.show_plan_rows&&(j.find(".plan_rows").removeClass("d-none"),j.find("thead .rows[colspan=3]").attr("colspan",1)),function(e,t){var n=t.find('table[for="per_table"]'),i=t.find('table[for="per_node_type"]');a.each(a.sortBy(a.values(e.statistics.nodes),"name"),(function(t){return i.append(p({data:t,total_time:e.total_time,className:""}))})),a.each(a.sortBy(a.values(e.statistics.tables),"name"),(function(t){t.sum_of_times=0,a.each(t.nodes,(function(e){return t.sum_of_times+=e.sum_of_times})),n.append(p({data:t,total_time:e.total_time,className:"table"})),a.each(a.sortBy(a.values(t.nodes),"name"),(function(e){n.append(p({data:e,total_time:t.sum_of_times,className:"node"}))}))})),e.show_timings&&t.find(".timings").removeClass("d-none")}(d._explainTable,b),e.on("shown.bs.tab",(function(){d.currentTab=e.find(".nav-link[aria-selected=true]").attr("data-explain-role")}))}}),i(document).on("mouseenter",".pga-ex-row.pga-ex-collapsible",(function(e){var t=i(e.currentTarget);t.parent().find("[data-parent="+t.attr("data-ex-id")+"] > td.pg-ex-highlighter > i").removeClass("invisible")})).on("mouseleave",".pga-ex-row.pga-ex-collapsible",(function(e){var t=i(e.currentTarget);t.parent().find(".pga-ex-row[data-parent="+t.attr("data-ex-id")+"] > td.pg-ex-highlighter > i").addClass("invisible")})).on("click",".pga-ex-row.pga-ex-collapsible",(function(e){var t=i(e.currentTarget);"true"===t.attr("data-collapsed")?(t.parent().find(".pga-ex-row[data-parent^="+t.attr("data-ex-id")+"]").removeClass("d-none").filter("[data-collapsed=true]").each((function(e,t){var n=i(t);n.parent().find(".pga-ex-row[data-parent^="+n.attr("data-ex-id")+"]").addClass("d-none")})),t.attr("data-collapsed","false")):(t.parent().find(".pga-ex-row[data-parent^="+t.attr("data-ex-id")+"]").addClass("d-none"),t.attr("data-collapsed","true"))})),f}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";(function(t){n(28),n(41);var i=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var r=a(n(14)).default.Model.extend({defaults:{JIT:[],Triggers:[],Summary:{}},set_statistics:function(e){var n=this.get("JIT"),a=this.get("Triggers"),r=this.get("Summary");(Object.keys(n).length>0||Object.keys(a).length>0||Object.keys(r).length>0)&&(0,i.default)(".pg-explain-stats-area").removeClass("d-none");var o=(0,i.default)("<table></table>",{class:"pgadmin-tooltip-table"});Object.keys(n).length>0&&(o.append('<tr><td class="label explain-tooltip">JIT:</td></tr>'),t.each(n,(function(e,n){n=t.escape(n),e=t.escape(e),o.append('\n          <tr>\n            <td class="label explain-tooltip">  '.concat(n,'</td>\n            <td class="label explain-tooltip-val">').concat(e,"</td>\n          </tr>\n        "))}))),Object.keys(a).length>0&&(o.append('<tr><td class="label explain-tooltip">Triggers:</td></tr>'),t.each(a,(function(e,n){e instanceof Object?t.each(e,(function(e,n){"Trigger Name"===n?(n=t.escape(n),e=t.escape(e),o.append('\n                <tr>\n                  <td class="label explain-tooltip">  '.concat(n,'</td>\n                  <td class="label explain-tooltip-val">').concat(e,"</td>\n                </tr>\n              "))):(n=t.escape(n),e=t.escape(e),o.append('\n                <tr>\n                  <td class="label explain-tooltip">    '.concat(n,'</td>\n                  <td class="label explain-tooltip-val">').concat(e,"</td>\n                </tr>\n              ")))})):(n=t.escape(n),e=t.escape(e),o.append('\n            <tr>\n              <td class="label explain-tooltip">  '.concat(n,'</td>\n              <td class="label explain-tooltip-val">').concat(e,"</td>\n            </tr>\n          ")))}))),Object.keys(r).length>0&&(o.append('<tr><td class="label explain-tooltip">Summary:</td></tr>'),t.each(r,(function(e,n){n=t.escape(n),e=t.escape(e),o.append('\n          <tr>\n            <td class="label explain-tooltip">  '.concat(n,'</td>\n            <td class="label explain-tooltip-val">').concat(e,"</td>\n          </tr>\n        "))}))),(0,i.default)(".pg-explain-stats-area").off("mouseover").on("mouseover",(function(){0==Object.keys(n).length&&0==Object.keys(a).length&&0==Object.keys(r).length||(e.empty(),e.append(o),e.css({opacity:"0.8",left:"",right:"65px",top:"15px"}),(0,i.default)(".pgadmin-explain-tooltip").css("padding","5px"),(0,i.default)(".pgadmin-explain-tooltip").css("border","1px solid white"))})),(0,i.default)(".pg-explain-stats-area").off("mouseout").on("mouseout",(function(){e.empty(),e.css({opacity:"0",left:0,top:0,right:""})}))}});e.exports=r}).call(this,n(1))},function(e,t,n){"use strict";n(17),n(4),n(12),n(5),n(23),n(9),n(20),n(200),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={blobURL:function(e,t){var n=new Blob([e],{type:t});return(window.URL||window.webkitURL).createObjectURL(n)},downloadSVG:function(e,t){e=e.replace(/NS\d+:href/gi,"xlink:href");var n=this.blobURL(e,"image/svg+xml"),i=document.createElement("a");i.href=n,i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i)}};t.default=i},function(e,t,n){"use strict";n(4),n(74),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={Aggregate:{image:"ex_aggregate.svg",image_text:"Aggregate"},Append:{image:"ex_append.svg",image_text:"Append"},"Bitmap Index Scan":function(e){return{image:"ex_bmp_index.svg",image_text:e["Index Name"]}},"Bitmap Heap Scan":function(e){return{image:"ex_bmp_heap.svg",image_text:e["Relation Name"]}},BitmapAnd:{image:"ex_bmp_and.svg",image_text:"Bitmap AND"},BitmapOr:{image:"ex_bmp_or.svg",image_text:"Bitmap OR"},"CTE Scan":{image:"ex_cte_scan.svg",image_text:"CTE Scan"},"Function Scan":{image:"ex_result.svg",image_text:"Function Scan"},"Foreign Scan":{image:"ex_foreign_scan.svg",image_text:"Foreign Scan"},Gather:{image:"ex_gather_motion.svg",image_text:"Gather"},"Gather Merge":{image:"ex_gather_merge.svg",image_text:"Gather Merge"},Group:{image:"ex_group.svg",image_text:"Group"},GroupAggregate:{image:"ex_aggregate.svg",image_text:"Group Aggregate"},Hash:{image:"ex_hash.svg",image_text:"Hash"},"Hash Join":function(e){if(!e["Join Type"])return{image:"ex_join.svg",image_text:"Join"};switch(e["Join Type"]){case"Anti":return{image:"ex_hash_anti_join.svg",image_text:"Hash Anti Join"};case"Semi":return{image:"ex_hash_semi_join.svg",image_text:"Hash Semi Join"};default:return{image:"ex_hash.svg",image_text:String("Hash "+e["Join Type"]+" Join")}}},HashAggregate:{image:"ex_aggregate.svg",image_text:"Hash Aggregate"},"Index Only Scan":function(e){return{image:"ex_index_only_scan.svg",image_text:e["Index Name"]}},"Index Scan":function(e){return{image:"ex_index_scan.svg",image_text:e["Index Name"]}},"Index Scan Backword":{image:"ex_index_scan.svg",image_text:"Index Backward Scan"},Limit:{image:"ex_limit.svg",image_text:"Limit"},LockRows:{image:"ex_lock_rows.svg",image_text:"Lock Rows"},Materialize:{image:"ex_materialize.svg",image_text:"Materialize"},"Merge Append":{image:"ex_merge_append.svg",image_text:"Merge Append"},"Merge Join":function(e){switch(e["Join Type"]){case"Anti":return{image:"ex_merge_anti_join.svg",image_text:"Merge Anti Join"};case"Semi":return{image:"ex_merge_semi_join.svg",image_text:"Merge Semi Join"};default:return{image:"ex_merge.svg",image_text:String("Merge "+e["Join Type"]+" Join")}}},ModifyTable:function(e){switch(e.Operation){case"Insert":return{image:"ex_insert.svg",image_text:"Insert"};case"Update":return{image:"ex_update.svg",image_text:"Update"};case"Delete":return{image:"ex_delete.svg",image_text:"Delete"}}},"Named Tuplestore Scan":{image:"ex_named_tuplestore_scan.svg",image_text:"Named Tuplestore Scan"},"Nested Loop":function(e){switch(e["Join Type"]){case"Anti":return{image:"ex_nested_loop_anti_join.svg",image_text:"Nested Loop Anti Join"};case"Semi":return{image:"ex_nested_loop_semi_join.svg",image_text:"Nested Loop Semi Join"};default:return{image:"ex_nested.svg",image_text:"Nested Loop "+e["Join Type"]+" Join"}}},ProjectSet:{image:"ex_projectset.svg",image_text:"ProjectSet"},"Recursive Union":{image:"ex_recursive_union.svg",image_text:"Recursive Union"},Result:{image:"ex_result.svg",image_text:"Result"},"Sample Scan":{image:"ex_scan.svg",image_text:"Sample Scan"},Scan:{image:"ex_scan.svg",image_text:"Scan"},Seek:{image:"ex_seek.svg",image_text:"Seek"},SetOp:function(e){var t=e.Strategy,n=e.Command;return"Hashed"==t?n.startsWith("Intersect")?"Intersect All"==n?{image:"ex_hash_setop_intersect_all.svg",image_text:"Hashed Intersect All"}:{image:"ex_hash_setop_intersect.svg",image_text:"Hashed Intersect"}:n.startsWith("Except")?"Except All"==n?{image:"ex_hash_setop_except_all.svg",image_text:"Hashed Except All"}:{image:"ex_hash_setop_except.svg",image_text:"Hash Except"}:{image:"ex_hash_setop_unknown.svg",image_text:"Hashed SetOp Unknown"}:{image:"ex_setop.svg",image_text:"SetOp"}},"Seq Scan":function(e){return{image:"ex_scan.svg",image_text:e["Relation Name"]}},"Subquery Scan":{image:"ex_subplan.svg",image_text:"SubQuery Scan"},Sort:{image:"ex_sort.svg",image_text:"Sort"},"Tid Scan":{image:"ex_tid_scan.svg",image_text:"Tid Scan"},"Table Function Scan":{image:"ex_table_func_scan.svg",image_text:"Table Function Scan"},Unique:{image:"ex_unique.svg",image_text:"Unique"},"Values Scan":{image:"ex_values_scan.svg",image_text:"Values Scan"},WindowAgg:{image:"ex_window_aggregate.svg",image_text:"Window Aggregate"},"WorkTable Scan":{image:"ex_worktable_scan.svg",image_text:"WorkTable Scan"},Undefined:{image:"ex_unknown.svg",image_text:"Undefined"}};t.default=i},function(e,t,n){"use strict";var i,a;n(15),n(11),i=[n(0),n(2),n(163),n(288),n(54),n(6)],void 0===(a=function(e,t,n,i,a,r){return function(o){var s=window.Slick,l=new i(o),d=new n(o),c=new s.Event,u=new s.Event,f=d.onBeforeColumnSelectAll,p=d.onColumnSelectAll;function h(t){a.isEntireGridSelected(t)?e("[data-id='select-all']").addClass("selected"):e("[data-id='select-all']").removeClass("selected")}e.extend(this,{init:function(t){this.grid=t,t.onHeaderClick.subscribe((function(n,i){i.column.selectAllOnClick&&!e(n.target).hasClass("slick-resizable-handle")&&function(e,t,n){a.isEntireGridSelected(e)?function(e){e.getSelectionModel().setSelectedRanges([])}(e):(c.notify(n,t),t.isPropagationStopped()||t.isImmediatePropagationStopped()||a.selectAll(e))}(t,n,i)})),t.getSelectionModel().onSelectedRangesChanged.subscribe(h.bind(null,t)),t.registerPlugin(l),t.registerPlugin(d),u.subscribe((function(e,t){a.selectAll(t.grid)}))},getColumnDefinitions:function(e){return e=d.getColumnDefinitions(e),(e=l.getColumnDefinitions(e))[0].selectAllOnClick=!0,e[0].name='<span data-id="select-all" title="'+t("Select/Deselect All")+'"><br>'+e[0].name+'<img class="select-all-icon" src="'+r("static",{filename:"img/select-all-icon.png"})+'"></img>',e},onBeforeGridSelectAll:c,onGridSelectAll:u,onBeforeGridColumnSelectAll:f,onGridColumnSelectAll:p})}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;n(8),n(15),n(35),i=[n(0),n(54),n(163),n(92)],void 0===(a=function(e,t,n){return function(){var i=new window.Slick.EventHandler,a=new n,r=function(t,n,i){if("row-header-column"===t.getColumns()[i.cell].id){var r=e(n.target);"row-header-selector"!=r.data("cell-type")&&(r=e(n.target).find('[data-cell-type="row-header-selector"]')),r.parent().toggleClass("selected"),s(t,i.row),a.toggleColumnHeaderForCopyHeader(t)}},o=function(t,n,i){e('[data-cell-type="row-header-selector"]').each((function(n,a){var r=e(a),o=parseInt(r.data("row"));l(t,i,o)?r.parent().addClass("selected"):r.parent().removeClass("selected")}))},s=function(e,n){var i,a=e.getSelectionModel(),r=a.getSelectedRanges(),o=t.rangeForRow(e,n);i=t.isRangeSelected(r,o)?t.removeRange(r,o):t.areAllRangesSingleRows(r,e)?t.addRange(r,o):[o],a.setSelectedRanges(i)},l=function(e,n,i){var a=t.areAllRangesCompleteColumns(e,n);return function(e,n,i){var a=t.isRangeEntirelyWithinSelectedRanges(n,t.rangeForRow(e,i)),r=t.isAnyCellOfRowSelected(n,i);return a||r}(e,n,i)&&!a};e.extend(this,{init:function(e){e.getSelectionModel().onSelectedRangesChanged.subscribe(o.bind(null,e)),i.subscribe(e.onClick,r.bind(null,e))},getColumnDefinitions:function(e){return e.unshift({id:"row-header-column",name:"",selectable:!1,focusable:!1,formatter:function(e){return'<span data-row="'+e+'" data-cell-type="row-header-selector">'+(e+1)+"</span>"},width:30}),e}})}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;i=[n(0),n(54)],void 0===(a=function(e,t){return function(){var n,i=39,a=37,r=38,o=40,s=!1,l=!1,d=!1;function c(e,t){s=!0,n.setActiveCell(t.range.start.row,t.range.start.cell)}function u(i,a){if(d&&l)return l=!1,void i.stopPropagation();if(!e(i.target).hasClass("slick-resizable-handle")){s=!0;var r=a.column.pos+1;b(0,r)?v()?n.resetActiveCell():n.setActiveCell(0,y().fromCell):function(e){var i=t.rangeForColumn(n,e),a=n.getSelectionModel().getSelectedRanges();return t.isRangeSelected(a,i)}(r)||n.setActiveCell(0,r)}}function f(){d=!1}function p(){d=!0,l=!1}function h(){l=!0}function _(e,i){if(r=i.cell,"row-header-column"===n.getColumns()[r].id){s=!0;var a=i.row;if(a>=n.getDataLength())return;b(a,1)?v()?n.resetActiveCell():n.setActiveCell(y().fromRow,1):function(e){var i=t.rangeForRow(n,e),a=n.getSelectionModel().getSelectedRanges();return t.isRangeSelected(a,i)}(a)||n.setActiveCell(a,1)}var r}function g(e){s&&(s=!1,e.stopPropagation())}function m(e){var t,s;w()&&function(e){return function(e){return e.shiftKey&&!e.ctrlKey&&!e.altKey}(e)&&function(e){return e.which===i||e.which===r||e.which===a||e.which===o}(e)}(e)&&(t=n.getSelectionModel(),(s=t.getSelectedRanges()).length>1&&t.setSelectedRanges([s.pop()]))}function b(e,t){return w()&&n.getActiveCell().row===e&&n.getActiveCell().cell===t}function v(){return 1===n.getSelectionModel().getSelectedRanges().length}function y(){var e=n.getSelectionModel().getSelectedRanges();return e[e.length-2]}function w(){return!!n.getActiveCell()}e.extend(this,{init:function(e){(n=e).onDragEnd.subscribe(c),n.onHeaderClick.subscribe(u),n.onClick.subscribe(_),n.onActiveCellChanged.subscribe(g),n.onKeyDown.subscribe(m),n.onHeaderMouseEnter.subscribe(p),n.onHeaderMouseLeave.subscribe(f),n.onColumnsResized.subscribe(h)},destroy:function(){n.onDragEnd.unsubscribe(c),n.onHeaderClick.unsubscribe(u),n.onActiveCellChanged.unsubscribe(g),n.onKeyDown.unsubscribe(m),n.onHeaderMouseEnter.unsubscribe(p),n.onHeaderMouseLeave.unsubscribe(f),n.onColumnsResized.unsubscribe(h)}})}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";(function(i){var a,r;n(42),n(21),n(34),n(91),n(32),n(15),n(12),n(43),n(50),a=[n(54),n(291)],void 0===(r=function(e,t){return{getUnion:function(e){if(i.isEmpty(e))return[];e.sort((function(e,t){return e[0]-t[0]}));var t=[e[0]];return e.forEach((function(e){var n=i.last(t);!function(e,t){return e[0]<=t[1]+1}(e,n)?t.push(e):function(e,t){return e[1]<=t[1]}(e,n)||(n[1]=e[1])})),t},mapDimensionBoundaryUnion:function(e,t){var n=[];return e.forEach((function(e){for(var i=e[0];i<=e[1];i+=1)n.push(t(i))})),n},mapOver2DArray:function(e,t,n,i){var a=this.getUnion(e),r=this.getUnion(t);return this.mapDimensionBoundaryUnion(a,function(e){var t=this.mapDimensionBoundaryUnion(r,(function(t){return n(e,t)}));return i(t)}.bind(this))},getHeaderData:function(e,t){var n=[],a=t.field_separator||"\t",r=t.quote_char||'"';return i.each(e,(function(e){e.display_name&&e.selected&&n.push(r+e.display_name+r)})),n.join(a)},rangesToCsv:function(t,n,i,a,r){var o=i.map((function(e){return[e.fromRow,e.toRow]})),s=i.map((function(e){return[e.fromCell,e.toCell]}));e.isFirstColumnData(n)||(s=this.removeFirstColumn(s));var l=this.mapOver2DArray(o,s,this.csvCell.bind(this,t,n,a),(function(e){var t=a.field_separator||"\t";return e.join(t)}));if(r){return this.getHeaderData(n,a)+"\n"+l.join("\n")}return l.join("\n")},removeFirstColumn:function(e){var t=this.getUnion(e);if(0==t.length)return[];return 0==t[0][0]&&(0==t[0][1]?t.shift():t[0][0]=1),t},csvCell:function(e,n,a,r,o){var s=e[r][n[o].field],l=n[o].cell||"",d=a.quoting||"strings",c=a.quote_char||'"';return"all"==d?s&&i.isObject(s)?s=c+t.stringify(s)+c:s?s=c+s.toString()+c:(i.isNull(s)||i.isUndefined(s))&&(s=""):"strings"==d&&(s&&i.isObject(s)?s=c+t.stringify(s)+c:s&&"number"!=l&&"boolean"!=l?s=c+s.toString()+c:(i.isNull(s)||i.isUndefined(s))&&(s="")),s}}}.apply(t,a))||(e.exports=r)}).call(this,n(1))},,function(e,t,n){"use strict";var i,a;i=[n(0),n(1),n(54),n(33),n(92)],void 0===(a=function(e,t,n,i){return function(a){var r,o,s=39,l=37,d=38,c=40,u=window.Slick,f=[],p=this,h=new u.CellRangeSelector({selectionCss:{border:"2px solid black"},offset:{top:0,left:-1,height:2,width:1}}),_={selectActiveCell:!0};function g(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];r.canCellBeSelected(i.fromRow,i.fromCell)&&r.canCellBeSelected(i.toRow,i.toCell)&&t.push(i)}return t}function m(e){(f&&0!==f.length||e&&0!==e.length)&&(f=g(e),p.onSelectedRangesChanged.notify(f))}function b(){return f}function v(e){if(r.getEditorLock().isActive())return e.stopPropagation(),!1}function y(e,t){m([t.range])}function w(e,t){o.selectActiveCell&&null!=t.row&&null!=t.cell&&m([new u.Range(t.row,t.cell)])}function x(e){return e.shiftKey&&!e.ctrlKey&&!e.altKey&&function(e){return e.which==s||e.which==l||e.which==d||e.which==c}(e)}function C(e){var t,n,i,a,o,f,p,h,_=r.getActiveCell();function v(t){return e.which===t}if(_&&x(e)){(t=b()).length||t.push(new u.Range(_.row,_.cell)),(n=t.pop()).contains(_.row,_.cell)||(n=new u.Range(_.row,_.cell));var y=function(e,t){var n={};return n.row=e.fromRow===t.row?e.toRow:e.fromRow,n.cell=e.fromCell===t.cell?e.toCell:e.fromCell,n}(n,_);switch(e.which){case l:y.cell-=1;break;case s:y.cell+=1;break;case d:y.row-=1;break;case c:y.row+=1}var w=(a=y,o=(i=_).cell<=a.cell?i.cell:a.cell,f=i.cell<=a.cell?a.cell:i.cell,p=i.row<=a.row?i.row:a.row,h=i.row<=a.row?a.row:i.row,new u.Range(p,o,h,f));if(g([w]).length){var C=_.row===w.fromRow?w.toRow:w.fromRow,S=_.cell===w.fromCell?w.toCell:w.fromCell;v(s)||v(l)?r.scrollColumnIntoView(S):(v(d)||v(c))&&r.scrollRowIntoView(C),t.push(w)}else t.push(n);m(t),e.preventDefault(),e.stopPropagation()}}function S(){var e=h.getCurrentRange();t.isUndefined(e)||r.onDragEnd.notify({range:e})}e.extend(this,{getSelectedRanges:b,setSelectedRanges:m,setSelectedRows:function(e){f=[];for(var t=0;t<e.length;t++)f.push(n.rangeForRow(r,e[t]))},init:function(t){o=e.extend(!0,{},_,a),(r=t).onActiveCellChanged.subscribe(w),r.onKeyDown.subscribe(C),t.registerPlugin(h),h.onCellRangeSelected.subscribe(y),h.onBeforeCellRangeSelected.subscribe(v),e(i.default).on("mouseup",S)},destroy:function(){r.onActiveCellChanged.unsubscribe(w),r.onKeyDown.unsubscribe(C),h.onCellRangeSelected.unsubscribe(y),h.onBeforeCellRangeSelected.unsubscribe(v),r.unregisterPlugin(h),e(i.default).off("mouseup",S)},onSelectedRangesChanged:new u.Event})}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;n(8),n(17),n(355),n(12),n(20),i=[n(0),n(1),n(54)],void 0===(a=function(e,t,n){function i(t){e(t).prop("disabled",!0)}function a(t){e(t).prop("disabled",!1)}function r(e,n,i,a){return t.reduce(e,(function(e,r){var o=i.getItem(r);return function(e,n){if(t.isUndefined(e))return!0;return!t.isUndefined(t.find(n,(function(n){return t.isUndefined(e[n])})))}(o,n)?e:(e[o[a]]=function(e,n){var i={};e&&e.length&&t.each(t.keys(n),(function(a){t.contains(e,a)&&(i[a]=n[a])}));return i}(n,o),e)}),{})}return function(){var e=this;function o(t){e.editor.handler.data_store.staged_rows=t}if(i("#btn-delete-row"),i("#btn-copy-row"),this.selection.getSelectedRanges().length>0&&a("#btn-copy-row"),n.areAllRangesCompleteRows(e.grid,e.selection.getSelectedRanges())){var s=n.getIndexesOfCompleteRows(this.grid,this.selection.getSelectedRanges()),l=function(e,n){var i=e.grid.getData();return r(n,t.keys(e.keys),i,e.client_primary_key)}(e,s);o(l),t.isEmpty(l)&&this.selection.setSelectedRows([]),e.editor.handler.can_edit&&!t.isEmpty(l)&&a("#btn-delete-row")}else o({})}}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";(function(t){n(19),n(26),n(27),n(17),n(32),n(4),n(31),n(12),n(23),n(44),n(20),n(7);var i=u(n(2)),a=u(n(0)),r=u(n(6)),o=u(n(66)),s=c(n(111)),l=c(n(164));function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==f(e)&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=i?Object.getOwnPropertyDescriptor(e,a):null;r&&(r.get||r.set)?Object.defineProperty(n,a,r):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}function u(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}var g=function(){function e(t){p(this,e),this.sqlEditor=t}return _(e,[{key:"setMessage",value:function(e){this.sqlEditor.trigger("pgadmin-sqleditor:loading-icon:message",(0,i.default)(e))}},{key:"show",value:function(e){this.sqlEditor.trigger("pgadmin-sqleditor:loading-icon:show",e)}},{key:"hide",value:function(){this.sqlEditor.trigger("pgadmin-sqleditor:loading-icon:hide")}}]),e}(),m=function(){function e(t,n){p(this,e),this.sqlServerObject=t,this.loadingScreen=new g(t),this.userManagement=n}return _(e,[{key:"delayedPoll",value:function(){var e=this;setTimeout((function(){e.poll()}),e.sqlServerObject.POLL_FALLBACK_TIME())}},{key:"execute",value:function(t,n,i){if(!(t.length<=0)){var a=this;a.explainPlan=n;var r=e.prepareAnalyzeSql(t,n);a.initializeExecutionOnSqlEditor(r),o.default.post(this.generateURLReconnectionFlag(i),JSON.stringify(r),{headers:{"Content-Type":"application/json"}}).then((function(t){var n=t.data;a.removeGridViewMarker(),a.updateSqlEditorLastTransactionStatus(n.data.transaction_status),e.isSqlCorrect(n)?(a.loadingScreen.setMessage("Waiting for the query to complete..."),a.updateSqlEditorStateWithInformationFromServer(n.data),a.delayedPoll()):(a.loadingScreen.hide(),a.enableSQLEditorButtons(),t.data.data.transaction_status==l.TRANSACTION_STATUS_INTRANS||t.data.data.transaction_status==l.TRANSACTION_STATUS_INERROR?a.enableTransactionButtons():a.disableTransactionButtons(),a.sqlServerObject.update_msg_history(!1,n.data.result),"notifies"in n.data&&a.sqlServerObject.update_notifications(n.data.notifies),a.sqlServerObject._highlight_error(n.data.result))})).catch((function(e){a.onExecuteHTTPError(e)}))}}},{key:"generateURLReconnectionFlag",value:function(e){var t=(0,r.default)("sqleditor.query_tool_start",{trans_id:this.sqlServerObject.transId});return e&&(t+="?connect=1"),t}},{key:"poll",value:function(){var t=this,n=this;o.default.get((0,r.default)("sqleditor.poll",{trans_id:n.sqlServerObject.transId})).then((function(i){n.updateSqlEditorLastTransactionStatus(i.data.data.transaction_status),i.data.data.transaction_status==l.TRANSACTION_STATUS_INTRANS||i.data.data.transaction_status==l.TRANSACTION_STATUS_INERROR?n.enableTransactionButtons():n.disableTransactionButtons(),e.isQueryFinished(i)?(t.sqlServerObject.close_on_idle_transaction&&i.data.data.transaction_status==l.TRANSACTION_STATUS_IDLE&&t.sqlServerObject.check_needed_confirmations_before_closing_panel(),n.loadingScreen.setMessage("Loading data from the database server and rendering..."),n.sqlServerObject.call_render_after_poll(i.data.data),"notifies"in i.data.data&&n.sqlServerObject.update_notifications(i.data.data.notifies)):e.isQueryStillRunning(i)?(t.delayedPoll(),n.sqlServerObject.setIsQueryRunning(!0),i.data.data.result&&n.sqlServerObject.update_msg_history(i.data.data.status,i.data.data.result,!1)):e.isConnectionToServerLostWhilePolling(i)?(n.loadingScreen.hide(),n.sqlServerObject.is_query_tool&&n.enableSQLEditorButtons(),n.sqlServerObject.update_msg_history(!1,i.data.data.result,!0)):e.isQueryCancelled(i)&&(n.loadingScreen.hide(),n.sqlServerObject.update_msg_history(!1,"Execution Cancelled!",!0))})).catch((function(t){if(n.sqlServerObject.resetQueryHistoryObject(n.sqlServerObject),n.loadingScreen.hide(),n.sqlServerObject.setIsQueryRunning(!1),n.sqlServerObject.is_query_tool&&n.enableSQLEditorButtons(),t.response){if(e.wasConnectionLostToPythonServer(t.response))return void n.handleConnectionToServerLost();var i=t.response.data;if(n.userManagement.isPgaLoginRequired(i))return n.userManagement.pgaLogin();var a=e.extractErrorMessage(i);n.sqlServerObject.update_msg_history(!1,a),n.sqlServerObject._highlight_error(a)}else{if(t.request)return void n.handleConnectionToServerLost();console.error(t)}}))}},{key:"initializeExecutionOnSqlEditor",value:function(e){this.loadingScreen.show("Running query..."),(0,a.default)("#btn-flash").prop("disabled",!0),(0,a.default)("#btn-download").prop("disabled",!0),this.sqlServerObject.query_start_time=new Date,"object"===f(e)?this.sqlServerObject.query=e.sql:this.sqlServerObject.query=e,this.sqlServerObject.rows_affected=0,this.sqlServerObject._init_polling_flags(),this.disableSQLEditorButtons(),this.disableTransactionButtons()}},{key:"onExecuteHTTPError",value:function(t){if(this.loadingScreen.hide(),this.enableSQLEditorButtons(),e.wasConnectionLostToPythonServer(t.response))this.handleConnectionToServerLost();else{if(this.userManagement.isPgaLoginRequired(t.response)&&(this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),this.userManagement.pgaLogin()),s.httpResponseRequiresNewTransaction(t.response)&&(this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),this.sqlServerObject.initTransaction()),this.wasDatabaseConnectionLost(t)&&(this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),this.sqlServerObject.handle_connection_lost(!1,t)),this.isCryptKeyMissing(t))return this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),void this.sqlServerObject.handle_cryptkey_missing();var n=t.response.data.errormsg;this.sqlServerObject.update_msg_history(!1,n)}}},{key:"wasDatabaseConnectionLost",value:function(e){return 503===e.response.status&&void 0!==e.response.data.info&&"CONNECTION_LOST"===e.response.data.info}},{key:"isCryptKeyMissing",value:function(e){return 503===e.response.status&&void 0!==e.response.data.info&&"CRYPTKEY_MISSING"===e.response.data.info}},{key:"removeGridViewMarker",value:function(){this.sqlServerObject.gridView.marker&&(this.sqlServerObject.gridView.marker.clear(),delete this.sqlServerObject.gridView.marker,this.sqlServerObject.gridView.marker=null,this.sqlServerObject.gridView.query_tool_obj.removeLineClass(this.sqlServerObject.marked_line_no,"wrap","CodeMirror-activeline-background"))}},{key:"enableSQLEditorButtons",value:function(){this.sqlServerObject.disable_tool_buttons(!1)}},{key:"disableSQLEditorButtons",value:function(){this.sqlServerObject.disable_tool_buttons(!0)}},{key:"enableTransactionButtons",value:function(){this.sqlServerObject.disable_transaction_buttons(!1)}},{key:"disableTransactionButtons",value:function(){this.sqlServerObject.special_sql=void 0,this.sqlServerObject.disable_transaction_buttons(!0)}},{key:"handleConnectionToServerLost",value:function(){this.sqlServerObject.update_msg_history(!1,(0,i.default)("Not connected to the server or the connection to the server has been closed."))}},{key:"updateSqlEditorStateWithInformationFromServer",value:function(e){this.sqlServerObject.can_edit=e.can_edit,this.sqlServerObject.can_filter=e.can_filter,this.sqlServerObject.info_notifier_timeout=e.info_notifier_timeout}},{key:"updateSqlEditorLastTransactionStatus",value:function(e){this.sqlServerObject.last_transaction_status=e}}],[{key:"prepareAnalyzeSql",value:function(e,t){return{sql:e,explain_plan:t}}},{key:"wasConnectionLostToPythonServer",value:function(e){return t.isUndefined(e)||t.isUndefined(e.data)}},{key:"isSqlCorrect",value:function(e){return e.data.status}},{key:"extractErrorMessage",value:function(e){var t=e.errormsg;return void 0!==e.responseJSON&&void 0!==e.responseJSON.errormsg&&(t=e.responseJSON.errormsg),t}},{key:"isQueryFinished",value:function(e){return"Success"===e.data.data.status}},{key:"isQueryStillRunning",value:function(e){return"Busy"===e.data.data.status}},{key:"isQueryCancelled",value:function(e){return"Cancel"===e.data.data.status}},{key:"isConnectionToServerLostWhilePolling",value:function(e){return"NotConnected"===e.data.data.status}}]),e}();e.exports={ExecuteQuery:m}}).call(this,n(1))},function(e,t,n){"use strict";n(8),n(36),n(11),n(7),n(37);var i=f(n(2)),a=f(n(6)),r=f(n(0)),o=f(n(13)),s=f(n(3)),l=f(n(18)),d=f(n(66)),c=f(n(296)),u=n(111);function f(e){return e&&e.__esModule?e:{default:e}}var p=n(165),h={geturl:function(e,t){var n=(0,a.default)("sqleditor.get_filter_data",{trans_id:e});return t&&(n+="?connect=1"),n},dialog:function(e,t){var n=(0,i.default)("Sort/Filter options");r.default.ajax({url:this.geturl(e.transId,t),headers:{"Cache-Control":"no-cache"}}).done((function(t){var u=t.data.result;o.default.filterDialog&&delete o.default.filterDialog,o.default.dialog("filterDialog",(function(){var t=(0,r.default)("<div class='data_sorting_dialog'></div>");return{main:function(){this.set("title",(0,i.default)("Sort/Filter options"))},build:function(){this.elements.content.appendChild(t.get(0)),o.default.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-secondary pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:(0,i.default)("Help"),"aria-label":(0,i.default)("Help"),url:(0,a.default)("help.static",{filename:"editgrid.html"})}},{text:(0,i.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button","data-btn-name":"cancel"},{text:(0,i.default)("OK"),className:"btn btn-primary fa fa-check pg-alertify-button","data-btn-name":"ok"}],options:{title:n,padding:!1,overflow:!1,model:0,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,modal:!1,autoReset:!1}}},hooks:{onclose:function(){this.view&&(this.filterCollectionModel.stopSession(),this.view.model.stopSession(),this.view.remove({data:!0,internal:!0,silent:!0}))}},prepare:function(){var e=this;t.html(""),this.__internal.buttons[2].element.disabled=!0,this.statusBar=(0,r.default)('<div class=\'pg-prop-status-bar pg-el-xs-12 d-none\'>  <div class="error-in-footer">     <div class="d-flex px-2 py-1">       <div class="pr-2">         <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>       </div>       <div class="alert-text" role="alert"></div>     </div>   </div> </div>').appendTo(t),this.showFilterProgress=(0,r.default)('<div id="show_filter_progress" class="pg-sp-container sql-editor-busy-fetching d-none">\n                  <div class="pg-sp-content">\n                      <div class="row"><div class="col-12 pg-sp-icon sql-editor-busy-icon"></div></div>\n                      <div class="row"><div class="col-12 pg-sp-text sql-editor-busy-text">'.concat((0,i.default)("Loading data..."),"</div></div>\n                  </div>\n              </div>")).appendTo(t),(0,r.default)(e.showFilterProgress[0]).removeClass("d-none"),e.filterCollectionModel=(0,c.default)(u);var n=l.default.generateViewSchema(null,e.filterCollectionModel,"create",null,null,!0),a=this.view=new l.default.Dialog({el:"<div></div>",model:e.filterCollectionModel,schema:n});(0,r.default)(this.elements.body.childNodes[0]).addClass("alertify_tools_dialog_properties obj_properties"),t.append(a.render().$el),a.listenTo(a.model,"pgadmin-session:start",(function(){a.listenTo(a.model,"pgadmin-session:invalid",(function(t){e.statusBar.removeClass("d-none"),(0,r.default)(e.statusBar.find(".alert-text")).html(t),e.__internal.buttons[2].element.disabled=!0})),a.listenTo(a.model,"pgadmin-session:valid",(function(){e.statusBar.addClass("d-none"),(0,r.default)(e.statusBar.find(".alert-text")).html(""),e.__internal.buttons[2].element.disabled=!1}))})),a.listenTo(a.model,"pgadmin-session:stop",(function(){a.stopListening(a.model,"pgadmin-session:invalid"),a.stopListening(a.model,"pgadmin-session:valid")})),a.model.startNewSession(),a.model.get("data_sorting").add(u.data_sorting),(0,r.default)(e.showFilterProgress[0]).addClass("d-none")},callback:function(t){var n=this;if("dialog_help"==t.button.element.name)return t.cancel=!0,void s.default.Browser.showHelp(t.button.element.name,t.button.element.getAttribute("url"),null,null);if("ok"===t.button["data-btn-name"]){t.cancel=!0;var l=this.filterCollectionModel.toJSON();(0,r.default)(n.showFilterProgress[0]).removeClass("d-none"),d.default.put((0,a.default)("sqleditor.set_filter_data",{trans_id:e.transId}),l).then((function(t){(0,r.default)(n.showFilterProgress[0]).addClass("d-none");var a=t.data.data;a.status?setTimeout((function(){n.close(),o.default.success((0,i.default)("Filter updated successfully")),p.executeQuery(e)}),10):o.default.alert((0,i.default)("Validation Error"),a.result)})).catch((function(t){(0,r.default)(n.showFilterProgress[0]).addClass("d-none"),e.onExecuteHTTPError(t),setTimeout((function(){o.default.error(t)}),10)}))}else n.close()}}})),o.default.filterDialog(n).resizeTo(s.default.Browser.stdW.md,s.default.Browser.stdH.md)})).fail((function(t){(0,u.handleQueryToolAjaxError)(s.default,e,t,"_show_filter",[],!0)}))}};e.exports=h},function(e,t,n){"use strict";n(34),n(4),n(5),n(9),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={asc:(0,i.default)("ASC"),desc:(0,i.default)("DESC")},n=r.default.Browser.DataModel.extend({idAttribute:"name",defaults:{name:void 0,order:"asc"},schema:[{id:"name",name:"name",label:(0,i.default)("Column"),cell:"select2",editable:!0,cellHeaderClasses:"width_percent_60",headerCell:o.default.Extension.CustomHeaderCell,disabled:!1,control:"select2",select2:{allowClear:!1},options:function(){return a.default.map(e.column_list,(function(e){return{value:e,label:e}}))}},{id:"order",name:"order",label:(0,i.default)("Order"),control:"select2",cell:"select2",cellHeaderClasses:"width_percent_40",headerCell:o.default.Extension.CustomHeaderCell,editable:!0,deps:["type"],select2:{allowClear:!1},options:function(){return a.default.map(t,(function(e,t){return{value:t,label:e}}))}}],validate:function(){var e=null;return this.errorModel.clear(),a.default.isUndefined(this.get("name"))||a.default.isNull(this.get("name"))||""==String(this.get("name")).replace(/^\s+|\s+$/g,"")?(e=(0,i.default)("Please select a column."),this.errorModel.set("name",e),e):a.default.isUndefined(this.get("order"))||a.default.isNull(this.get("order"))||""==String(this.get("order")).replace(/^\s+|\s+$/g,"")?(e=(0,i.default)("Please select the order."),this.errorModel.set("order",e),e):null}});return new(r.default.Browser.DataModel.extend({idAttribute:"sql",defaults:{sql:e.sql||null},schema:[{id:"sql",label:(0,i.default)("SQL Filter"),cell:"string",type:"text",mode:["create"],control:s.default.SqlFieldControl.extend({render:function(){var e=s.default.SqlFieldControl.prototype.render.apply(this,arguments);return setTimeout((function(){e.sqlCtrl.focus()}),1e3),e}}),extraClasses:["custom_height_css_class"]},{id:"data_sorting",name:"data_sorting",label:(0,i.default)("Data Sorting"),model:n,editable:!0,type:"collection",mode:["create"],control:"unique-col-collection",uniqueCol:["name"],canAdd:!0,canEdit:!1,canDelete:!0,visible:!0,version_compatible:!0}],validate:function(){return null}}))};var i=l(n(2)),a=l(n(1)),r=l(n(3)),o=l(n(30)),s=l(n(18));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";(function(t){n(161),n(16),n(17),n(21),n(34),n(356),n(357),n(12),n(35),n(23),n(20),n(7);var i=o(n(2)),a=n(307),r=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}var s=null,l=null,d={panel_closed:!0,go_for_render:function(e,n,i,a){var o=this;if(o.map_component||(o.map_component=function(){var e={radius:4,weight:3},n={closeButton:!1,minWidth:260,maxWidth:300,maxHeight:300},i=(0,r.default)('<div class="geometry-viewer-container"></div>'),a=s.map(i.get(0),{preferCanvas:!0}).setZoom(0);a.attributionControl.setPrefix("");var o=s.geoJSON([],{style:{weight:2},pointToLayer:function(t,n){return s.circleMarker(n,e)}});o.addTo(a);var l={Empty:s.tileLayer(""),Street:s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>'}),Topography:s.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://viewfinderpanoramas.org" target="_blank">SRTM</a>, &copy; <a href="https://opentopomap.org" target="_blank">OpenTopoMap</a>'}),"Gray Style":s.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19}),"Light Color":s.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19}),"Dark Matter":s.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19})},d=s.control.layers(l),c=l.Street,u=t.values(l),f=s.control({position:"topright"});f.onAdd=function(){return this._div=s.DomUtil.create("div","geometry-viewer-info-control"),this._div},f.update=function(e){this._div.innerHTML=e};var p=function(){a.options.crs!==s.CRS.EPSG3857&&(a.options.crs=s.CRS.EPSG3857,d.addTo(a),a.addLayer(c),i.addClass("geometry-viewer-container-plain-background"),a.setMinZoom(0))},h=function(){a.options.crs!==s.CRS.Simple&&(a.options.crs=s.CRS.Simple,d.remove(),t.each(u,(function(e){a.hasLayer(e)&&(c=e,e.remove())})),i.removeClass("geometry-viewer-container-plain-background"))};return h(),p(),{mapContainer:i,clearMap:function(){a.closePopup(),f.remove(),o.clearLayers()},loseFocus:function(){a.fire("blur")},renderMap:function(e){var t=e.geoJSONs,i=e.selectedSRID,r=e.getPopupContent,l=e.infoList,c=!1;0===t.length&&(c=!0);try{o.addData(t)}catch(e){l.push("An error occurred while rendering data."),c=!0}var u=o.getBounds();if(u.isValid()||(c=!0),l.length>0){a.options.crs===s.CRS.EPSG3857?(d.remove(),f.addTo(a),d.addTo(a)):f.addTo(a);var _=function(e){return e.join("<br>")}(l);f.update(_)}if(c)return h(),void a.setView([0,0],a.getZoom());if("function"==typeof r){o.eachLayer((function(e){e.bindPopup((function(){return r(e.feature.geometry)}),n)}))}u=u.pad(.1);var g=Math.max(u.getNorth()-u.getSouth(),u.getEast()-u.getWest());if(4326===i)p();else if(h(),g>=180){var m=Math.floor(Math.log2(360/g))-2;a.setMinZoom(m)}else a.setMinZoom(0);g>0?a.fitBounds(u):a.setView(u.getCenter(),a.getZoom())},resizeMap:function(){setTimeout((function(){a.invalidateSize()}),10)}}}()),o.panel_closed){var d=window.wcDocker,u=e.gridView.geometry_viewer=e.gridView.docker.addPanel("geometry_viewer",d.DOCK.STACKED,e.gridView.data_output_panel);(0,r.default)("#geometry_viewer_panel")[0].appendChild(o.map_component.mapContainer.get(0)),o.panel_closed=!1,u.on(d.EVENT.CLOSED,(function(){(0,r.default)("#geometry_viewer_panel").empty(),o.map_component.clearMap(),o.panel_closed=!0})),u.on(d.EVENT.RESIZE_ENDED,(function(){u.isVisible()&&o.map_component.resizeMap()})),u.on(d.EVENT.VISIBILITY_CHANGED,(function(e){e?o.map_component.resizeMap():o.map_component.loseFocus()}))}e.gridView.geometry_viewer.focus(),o.map_component.clearMap();var f=c(n,i,a,l);o.map_component.renderMap(f)},render_geometries:function(e,t,i,a){var r=this;n.e(15).then(function(o){s=n(203),l=n(204).Geometry,r.go_for_render(e,t,i,a)}.bind(null,n)).catch((function(e){throw e}))},add_header_button:function(e){e.header={buttons:[{cssClass:"div-view-geometry-column",tooltip:"View all geometries in this column",showOnHover:!1,command:"view-geometries",content:'<button class="btn-xs btn-primary"><i class="fa fa-eye" aria-hidden="true"></i></button>'}]}},parse_data:c};function c(e,n,r,o){var s=n[r].field,l=[],d=[],c=[],u=[],f=new Map,p=!1,h=0,_=!1,g=!1;if(0===e.length)return u.push("Empty row."),{geoJSONs:[],selectedSRID:0,getPopupContent:void 0,infoList:u};if(t.every(e,(function(e){try{var t=e[s],n=a.Buffer.from(t,"hex"),i=o.parse(n);if(i.hasZ)l.push(i);else{if((h+=n.byteLength)>20971520)return _=!0,!1;if(d.length>=1e5)return g=!0,!1;i.srid||(i.srid=0),d.push(i),f.set(i,e)}}catch(t){c.push(e)}return!0})),(_||g)&&u.push(d.length+" of "+e.length+" geometries rendered."),l.length>0&&u.push((0,i.default)("3D geometries not rendered.")),c.length>0&&u.push((0,i.default)("Unsupported geometries not rendered.")),0===d.length)return{geoJSONs:[],selectedSRID:0,getPopupContent:void 0,infoList:u};var m=t.groupBy(d,"srid"),b=t.pairs(m);b.length>1&&(p=!0);var v,y=t.max(b,(function(e){return e[1].length})),w=parseInt(y[0]),x=y[1],C=t.map(x,(function(e){return e.toGeoJSON()}));return n.length>=3&&(v=function(e){var i=x[C.indexOf(e)];return function(e,n,i){for(var a='<table class="table table-bordered table-striped view-geometry-property-table"><tbody>',r=1;r<n.length;r++)if(r!==i){var o=n[r];a+="<tr><th>"+o.display_name+"</th>";var s=e[o.field];t.isUndefined(s)&&o.has_default_val?a+='<td class="td-disabled">[default]</td>':t.isUndefined(s)&&o.not_null||t.isUndefined(s)||null===s?a+='<td class="td-disabled">[null]</td>':a+="<td>"+s+"</td>",a+="</tr>"}return a+="</tbody></table>"}(f.get(i),n,r)}),p&&u.push((0,i.default)("Geometries with non-SRID")+w+" not rendered."),{geoJSONs:C,selectedSRID:w,getPopupContent:v,infoList:u}}e.exports=d}).call(this,n(1))},function(e,t,n){"use strict";(function(e){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n(47),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.historyList=e.sortBy(n,(function(e){return e.start_time})),this.onAdd((function(){}))}var n,a,r;return n=t,(a=[{key:"length",value:function(){return this.historyList.length}},{key:"add",value:function(t){var n=e.sortedIndex(this.historyList,t,(function(e){return e.start_time}));this.historyList.splice(n,0,t),this.onAddHandler(t)}},{key:"reset",value:function(){this.historyList=[],this.onResetHandler(this.historyList)}},{key:"onAdd",value:function(e){this.onAddHandler=e}},{key:"onReset",value:function(e){this.onResetHandler=e}}])&&i(n.prototype,a),r&&i(n,r),t}();t.default=a}).call(this,n(1))},function(e,t,n){"use strict";n(19),n(38),n(42),n(34),n(15),n(62),n(4),n(31),n(63),n(41),n(50),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=l(n(300)),a=n(301),r=l(n(358)),o=l(n(2)),s=l(n(0));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentNode=t,this.histCollection=n,this.editorPref={},this.onCopyToEditorHandler=function(){},this.histCollection.onAdd(this.onAddEntry.bind(this)),this.histCollection.onReset(this.onResetEntries.bind(this))}var t,n,l;return t=e,(n=[{key:"focus",value:function(){this.queryHistEntries&&this.queryHistEntries.focus()}},{key:"onAddEntry",value:function(e){1==this.histCollection.length()?this.render():this.queryHistEntries&&this.queryHistEntries.addEntry(e)}},{key:"onResetEntries",value:function(){this.isRendered=!1,this.queryHistEntries=null,this.queryHistDetails=null,this.render()}},{key:"onCopyToEditorClick",value:function(e){this.onCopyToEditorHandler=e,this.queryHistDetails&&this.queryHistDetails.onCopyToEditorClick(this.onCopyToEditorHandler)}},{key:"setEditorPref",value:function(e){this.editorPref=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.editorPref,{},e),this.queryHistDetails&&this.queryHistDetails.setEditorPref(this.editorPref)}},{key:"render",value:function(){var e=this;if(0==this.histCollection.length())this.parentNode.empty().removeClass("d-flex").append("<div role=\"status\" class='pg-panel-message'>".concat((0,o.default)("No history found"),"</div>"));else{this.parentNode.empty().addClass("d-flex");var t=(0,s.default)("<div><div>").appendTo(this.parentNode),n=(0,s.default)("<div><div>").appendTo(this.parentNode);(0,r.default)([t[0],n[0]],{gutterSize:1,cursor:"ew-resize"}),this.queryHistDetails=new i.default(n),this.queryHistDetails.setEditorPref(this.editorPref),this.queryHistDetails.onCopyToEditorClick(this.onCopyToEditorHandler),this.queryHistDetails.render(),this.queryHistEntries=new a.QueryHistoryEntries(t),this.queryHistEntries.onSelectedChange(function(t){e.queryHistDetails.setEntry(t)}.bind(this)),this.queryHistEntries.render(),this.histCollection.historyList.map((function(t){e.queryHistEntries.addEntry(t)}))}}}])&&u(t.prototype,n),l&&u(t,l),e}();t.default=f},function(e,t,n){"use strict";n(19),n(28),n(38),n(8),n(42),n(15),n(62),n(4),n(31),n(63),n(41),n(5),n(59),n(50),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=l(n(75)),a=l(n(98)),r=l(n(2)),o=l(n(0)),s=l(n(1));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentNode=t,this.isCopied=!1,this.timeout=null,this.isRendered=!1,this.sqlFontSize=null,this.onCopyToEditorHandler=function(){},this.editorPref={sql_font_size:"1em",copy_to_editor:!0}}var t,n,l;return t=e,(n=[{key:"setEntry",value:function(e){this.entry=e,this.isRendered?this.selectiveRender():this.render()}},{key:"setEditorPref",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.editorPref=c({},this.editorPref,{},e),this.query_codemirror&&!s.default.isUndefined(e.sql_font_size)&&((0,o.default)(this.query_codemirror.getWrapperElement()).css("font-size",this.editorPref.sql_font_size),this.query_codemirror.refresh()),this.$copyToEditor&&!s.default.isUndefined(e.copy_to_editor)&&(e.copy_to_editor?this.$copyToEditor.removeClass("d-none"):this.$copyToEditor.addClass("d-none"))}},{key:"parseErrorMessage",value:function(e){return e.match(/ERROR:\s*([^\n\r]*)/i)?e.match(/ERROR:\s*([^\n\r]*)/i)[1]:e}},{key:"formatDate",value:function(e){return e.toLocaleDateString()+" "+e.toLocaleTimeString()}},{key:"copyAllHandler",value:function(){var e=this;a.default.copyTextToClipboard(this.entry.query),this.clearPreviousTimeout(),this.updateCopyButton(!0),this.timeout=setTimeout((function(){e.updateCopyButton(!1)}),1500)}},{key:"onCopyToEditorClick",value:function(e){this.onCopyToEditorHandler=e}},{key:"clearPreviousTimeout",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}},{key:"updateCopyButton",value:function(e){e?(this.$copyBtn.addClass("was-copied").removeClass("copy-all"),this.$copyBtn.text("Copied!")):(this.$copyBtn.addClass("copy-all").removeClass("was-copied"),this.$copyBtn.text("Copy"))}},{key:"updateQueryMetaData",value:function(){var e=function(e,t){return e?"<div class='item'>\n                  <span class='value'>".concat(e,"</span>\n                  <span class='description'>").concat(t,"</span>\n              </div>"):""};this.$metaData.empty().append("<div class='metadata'>\n                ".concat(e(this.formatDate(this.entry.start_time),"Date"),"\n                ").concat(e(this.entry.row_affected.toLocaleString(),"Rows Affected"),"\n                ").concat(e(this.entry.total_time,"Duration"),"\n            </div>"))}},{key:"updateMessageContent",value:function(){this.$message_content.empty().append("<pre class='content-value'>".concat(s.default.escape(this.entry.message),"</pre>"))}},{key:"updateErrorMessage",value:function(){this.entry.status?(this.$errMsgBlock.addClass("d-none"),this.$errMsgBlock.empty()):(this.$errMsgBlock.removeClass("d-none"),this.$errMsgBlock.empty().append("<div class='history-error-text'>\n            <span>Error Message</span> ".concat(s.default.escape(this.parseErrorMessage(this.entry.message)),"\n        </div>")))}},{key:"updateInfoMessage",value:function(){this.entry.info?(this.$infoMsgBlock.removeClass("d-none"),this.$infoMsgBlock.empty().append("<div class='history-info-text'>\n            ".concat(this.entry.info,"\n        </div>"))):(this.$infoMsgBlock.addClass("d-none"),this.$infoMsgBlock.empty())}},{key:"selectiveRender",value:function(){this.updateErrorMessage(),this.updateInfoMessage(),this.updateCopyButton(!1),this.updateQueryMetaData(),this.query_codemirror.setValue(this.entry.query),this.updateMessageContent()}},{key:"render",value:function(){var e=this;this.entry&&(this.parentNode.empty().append("<div id='query_detail' class='query-detail'>\n            <div class='error-message-block'></div>\n            <div class='info-message-block'></div>\n            <div class='metadata-block'></div>\n            <div class='query-statement-block'>\n              <div id='history-detail-query'>\n                <button class='btn-copy' tabindex=0 accesskey='y'></button>\n                <button class='btn-copy-editor copy-to-editor' tabindex=0 accesskey='y'>"+(0,r.default)("Copy to Query Editor")+"</button>\n                <div></div>\n              </div>\n            </div>\n            <div>\n              <hr class='block-divider'/>\n            </div>\n            <div class='message-block'>\n              <div class='message'>\n                <div class='message-header'>Messages</div>\n                <div class='content'></div>\n              </div>\n            </div>\n        </div>"),this.$errMsgBlock=this.parentNode.find(".error-message-block"),this.$infoMsgBlock=this.parentNode.find(".info-message-block"),this.$copyBtn=this.parentNode.find("#history-detail-query .btn-copy"),this.$copyBtn.off("click").on("click",this.copyAllHandler.bind(this)),this.$copyToEditor=this.parentNode.find("#history-detail-query .btn-copy-editor"),this.$copyToEditor.off("click").on("click",(function(){e.onCopyToEditorHandler(e.entry.query)})),this.$copyToEditor.addClass(this.editorPref.copy_to_editor?"":"d-none"),this.$metaData=this.parentNode.find(".metadata-block"),this.query_codemirror=(0,i.default)(this.parentNode.find("#history-detail-query div")[0],{tabindex:-1,mode:"text/x-pgsql",readOnly:!0}),(0,o.default)(this.query_codemirror.getWrapperElement()).css("font-size",this.editorPref.sql_font_size),this.$message_content=this.parentNode.find(".message-block .content"),this.isRendered=!0,this.selectiveRender())}}])&&f(t.prototype,n),l&&f(t,l),e}();t.default=p},function(e,t,n){"use strict";n(28),n(8),n(16),n(34),n(15),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.QueryHistoryEntries=t.QueryHistoryItem=t.QueryHistoryEntryDateGroup=void 0;var i=s(n(105)),a=s(n(0)),r=s(n(1));n(178);var o=s(n(2));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}var u=function(){function e(t,n){l(this,e),this.date=t,this.formatString="MMM DD YYYY",this.groupKey=n}return c(e,[{key:"getDatePrefix",value:function(){var e="";return this.isDaysBefore(0)?e="Today - ":this.isDaysBefore(1)&&(e="Yesterday - "),e}},{key:"getDateFormatted",value:function(e){return e.toLocaleDateString()}},{key:"isDaysBefore",value:function(e){return this.getDateFormatted(this.date)===this.getDateFormatted((0,i.default)().subtract(e,"days").toDate())}},{key:"render",value:function(){return(0,a.default)("<div class='query-group' data-key='".concat(this.groupKey,"'>\n            <div class='date-label'>").concat(this.getDatePrefix()).concat(this.getDateFormatted(this.date),"</div>\n            <ul class='query-entries'></ul>\n        </div>"))}}]),e}();t.QueryHistoryEntryDateGroup=u;var f=function(){function e(t){l(this,e),this.entry=t,this.$el=null,this.onClickHandler=null}return c(e,[{key:"onClick",value:function(e){var t=this;this.onClickHandler=e,this.$el&&this.$el.off("click").on("click",(function(e){t.onClickHandler((0,a.default)(e.currentTarget))}))}},{key:"formatDate",value:function(e){return(0,i.default)(e).format("HH:mm:ss")}},{key:"dataKey",value:function(){return this.formatDate(this.entry.start_time)}},{key:"render",value:function(e){var t=this;this.$el=(0,a.default)("<li class='list-item' tabindex='0' data-key='".concat(this.dataKey(),"'>\n          <div class='entry ").concat(this.entry.status?"":"error",'\'>\n              <div class=\'query\'>\n                  <span id="query_source_icon" class="query-history-icon sql-icon-lg"></span>\n                  ').concat(r.default.escape(this.entry.query),"\n              </div>\n              <div class='other-info'>\n              <div class='timestamp'>").concat(this.formatDate(this.entry.start_time),"</div>\n              </div>\n          </div>\n      </li>")).data("entrydata",this.entry).on("click",(function(e){t.onClickHandler((0,a.default)(e.currentTarget))}));var n=this.entry.query_source;n&&this.$el.find("#query_source_icon").addClass(n.ICON_CSS_CLASS).attr("role","img"),this.entry.is_pgadmin_query&&(this.$el.addClass("pgadmin-query-history-entry"),e||this.$el.addClass("d-none"))}}]),e}();t.QueryHistoryItem=f;var p=function(){function e(t){l(this,e),this.parentNode=t,this.$selectedItem=null,this.groupKeyFormat="YYYY MM DD",this.$el=null,this.is_pgadmin_queries_shown=null}return c(e,[{key:"onSelectedChange",value:function(e){this.onSelectedChangeHandler=e}},{key:"focus",value:function(){this.$selectedItem||this.setSelectedListItem(this.$entriesEl.find(".list-item").first()),this.$selectedItem.trigger("click"),this.$entriesEl.focus()}},{key:"isArrowDown",value:function(e){return 40===(e.keyCode||e.which)}},{key:"isArrowUp",value:function(e){return 38===(e.keyCode||e.which)}},{key:"navigateUpAndDown",value:function(e){var t=[38,40],n=e.keyCode||e.which;return!(t.indexOf(n)>-1)||(e.preventDefault(),this.onKeyDownHandler(e),!1)}},{key:"onKeyDownHandler",value:function(e){if(this.isArrowDown(e))if(this.$selectedItem.next().length>0)this.setSelectedListItem(this.$selectedItem.next());else{var t=this.$selectedItem.closest(".query-group");t.next().length>0&&this.setSelectedListItem(t.next().find(".list-item").first())}else if(this.isArrowUp(e))if(this.$selectedItem.prev().length>0)this.setSelectedListItem(this.$selectedItem.prev());else{var n=this.$selectedItem.closest(".query-group");n.prev().length>0&&this.setSelectedListItem(n.prev().find(".list-item").last())}}},{key:"onSelectListItem",value:function(e){this.setSelectedListItem((0,a.default)(e.currentTarget))}},{key:"dateAsGroupKey",value:function(e){return(0,i.default)(e).format(this.groupKeyFormat)}},{key:"setSelectedListItem",value:function(e){this.$selectedItem&&this.$selectedItem.removeClass("selected"),e.addClass("selected"),this.$selectedItem=e,this.$selectedItem[0].scrollIntoView({block:"center"}),this.onSelectedChangeHandler&&this.onSelectedChangeHandler(this.$selectedItem.data("entrydata"))}},{key:"addEntry",value:function(e){var t=this.$entriesEl.find(".query-group"),n=a.default.map(t,(function(e){return(0,a.default)(e).attr("data-key")})),i=this.dateAsGroupKey(e.start_time),o=r.default.indexOf(n,i),s=null;if(0==t.length)s=new u(e.start_time,i).render(),this.$entriesEl.prepend(s);else if(o<0&&0!=t.length){s=new u(e.start_time,i).render();for(var l=0;l<n.length;){if(i>n[l]){s.insertBefore(t[l]);break}l++}l==n.length&&this.$entriesEl.append(s)}else o>=0&&(s=(0,a.default)(t[o]));var d=new f(e);d.onClick(this.setSelectedListItem.bind(this)),d.render(this.is_pgadmin_queries_shown),s.find(".query-entries").prepend(d.$el),this.setSelectedListItem(d.$el)}},{key:"toggleGeneratedQueries",value:function(){this.$el.find(".pgadmin-query-history-entry").each((function(){(0,a.default)(this).toggleClass("d-none")})),this.is_pgadmin_queries_shown=!this.is_pgadmin_queries_shown}},{key:"render",value:function(){var e=this;e.$el=(0,a.default)('\n        <div class="toggle-and-history-container">\n            <div class="query-history-toggle">\n                <label class="control-label">\n                    '.concat((0,o.default)("Show queries generated internally by pgAdmin"),'?\n                </label>\n                <input id="generated-queries-toggle" type="checkbox"\n                  class="pgadmin-controls" data-style="quick"\n                  data-size="mini" data-on="').concat((0,o.default)("Yes"),'" data-off="').concat((0,o.default)("No"),"\"\n                  data-onstyle=\"success\" data-offstyle=\"ternary\" checked>\n            </div>\n            <div id='query_list' class='query-history' tabindex='0'></div>\n        </div>\n    ")),e.$entriesEl=e.$el.find("#query_list"),e.$entriesEl.on("keydown",this.navigateUpAndDown.bind(this)),e.is_pgadmin_queries_shown=!0,e.$el.find("#generated-queries-toggle").bootstrapToggle().change((function(){e.toggleGeneratedQueries()})),e.parentNode.empty().append(e.$el)}}]),e}();t.QueryHistoryEntries=p},function(e,t,n){"use strict";n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.QuerySources=void 0;t.QuerySources={EXECUTE:{ICON_CSS_CLASS:"fa fa-play"},EXPLAIN:{ICON_CSS_CLASS:"fa fa-hand-pointer-o"},EXPLAIN_ANALYZE:{ICON_CSS_CLASS:"fa fa-list-alt"},COMMIT:{ICON_CSS_CLASS:"icon-commit"},ROLLBACK:{ICON_CSS_CLASS:"icon-rollback"},SAVE_DATA:{ICON_CSS_CLASS:"icon-save-data-changes"},VIEW_DATA:{ICON_CSS_CLASS:"icon-view-data"}}},function(e,t,n){"use strict";n(8);var i=s(n(2)),a=s(n(30)),r=s(n(14)),o=s(n(13));function s(e){return e&&e.__esModule?e:{default:e}}var l=r.default.Model.extend({defaults:{recorded_time:void 0,event:void 0,pid:void 0,payload:void 0},schema:[{id:"recorded_time",label:(0,i.default)("Recorded time"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_20",headerCell:a.default.Extension.CustomHeaderCell},{id:"channel",label:(0,i.default)("Event"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_20",headerCell:a.default.Extension.CustomHeaderCell},{id:"pid",label:(0,i.default)("Process ID"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_20",headerCell:a.default.Extension.CustomHeaderCell},{id:"payload",label:(0,i.default)("Payload"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_40",headerCell:a.default.Extension.CustomHeaderCell}]}),d=r.default.Collection.extend({model:l}),c={collection:null,renderNotificationsGrid:function(e){c.collection||(c.collection=new d);var t=[{name:"recorded_time",label:(0,i.default)("Recorded time"),type:"text",editable:!1,cell:"string"},{name:"channel",label:(0,i.default)("Event"),type:"text",editable:!1,cell:"string"},{name:"pid",label:(0,i.default)("Process ID"),type:"text",editable:!1,cell:"string"},{name:"payload",label:(0,i.default)("Payload"),type:"text",editable:!1,cell:"string"}],n=new a.default.Grid({emptyText:"No data found",columns:t,collection:c.collection,className:"backgrid presentation table table-bordered table-hover table-noouter-border table-bottom-border"});n&&e.$container.find(".sql-editor-notifications").append(n.render().el)},updateNotifications:function(e){if(null!=e&&e.length>0){for(var t in e){var n="";n=""!=e[t].payload?(0,i.default)('Asynchronous notification "')+e[t].channel+(0,i.default)('" with payload "')+e[t].payload+(0,i.default)('" received from server process with PID ')+e[t].pid:(0,i.default)('Asynchronous notification "')+e[t].channel+(0,i.default)('" received from server process with PID ')+e[t].pid,o.default.info(n)}c.collection.add(e)}}};e.exports=c},function(e,t,n){"use strict";n(32),n(4),Object.defineProperty(t,"__esModule",{value:!0}),t.callRenderAfterPoll=function(e,t,n){if(e.query_end_time=new Date,e.rows_affected=n.rows_affected,e.has_more_rows=n.has_more_rows,function(e){return null!=e.colinfo}(n))e._render(n);else{e.total_time=(0,a.calculateQueryRunTime)(e.query_start_time,e.query_end_time);var i=(0,o.sprintf)((0,r.default)("Query returned successfully in %s."),e.total_time);n.result?n.result+="\n\n"+i:n.result=i,e.update_msg_history(!0,n.result,!1),e.reset_data_store(),function(e){return e.info_notifier_timeout>=0}(e)&&t.success(i,e.info_notifier_timeout)}(function(e){return e.is_query_tool})(e)&&e.disable_tool_buttons(!1);e.setIsQueryRunning(!1),e.trigger("pgadmin-sqleditor:loading-icon:hide")};var i,a=n(166),r=(i=n(2))&&i.__esModule?i:{default:i},o=n(22)},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(19),n(26),n(27),n(8),n(17),n(15),n(4),n(31),n(12),n(23),n(44),n(20),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.updateUIPreferences=function(e){var t=e.$el,n=e.preferences;e.handler.slickgrid&&(e.handler.slickgrid.CSVOptions={quoting:e.preferences.results_grid_quoting,quote_char:e.preferences.results_grid_quote_char,field_separator:e.preferences.results_grid_field_separator});t.find("#btn-load-file").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Open File"),n.btn_open_file)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Open File"),n.btn_open_file)).attr("accesskey",(0,a.shortcut_key)(n.btn_open_file)),t.find("#btn-save-file").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Save File"),n.btn_save_file)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Save File"),n.btn_save_file)).attr("accesskey",(0,a.shortcut_key)(n.btn_save_file)),t.find("#btn-find-menu-dropdown").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Find"),n.btn_find_options)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Find"),n.btn_find_options)).attr("accesskey",(0,a.shortcut_key)(n.btn_find_options)),t.find("#btn-copy-row").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Copy"),n.btn_copy_row)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Copy"),n.btn_copy_row)).attr("accesskey",(0,a.shortcut_key)(n.btn_copy_row)),t.find("#btn-paste-row").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Paste"),n.btn_paste_row)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Paste"),n.btn_paste_row)).attr("accesskey",(0,a.shortcut_key)(n.btn_paste_row)),t.find("#btn-delete-row").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Delete"),n.btn_delete_row)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Delete"),n.btn_delete_row)).attr("accesskey",(0,a.shortcut_key)(n.btn_delete_row)),t.find("#btn-filter").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Filter"),n.btn_filter_dialog)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Filter"),n.btn_filter_dialog)).attr("accesskey",(0,a.shortcut_key)(n.btn_filter_dialog)),t.find("#btn-filter-dropdown").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Filter options"),n.btn_filter_options)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Filter options"),n.btn_filter_options)).attr("accesskey",(0,a.shortcut_key)(n.btn_filter_options)),t.find("#btn-rows-limit").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Rows limit"),n.btn_rows_limit)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Rows limit"),n.btn_rows_limit)).attr("accesskey",(0,a.shortcut_key)(n.btn_rows_limit)),t.find("#btn-query-dropdown").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Execute options"),n.btn_execute_options)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Execute options"),n.btn_execute_options)).attr("accesskey",(0,a.shortcut_key)(n.btn_execute_options)),t.find("#btn-cancel-query").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Cancel query"),n.btn_cancel_query)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Cancel query"),n.btn_cancel_query)).attr("accesskey",(0,a.shortcut_key)(n.btn_cancel_query)),t.find("#btn-clear-dropdown").attr("title",(0,a.shortcut_accesskey_title)((0,s.default)("Clear"),n.btn_clear_options)).attr("aria-label",(0,a.shortcut_accesskey_title)((0,s.default)("Clear"),n.btn_clear_options)).attr("accesskey",(0,a.shortcut_key)(n.btn_clear_options)),t.find("#btn-conn-status").attr("accesskey",(0,a.shortcut_key)(n.btn_conn_status)).find("i").attr("title",(0,a.shortcut_accesskey_title)("Connection status (click for details)",n.btn_conn_status)),t.find("#btn-flash").attr("title",(0,a.shortcut_title)((0,s.default)("Execute/Refresh"),n.execute_query)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Execute/Refresh"),n.execute_query)),t.find("#btn-explain").attr("title",(0,a.shortcut_title)((0,s.default)("Explain"),n.explain_query)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Explain"),n.explain_query)),t.find("#btn-explain-analyze").attr("title",(0,a.shortcut_title)((0,s.default)("Explain Analyze"),n.explain_analyze_query)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Explain Analyze"),n.explain_analyze_query)),t.find("#btn-download").attr("title",(0,a.shortcut_title)((0,s.default)("Download as CSV"),n.download_csv)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Download as CSV"),n.download_csv)),t.find("#btn-save-data").attr("title",(0,a.shortcut_title)((0,s.default)("Save Data Changes"),n.save_data)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Save Data Changes"),n.save_data)),t.find("#btn-commit").attr("title",(0,a.shortcut_title)((0,s.default)("Commit"),n.commit_transaction)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Commit"),n.commit_transaction)),t.find("#btn-rollback").attr("title",(0,a.shortcut_title)((0,s.default)("Rollback"),n.rollback_transaction)).attr("aria-label",(0,a.shortcut_title)((0,s.default)("Rollback"),n.rollback_transaction)),n.explain_verbose?t.find(".explain-verbose").removeClass("visibility-hidden"):t.find(".explain-verbose").addClass("visibility-hidden");n.explain_costs?t.find(".explain-costs").removeClass("visibility-hidden"):t.find(".explain-costs").addClass("visibility-hidden");n.explain_buffers?t.find(".explain-buffers").removeClass("visibility-hidden"):t.find(".explain-buffers").addClass("visibility-hidden");n.explain_timing?t.find(".explain-timing").removeClass("visibility-hidden"):t.find(".explain-timing").addClass("visibility-hidden");n.explain_summary?t.find(".explain-summary").removeClass("visibility-hidden"):t.find(".explain-summary").addClass("visibility-hidden");n.explain_settings?t.find(".explain-settings").removeClass("visibility-hidden"):t.find(".explain-settings").addClass("visibility-hidden");null!=e.connIntervalId&&(clearInterval(e.connIntervalId),e.connIntervalId=null);if(n.connection_status){var i=t.find("#btn-conn-status"),l=i.find("i");i.popover(),i.removeClass("connection-status-hide"),r.fetchConnectionStatus(e.handler,i,l),e.connIntervalId=setInterval(r.fetchConnectionStatus.bind(null,e.handler,i,l),1e3*n.connection_status_fetch_time)}else t.find("#btn-conn-status").addClass("connection-status-hide");var d=r.calcFontSize(n.sql_font_size);(0,o.default)(e.query_tool_obj.getWrapperElement()).css("font-size",d),n.plain_editor_mode?(e.query_tool_obj.setOption("mode","text/plain"),e.query_tool_obj.setOption("foldGutter",!1)):(e.query_tool_obj.setOption("mode","gpdb"===e.handler.server_type?"text/x-gpsql":"text/x-pgsql"),e.query_tool_obj.setOption("foldGutter",n.code_folding));e.query_tool_obj.setOption("foldGutter",n.code_folding),e.query_tool_obj.setOption("indentWithTabs",!n.use_spaces),e.query_tool_obj.setOption("indentUnit",n.tab_size),e.query_tool_obj.setOption("tabSize",n.tab_size),e.query_tool_obj.setOption("lineWrapping",n.wrap_code),e.query_tool_obj.setOption("autoCloseBrackets",n.insert_pair_brackets),e.query_tool_obj.setOption("matchBrackets",n.brace_matching),e.query_tool_obj.refresh(),e.historyComponent.setEditorPref({sql_font_size:d})};var a=n(69),r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(57)),o=l(n(0)),s=l(n(2));function l(e){return e&&e.__esModule?e:{default:e}}function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}},function(e,t,n){"use strict";(function(e){var t;n(8),(t=e).extend(!0,window,{Slick:{AutoColumnSize:function(e){var n,i,a,r={A:65};function o(a){var o,s;a.ctrlKey&&a.shiftKey&&a.keyCode===r.A&&(o=i.find(".slick-header-column"),s=n.getColumns(),o.each((function(i,a){var r=t(a).data("column"),o=d(a),c=n.getColumnIndex(r.id),u=s[c],f=Math.max(o,l(r,c))+1;f=Math.min(e,f),u.width=f})),n.setColumns(s),n.onColumnsResized.notify())}function s(e){var i=t(e.currentTarget).closest(".slick-header-column"),a=i.data("column");if(a&&a.resizable){e.preventDefault(),e.stopPropagation();var r=d(i[0]),o=n.getColumnIndex(a.id),s=n.getColumns(),c=s[o],u=Math.max(r,l(a,o))+1;u!==c.width&&(c.width=u,n.setColumns(s),n.onColumnsResized.notify())}}function l(e,r){var o=[],s=function(){var e=t('<div class="slick-row"><div class="slick-cell"></div></div>');e.find(".slick-cell").css({visibility:"hidden","text-overflow":"initial","white-space":"nowrap"});var n=i.find(".grid-canvas");return t(n).append(e),e}(),l=n.getData();window.Slick.Data&&l instanceof window.Slick.Data.DataView&&(l=l.getItems());for(var d=0;d<l.length;d++)o.push(l[d][e.field]);var c=function(e,n){var i=t(e.find(".slick-cell"));return i.append(n),t(i).find("*").css("position","relative"),i.outerWidth()+1}(s,function(e,n,i,r,o){var s=0,l=null,d=n.formatter;return t(e).each((function(e,c){var u;d&&(c=(u=t("<span>"+d(e,i,c,n,r[e])+"</span>")).text()||c);var f=c?function(e,t){return a.font=e.css("font-size")+" "+e.css("font-family"),a.measureText(t).width}(o,c):0;f>s&&(s=f,l=u||c)})),l}(o,e,r,l,s));return function(e){t(e).remove()}(s),c}function d(e){var t,n=e.cloneNode(!0);return n.style.cssText="position: absolute; visibility: hidden;right: auto;text-overflow: initial;white-space: nowrap;",e.parentNode.insertBefore(n,e),t=n.offsetWidth,n.parentNode.removeChild(n),t}return{init:function(r){e=e||200,(i=t((n=r).getContainerNode())).on("dblclick.autosize",".slick-resizable-handle",s),i.keydown(o),a=document.createElement("canvas").getContext("2d")},destroy:function(){i.off()}}}}})}).call(this,n(0))}]).default}));